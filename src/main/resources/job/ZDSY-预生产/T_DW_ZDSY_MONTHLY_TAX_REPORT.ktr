<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>T_DW_ZDSY_MONTHLY_TAX_REPORT</name>
    <description />
    <extended_description />
    <trans_version />
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection />
        <schema />
        <table />
        <size_limit_lines />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject />
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject />
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject />
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject />
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection />
        <schema />
        <table />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection />
      <table />
      <field />
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file />
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2020/06/28 11:26:56.502</created_date>
    <modified_user>-</modified_user>
    <modified_date>2020/06/28 11:26:56.502</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>oracle</name>
    <server>r16670.longhu.net</server>
    <type>ORACLE</type>
    <access>Native</access>
    <database>FSSCRPT1</database>
    <port>1521</port>
    <username>fsscreport</username>
    <password>LsY6kPWYuJZf1SsY</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1521</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <connection>
    <name>oracle-ysc</name>
    <server>10.231.64.55</server>
    <type>ORACLE</type>
    <access>Native</access>
    <database>FSSCERM</database>
    <port>1521</port>
    <username>fssc_rptuser</username>
    <password>fssc_rptuser123</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1521</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>重点税源企业税收信息（月报）明细 -'国内增值税指标','国内消费税指标', '进出口税收'</from>
      <to>增加序列</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>增加序列</from>
      <to>表输出</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>delete要插入月份的数据</from>
      <to>重点税源企业税收信息（月报）明细 -'国内增值税指标','国内消费税指标', '进出口税收'</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>delete要插入月份的数据 2</from>
      <to>重点税源企业税收信息（月报）明细-'企业所得税指标','其他指标'</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>增加序列 2</from>
      <to>表输出 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>重点税源企业税收信息（月报）明细-'企业所得税指标','其他指标'</from>
      <to>增加序列 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>delete要插入月份的数据 3</from>
      <to>重点税源企业税收信息（月报）明细-印花税指标</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>增加序列 3</from>
      <to>表输出 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>重点税源企业税收信息（月报）明细-印花税指标</from>
      <to>增加序列 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>delete要插入月份的数据 4</from>
      <to>重点税源企业税收信息（月报）明细-其他税收</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>增加序列 4</from>
      <to>表输出 4</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>重点税源企业税收信息（月报）明细-其他税收</from>
      <to>增加序列 4</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>delete要插入月份的数据 5</from>
      <to>重点税源企业税收信息（月报）明细-代扣代缴税收</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>增加序列 5</from>
      <to>表输出 5</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>重点税源企业税收信息（月报）明细-代扣代缴税收</from>
      <to>增加序列 5</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>delete要插入月份的数据 7</from>
      <to>重点税源企业税收信息（月报）明细 -财务指标（只填写累计或期末余额）</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>增加序列 7</from>
      <to>表输出 7</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>重点税源企业税收信息（月报）明细 -财务指标（只填写累计或期末余额）</from>
      <to>增加序列 7</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>delete要插入月份的数据</name>
    <type>ExecSQL</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>delete from dw_zdsy_monthly_tax_report where  account_time=to_char(add_months(sysdate ,- 1), 'yyyy-mm')
and zb_types in ('国内增值税指标','国内消费税指标', '进出口税收')</sql>
    <set_params>N</set_params>
    <insert_field />
    <update_field />
    <delete_field />
    <read_field />
    <arguments>
    </arguments>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>160</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>delete要插入月份的数据 2</name>
    <type>ExecSQL</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>delete from dw_zdsy_monthly_tax_report where  account_time=to_char(add_months(sysdate ,- 1), 'yyyy-mm')
and zb_types in ('企业所得税指标','其他指标')
</sql>
    <set_params>N</set_params>
    <insert_field />
    <update_field />
    <delete_field />
    <read_field />
    <arguments>
    </arguments>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>160</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>delete要插入月份的数据 3</name>
    <type>ExecSQL</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>delete from dw_zdsy_monthly_tax_report where  account_time=to_char(add_months(sysdate ,- 1), 'yyyy-mm')
and zb_types in ('印花税指标')
</sql>
    <set_params>N</set_params>
    <insert_field />
    <update_field />
    <delete_field />
    <read_field />
    <arguments>
    </arguments>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>160</xloc>
      <yloc>272</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>delete要插入月份的数据 4</name>
    <type>ExecSQL</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>delete from dw_zdsy_monthly_tax_report where  account_time=to_char(add_months(sysdate ,- 1), 'yyyy-mm')
and zb_types in ('其他税收')
</sql>
    <set_params>N</set_params>
    <insert_field />
    <update_field />
    <delete_field />
    <read_field />
    <arguments>
    </arguments>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>160</xloc>
      <yloc>368</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>delete要插入月份的数据 5</name>
    <type>ExecSQL</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>delete from dw_zdsy_monthly_tax_report where  account_time=to_char(add_months(sysdate ,- 1), 'yyyy-mm')
and zb_types in ('代扣代缴税收')
</sql>
    <set_params>N</set_params>
    <insert_field />
    <update_field />
    <delete_field />
    <read_field />
    <arguments>
    </arguments>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>160</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>delete要插入月份的数据 7</name>
    <type>ExecSQL</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>delete from dw_zdsy_monthly_tax_report where  account_time=to_char(add_months(sysdate ,- 1), 'yyyy-mm')
and zb_types in ('财务指标（只填写累计或期末余额）')</sql>
    <set_params>N</set_params>
    <insert_field />
    <update_field />
    <delete_field />
    <read_field />
    <arguments>
    </arguments>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>160</xloc>
      <yloc>672</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>增加序列</name>
    <type>Sequence</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <valuename>id</valuename>
    <use_database>Y</use_database>
    <connection>oracle-ysc</connection>
    <schema />
    <seqname>dw_zdsy_monthly_tax_report_s</seqname>
    <use_counter>N</use_counter>
    <counter_name />
    <start_at>1</start_at>
    <increment_by>1</increment_by>
    <max_value>999999999</max_value>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>增加序列 2</name>
    <type>Sequence</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <valuename>id</valuename>
    <use_database>Y</use_database>
    <connection>oracle-ysc</connection>
    <schema />
    <seqname>dw_zdsy_monthly_tax_report_s</seqname>
    <use_counter>N</use_counter>
    <counter_name />
    <start_at>1</start_at>
    <increment_by>1</increment_by>
    <max_value>999999999</max_value>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>增加序列 3</name>
    <type>Sequence</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <valuename>id</valuename>
    <use_database>Y</use_database>
    <connection>oracle-ysc</connection>
    <schema />
    <seqname>dw_zdsy_monthly_tax_report_s</seqname>
    <use_counter>N</use_counter>
    <counter_name />
    <start_at>1</start_at>
    <increment_by>1</increment_by>
    <max_value>999999999</max_value>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>272</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>增加序列 4</name>
    <type>Sequence</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <valuename>id</valuename>
    <use_database>Y</use_database>
    <connection>oracle-ysc</connection>
    <schema />
    <seqname>dw_zdsy_monthly_tax_report_s</seqname>
    <use_counter>N</use_counter>
    <counter_name />
    <start_at>1</start_at>
    <increment_by>1</increment_by>
    <max_value>999999999</max_value>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>368</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>增加序列 5</name>
    <type>Sequence</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <valuename>id</valuename>
    <use_database>Y</use_database>
    <connection>oracle-ysc</connection>
    <schema />
    <seqname>dw_zdsy_monthly_tax_report_s</seqname>
    <use_counter>N</use_counter>
    <counter_name />
    <start_at>1</start_at>
    <increment_by>1</increment_by>
    <max_value>999999999</max_value>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>增加序列 7</name>
    <type>Sequence</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <valuename>id</valuename>
    <use_database>Y</use_database>
    <connection>oracle-ysc</connection>
    <schema />
    <seqname>dw_zdsy_monthly_tax_report_s</seqname>
    <use_counter>N</use_counter>
    <counter_name />
    <start_at>1</start_at>
    <increment_by>1</increment_by>
    <max_value>999999999</max_value>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>672</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>表输出</name>
    <type>TableOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <schema />
    <table>dw_zdsy_monthly_tax_report</table>
    <commit>2000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field />
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>ACCOUNT_TIME</column_name>
        <stream_name>ACCOUNT_TIME</stream_name>
      </field>
      <field>
        <column_name>PLATFORM</column_name>
        <stream_name>PLATFORM</stream_name>
      </field>
      <field>
        <column_name>AREA</column_name>
        <stream_name>AREA</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE_HZ</column_name>
        <stream_name>ORG_CODE_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_HZ</column_name>
        <stream_name>ORG_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE</column_name>
        <stream_name>ORG_CODE</stream_name>
      </field>
      <field>
        <column_name>ORG</column_name>
        <stream_name>ORG</stream_name>
      </field>
      <field>
        <column_name>ZB_TYPES</column_name>
        <stream_name>ZB_TYPES</stream_name>
      </field>
      <field>
        <column_name>ZB_NAME</column_name>
        <stream_name>ZB_NAME</stream_name>
      </field>
      <field>
        <column_name>SEQ</column_name>
        <stream_name>SEQ</stream_name>
      </field>
      <field>
        <column_name>ZB_ACCESS</column_name>
        <stream_name>ZB_ACCESS</stream_name>
      </field>
      <field>
        <column_name>SOURCE_SYSTEM</column_name>
        <stream_name>SOURCE_SYSTEM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_FORM</column_name>
        <stream_name>ACCESS_FORM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_LOGIC</column_name>
        <stream_name>ACCESS_LOGIC</stream_name>
      </field>
      <field>
        <column_name>AMOUNT1</column_name>
        <stream_name>AMOUNT1</stream_name>
      </field>
      <field>
        <column_name>AMOUNT2</column_name>
        <stream_name>AMOUNT2</stream_name>
      </field>
      <field>
        <column_name>AMOUNT3</column_name>
        <stream_name>AMOUNT3</stream_name>
      </field>
      <field>
        <column_name>AMOUNT4</column_name>
        <stream_name>AMOUNT4</stream_name>
      </field>
      <field>
        <column_name>QUARTER</column_name>
        <stream_name>QUARTER</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1184</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>表输出 2</name>
    <type>TableOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <schema />
    <table>dw_zdsy_monthly_tax_report</table>
    <commit>2000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field />
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>ACCOUNT_TIME</column_name>
        <stream_name>ACCOUNT_TIME</stream_name>
      </field>
      <field>
        <column_name>PLATFORM</column_name>
        <stream_name>PLATFORM</stream_name>
      </field>
      <field>
        <column_name>AREA</column_name>
        <stream_name>AREA</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE_HZ</column_name>
        <stream_name>ORG_CODE_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_HZ</column_name>
        <stream_name>ORG_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE</column_name>
        <stream_name>ORG_CODE</stream_name>
      </field>
      <field>
        <column_name>ORG</column_name>
        <stream_name>ORG</stream_name>
      </field>
      <field>
        <column_name>ZB_TYPES</column_name>
        <stream_name>ZB_TYPES</stream_name>
      </field>
      <field>
        <column_name>ZB_NAME</column_name>
        <stream_name>ZB_NAME</stream_name>
      </field>
      <field>
        <column_name>SEQ</column_name>
        <stream_name>SEQ</stream_name>
      </field>
      <field>
        <column_name>ZB_ACCESS</column_name>
        <stream_name>ZB_ACCESS</stream_name>
      </field>
      <field>
        <column_name>SOURCE_SYSTEM</column_name>
        <stream_name>SOURCE_SYSTEM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_FORM</column_name>
        <stream_name>ACCESS_FORM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_LOGIC</column_name>
        <stream_name>ACCESS_LOGIC</stream_name>
      </field>
      <field>
        <column_name>AMOUNT1</column_name>
        <stream_name>AMOUNT1</stream_name>
      </field>
      <field>
        <column_name>AMOUNT2</column_name>
        <stream_name>AMOUNT2</stream_name>
      </field>
      <field>
        <column_name>AMOUNT3</column_name>
        <stream_name>AMOUNT3</stream_name>
      </field>
      <field>
        <column_name>AMOUNT4</column_name>
        <stream_name>AMOUNT4</stream_name>
      </field>
      <field>
        <column_name>QUARTER</column_name>
        <stream_name>QUARTER</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1184</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>表输出 3</name>
    <type>TableOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <schema />
    <table>dw_zdsy_monthly_tax_report</table>
    <commit>2000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field />
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>ACCOUNT_TIME</column_name>
        <stream_name>ACCOUNT_TIME</stream_name>
      </field>
      <field>
        <column_name>PLATFORM</column_name>
        <stream_name>PLATFORM</stream_name>
      </field>
      <field>
        <column_name>AREA</column_name>
        <stream_name>AREA</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE_HZ</column_name>
        <stream_name>ORG_CODE_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_HZ</column_name>
        <stream_name>ORG_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE</column_name>
        <stream_name>ORG_CODE</stream_name>
      </field>
      <field>
        <column_name>ORG</column_name>
        <stream_name>ORG</stream_name>
      </field>
      <field>
        <column_name>ZB_TYPES</column_name>
        <stream_name>ZB_TYPES</stream_name>
      </field>
      <field>
        <column_name>ZB_NAME</column_name>
        <stream_name>ZB_NAME</stream_name>
      </field>
      <field>
        <column_name>SEQ</column_name>
        <stream_name>SEQ</stream_name>
      </field>
      <field>
        <column_name>ZB_ACCESS</column_name>
        <stream_name>ZB_ACCESS</stream_name>
      </field>
      <field>
        <column_name>SOURCE_SYSTEM</column_name>
        <stream_name>SOURCE_SYSTEM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_FORM</column_name>
        <stream_name>ACCESS_FORM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_LOGIC</column_name>
        <stream_name>ACCESS_LOGIC</stream_name>
      </field>
      <field>
        <column_name>AMOUNT1</column_name>
        <stream_name>AMOUNT1</stream_name>
      </field>
      <field>
        <column_name>AMOUNT2</column_name>
        <stream_name>AMOUNT2</stream_name>
      </field>
      <field>
        <column_name>AMOUNT3</column_name>
        <stream_name>AMOUNT3</stream_name>
      </field>
      <field>
        <column_name>AMOUNT4</column_name>
        <stream_name>AMOUNT4</stream_name>
      </field>
      <field>
        <column_name>QUARTER</column_name>
        <stream_name>QUARTER</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1184</xloc>
      <yloc>272</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>表输出 4</name>
    <type>TableOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <schema />
    <table>dw_zdsy_monthly_tax_report</table>
    <commit>2000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field />
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>ACCOUNT_TIME</column_name>
        <stream_name>ACCOUNT_TIME</stream_name>
      </field>
      <field>
        <column_name>PLATFORM</column_name>
        <stream_name>PLATFORM</stream_name>
      </field>
      <field>
        <column_name>AREA</column_name>
        <stream_name>AREA</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE_HZ</column_name>
        <stream_name>ORG_CODE_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_HZ</column_name>
        <stream_name>ORG_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE</column_name>
        <stream_name>ORG_CODE</stream_name>
      </field>
      <field>
        <column_name>ORG</column_name>
        <stream_name>ORG</stream_name>
      </field>
      <field>
        <column_name>ZB_TYPES</column_name>
        <stream_name>ZB_TYPES</stream_name>
      </field>
      <field>
        <column_name>ZB_NAME</column_name>
        <stream_name>ZB_NAME</stream_name>
      </field>
      <field>
        <column_name>SEQ</column_name>
        <stream_name>SEQ</stream_name>
      </field>
      <field>
        <column_name>ZB_ACCESS</column_name>
        <stream_name>ZB_ACCESS</stream_name>
      </field>
      <field>
        <column_name>SOURCE_SYSTEM</column_name>
        <stream_name>SOURCE_SYSTEM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_FORM</column_name>
        <stream_name>ACCESS_FORM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_LOGIC</column_name>
        <stream_name>ACCESS_LOGIC</stream_name>
      </field>
      <field>
        <column_name>AMOUNT1</column_name>
        <stream_name>AMOUNT1</stream_name>
      </field>
      <field>
        <column_name>AMOUNT2</column_name>
        <stream_name>AMOUNT2</stream_name>
      </field>
      <field>
        <column_name>AMOUNT3</column_name>
        <stream_name>AMOUNT3</stream_name>
      </field>
      <field>
        <column_name>AMOUNT4</column_name>
        <stream_name>AMOUNT4</stream_name>
      </field>
      <field>
        <column_name>QUARTER</column_name>
        <stream_name>QUARTER</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1184</xloc>
      <yloc>368</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>表输出 5</name>
    <type>TableOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <schema />
    <table>dw_zdsy_monthly_tax_report</table>
    <commit>2000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field />
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>ACCOUNT_TIME</column_name>
        <stream_name>ACCOUNT_TIME</stream_name>
      </field>
      <field>
        <column_name>PLATFORM</column_name>
        <stream_name>PLATFORM</stream_name>
      </field>
      <field>
        <column_name>AREA</column_name>
        <stream_name>AREA</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE_HZ</column_name>
        <stream_name>ORG_CODE_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_HZ</column_name>
        <stream_name>ORG_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE</column_name>
        <stream_name>ORG_CODE</stream_name>
      </field>
      <field>
        <column_name>ORG</column_name>
        <stream_name>ORG</stream_name>
      </field>
      <field>
        <column_name>ZB_TYPES</column_name>
        <stream_name>ZB_TYPES</stream_name>
      </field>
      <field>
        <column_name>ZB_NAME</column_name>
        <stream_name>ZB_NAME</stream_name>
      </field>
      <field>
        <column_name>SEQ</column_name>
        <stream_name>SEQ</stream_name>
      </field>
      <field>
        <column_name>ZB_ACCESS</column_name>
        <stream_name>ZB_ACCESS</stream_name>
      </field>
      <field>
        <column_name>SOURCE_SYSTEM</column_name>
        <stream_name>SOURCE_SYSTEM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_FORM</column_name>
        <stream_name>ACCESS_FORM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_LOGIC</column_name>
        <stream_name>ACCESS_LOGIC</stream_name>
      </field>
      <field>
        <column_name>AMOUNT1</column_name>
        <stream_name>AMOUNT1</stream_name>
      </field>
      <field>
        <column_name>AMOUNT2</column_name>
        <stream_name>AMOUNT2</stream_name>
      </field>
      <field>
        <column_name>AMOUNT3</column_name>
        <stream_name>AMOUNT3</stream_name>
      </field>
      <field>
        <column_name>AMOUNT4</column_name>
        <stream_name>AMOUNT4</stream_name>
      </field>
      <field>
        <column_name>QUARTER</column_name>
        <stream_name>QUARTER</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1184</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>表输出 7</name>
    <type>TableOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle-ysc</connection>
    <schema />
    <table>dw_zdsy_monthly_tax_report</table>
    <commit>2000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field />
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>ACCOUNT_TIME</column_name>
        <stream_name>ACCOUNT_TIME</stream_name>
      </field>
      <field>
        <column_name>PLATFORM</column_name>
        <stream_name>PLATFORM</stream_name>
      </field>
      <field>
        <column_name>AREA</column_name>
        <stream_name>AREA</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE_HZ</column_name>
        <stream_name>ORG_CODE_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_HZ</column_name>
        <stream_name>ORG_HZ</stream_name>
      </field>
      <field>
        <column_name>ORG_CODE</column_name>
        <stream_name>ORG_CODE</stream_name>
      </field>
      <field>
        <column_name>ORG</column_name>
        <stream_name>ORG</stream_name>
      </field>
      <field>
        <column_name>ZB_TYPES</column_name>
        <stream_name>ZB_TYPES</stream_name>
      </field>
      <field>
        <column_name>ZB_NAME</column_name>
        <stream_name>ZB_NAME</stream_name>
      </field>
      <field>
        <column_name>SEQ</column_name>
        <stream_name>SEQ</stream_name>
      </field>
      <field>
        <column_name>ZB_ACCESS</column_name>
        <stream_name>ZB_ACCESS</stream_name>
      </field>
      <field>
        <column_name>SOURCE_SYSTEM</column_name>
        <stream_name>SOURCE_SYSTEM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_FORM</column_name>
        <stream_name>ACCESS_FORM</stream_name>
      </field>
      <field>
        <column_name>ACCESS_LOGIC</column_name>
        <stream_name>ACCESS_LOGIC</stream_name>
      </field>
      <field>
        <column_name>AMOUNT1</column_name>
        <stream_name>AMOUNT1</stream_name>
      </field>
      <field>
        <column_name>AMOUNT2</column_name>
        <stream_name>AMOUNT2</stream_name>
      </field>
      <field>
        <column_name>AMOUNT3</column_name>
        <stream_name>AMOUNT3</stream_name>
      </field>
      <field>
        <column_name>AMOUNT4</column_name>
        <stream_name>AMOUNT4</stream_name>
      </field>
      <field>
        <column_name>QUARTER</column_name>
        <stream_name>QUARTER</stream_name>
      </field>
      <field>
        <column_name>id</column_name>
        <stream_name>id</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1184</xloc>
      <yloc>672</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>重点税源企业税收信息（月报）明细 -'国内增值税指标','国内消费税指标', '进出口税收'</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle</connection>
    <sql>----重点税源
with w0 as
 ( --平台、地区、账套、账簿、航道
  select nvl(c.plat_code, d.plat_code) plat_code
         ,nvl(c.plat_name, d.plat_name) plat_name --平台
         ,b.area_code
         ,b.area_name --地区 
         ,b.accounts_id
         ,b.accounts_name --账套
         ,b.chanal
         ,b.chanal_desc --航道
         ,b.accountingbookcode
         ,b.accountingbookname --账簿
         ,b.pk_accountingbook
    from ba_area_accounts b --地区账套对应表
    left join (select * from ba_plat_area where area_name &lt;&gt; '集团') c --取非集团地区对应的平台
      on b.area_code = c.area_code
    left join (select * from ba_plat_area_fkdw where area_name = '集团') d --取集团下公司对应的平台
      on b.accounts_name = d.fkdw),
w01 as
 ( --账套汇总、账套
  select accounts_id || 'A' accounts_id_hz
         ,accounts_name || '(汇总)' accounts_name_hz --账套汇总
         ,accounts_id
         ,accounts_name --账套
    from w0
   where accounts_id in (select accounts_id
                           from (select substr(accounts_id, 1, 5) accounts_id
                                       ,count(*)
                                   from w0
                                  group by substr(accounts_id, 1, 5)
                                 having count(*) > 1))),
w02 as
 ( --平台、地区、账套汇总、账套
  select w0.plat_code
         ,w0.plat_name --平台
         ,w0.area_code
         ,w0.area_name --地区
         ,nvl(w01.accounts_id_hz, w0.accounts_id) accounts_id_hz
         ,nvl(w01.accounts_name_hz, w0.accounts_name) accounts_name_hz
         ,w0.accounts_id
         ,w0.accounts_name --账套
         ,w0.chanal
         ,w0.chanal_desc --航道
         ,w0.accountingbookcode
         ,w0.accountingbookname --账簿
         ,w0.pk_accountingbook
    from w0
    left join w01
      on w0.accounts_id like w01.accounts_id || '%'),
w1 as
 (select b.*
        ,w02.plat_name --平台
        ,w02.area_code
        ,w02.area_name --地区 
        ,w02.accounts_id_hz
        ,w02.accounts_id_hz || '-' || w02.accounts_name_hz accounts_name_hz --账套汇总
        ,w02.accounts_id
        ,w02.accounts_name accounts_name2
        ,w02.accounts_id || '-' || w02.accounts_name accounts_name --账套
        ,w02.chanal_desc --航道
        ,w02.pk_accountingbook
    from ( --指标名称
          select *
            from dw_zdsy_index_dim
           where module = 1 --模块分类（1-企业税收信息，2-企业景气调查问卷，3-财务信息）
             and index_type in
                 ('国内增值税指标', '国内消费税指标', '进出口税收')) b
        ,w02
   where length(w02.accounts_id) > 2
  --and accounts_id_hz in ('01001A','00001','00002') 
  ),
w1_1 as
 ( --上期报表的该指标(期末欠税余额)累计数
  select org_code
         ,seq
         ,amount1
         ,amount2
         ,amount3
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq = 103
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w1_2 as
 ( --上期报表的企业所得税指标累计值between 79 and 98
  select org_code
         ,seq
         ,amount2
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq between 79 and 98
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w2 as
 ( --国内增值税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount1
                    when linenum = 4 and t.hc = 2 then
                     amount1
                    when linenum = 5 and t.hc = 3 then
                     amount1
                    when linenum = 6 and t.hc = 4 then
                     amount1
                    when linenum = 7 and t.hc = 5 then
                     amount1
                    when linenum = 8 and t.hc = 6 then
                     amount1
                    when linenum = 9 and t.hc = 7 then
                     amount1
                    when linenum = 10 and t.hc = 8 then
                     amount1
                    when linenum = 11 and t.hc = 9 then
                     amount1
                    when linenum = 12 and t.hc = 10 then
                     amount1
                    when linenum = 21 and t.hc = 11 then
                     amount1
                    when linenum = 27 and t.hc = 12 then
                     amount1
                    when linenum = 33 and t.hc = 13 then
                     amount1
                    when linenum = 34 and t.hc = 14 then
                     amount1
                    when linenum = 35 and t.hc = 15 then
                     amount1
                    when linenum = 36 and t.hc = 16 then
                     amount1
                    when linenum = 37 and t.hc = 17 then
                     amount1
                    when linenum = 38 and t.hc = 18 then
                     amount1
                    when linenum = 39 and t.hc = 19 then
                     amount1
                    when linenum = 40 and t.hc = 20 then
                     amount1
                    when linenum = 41 and t.hc = 21 then
                     amount1
                    when linenum = 49 and t.hc = 22 then
                     amount1
                    when linenum = 50 and t.hc = 23 then
                     amount1
                    when linenum = 51 and t.hc = 24 then
                     amount1
                    when linenum = 52 and t.hc = 25 then
                     amount1
                    when linenum = 53 and t.hc = 26 then
                     amount1
                    when linenum = 54 and t.hc = 27 then
                     amount1
                    when linenum = 55 and t.hc = 28 then
                     amount1
                    when linenum = 56 and t.hc = 29 then
                     amount1
                    when linenum = 57 and t.hc = 30 then
                     amount1
                    when linenum = 58 and t.hc = 31 then
                     amount1
                    when linenum = 59 and t.hc = 32 then
                     amount1
                    when linenum = 60 and t.hc = 33 then
                     amount1
                    when linenum = 61 and t.hc = 34 then
                     amount1
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount2
                    when linenum = 4 and t.hc = 2 then
                     amount2
                    when linenum = 5 and t.hc = 3 then
                     amount2
                    when linenum = 6 and t.hc = 4 then
                     amount2
                    when linenum = 7 and t.hc = 5 then
                     amount2
                    when linenum = 8 and t.hc = 6 then
                     amount2
                    when linenum = 9 and t.hc = 7 then
                     amount2
                    when linenum = 10 and t.hc = 8 then
                     amount2
                    when linenum = 11 and t.hc = 9 then
                     amount2
                    when linenum = 12 and t.hc = 10 then
                     amount2
                    when linenum = 21 and t.hc = 11 then
                     amount2
                    when linenum = 27 and t.hc = 12 then
                     amount2
                    when linenum = 33 and t.hc = 13 then
                     amount2
                    when linenum = 34 and t.hc = 14 then
                     amount2
                    when linenum = 35 and t.hc = 15 then
                     amount2
                    when linenum = 36 and t.hc = 16 then
                     amount2
                    when linenum = 37 and t.hc = 17 then
                     amount2
                    when linenum = 38 and t.hc = 18 then
                     amount2
                    when linenum = 39 and t.hc = 19 then
                     amount2
                    when linenum = 40 and t.hc = 20 then
                     amount2
                    when linenum = 41 and t.hc = 21 then
                     amount2
                    when linenum = 49 and t.hc = 22 then
                     amount2
                    when linenum = 50 and t.hc = 23 then
                     amount2
                    when linenum = 51 and t.hc = 24 then
                     amount2
                    when linenum = 52 and t.hc = 25 then
                     amount2
                    when linenum = 53 and t.hc = 26 then
                     amount2
                    when linenum = 54 and t.hc = 27 then
                     amount2
                    when linenum = 55 and t.hc = 28 then
                     amount2
                    when linenum = 56 and t.hc = 29 then
                     amount2
                    when linenum = 57 and t.hc = 30 then
                     amount2
                    when linenum = 58 and t.hc = 31 then
                     amount2
                    when linenum = 59 and t.hc = 32 then
                     amount2
                    when linenum = 60 and t.hc = 33 then
                     amount2
                    when linenum = 61 and t.hc = 34 then
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(nvl(l1, 0) + nvl(l3, 0)) amount1
                     ,sum(nvl(l2, 0) + nvl(l4, 0)) amount2
                 from ods_zd_swglzzszbmx
                where substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月+本年累计
      on w1.accounts_name2 = t.nsrmc
   where w1.index_type = '国内增值税指标'
     and (linenum between 3 and 12 or linenum in (21, 27) or
         linenum between 33 and 41 or linenum between 49 and 61)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t.l12, 0)
                    when linenum = 22 and t.hc = 1 then
                     nvl(t.l10, 0)
                    when linenum = 23 and t.hc = 2 then
                     nvl(t.l10, 0)
                    when linenum = 24 and t.hc = 3 then
                     nvl(t.l10, 0)
                    when linenum = 25 and t.hc = 4 then
                     nvl(t.l10, 0)
                    when linenum = 26 and t.hc = 5 then
                     nvl(t.l10, 0)
                    when linenum = 42 and t.hc = 8 then
                     nvl(t.l10, 0)
                    when linenum = 43 and t.hc = '9' then
                     nvl(t.l10, 0)
                    when linenum = 44 and t.hc = '10' then
                     nvl(t.l10, 0)
                    when linenum = 45 and t.hc = 11 then
                     nvl(t.l10, 0)
                    when linenum = 46 and t.hc = 12 then
                     nvl(t.l10, 0)
                    when linenum = 47 and t.hc = 13 then
                     nvl(t.l10, 0)
                    when linenum = 48 and t.hc in (14, 15, 16) then
                     nvl(t.l10, 0)
                  end,
                  0)) amount1 --本月金额 
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t3.l12, 0)
                    when linenum = 22 and t3.hc = 1 then
                     nvl(t3.l10, 0)
                    when linenum = 23 and t3.hc = 2 then
                     nvl(t3.l10, 0)
                    when linenum = 24 and t3.hc = 3 then
                     nvl(t3.l10, 0)
                    when linenum = 25 and t3.hc = 4 then
                     nvl(t3.l10, 0)
                    when linenum = 26 and t3.hc = 5 then
                     nvl(t3.l10, 0)
                    when linenum = 42 and t3.hc = 8 then
                     nvl(t3.l10, 0)
                    when linenum = 43 and t3.hc = '9' then
                     nvl(t3.l10, 0)
                    when linenum = 44 and t3.hc = '10' then
                     nvl(t3.l10, 0)
                    when linenum = 45 and t3.hc = 11 then
                     nvl(t3.l10, 0)
                    when linenum = 46 and t3.hc = 12 then
                     nvl(t3.l10, 0)
                    when linenum = 47 and t3.hc = 13 then
                     nvl(t3.l10, 0)
                    when linenum = 48 and t3.hc in (14, 15, 16) then
                     nvl(t3.l10, 0)
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
  
   where w1.index_type = '国内增值税指标'
     and (linenum between 22 and 26 or linenum in (13) or
         linenum between 42 and 48)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 28 and t.hc = 1 then
                     nvl(t.l3, 0)
                    when linenum = 29 and t.hc = 4 then
                     nvl(t.l3, 0)
                    when linenum = 30 and t.hc = 9 then
                     nvl(t.l3, 0)
                    when linenum = 31 and t.hc = 10 then
                     nvl(t.l3, 0)
                    when linenum = 32 and t.hc = 11 then
                     nvl(t.l3, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 28 and t3.hc = 1 then
                     nvl(t3.l3, 0)
                    when linenum = 29 and t3.hc = 4 then
                     nvl(t3.l3, 0)
                    when linenum = 30 and t3.hc = 9 then
                     nvl(t3.l3, 0)
                    when linenum = 31 and t3.hc = 10 then
                     nvl(t3.l3, 0)
                    when linenum = 32 and t3.hc = 11 then
                     nvl(t3.l3, 0)
                  end,
                  0)) amount2 --本年累计     
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 28 and 32
  --and w1.accounts_name2 = '重庆龙湖嘉博地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 14 and t.hc = 1 then
                     nvl(t.l5, 0)
                    when linenum = 15 and t.hc = 2 then
                     nvl(t.l5, 0)
                    when linenum = 16 and t.hc = 3 then
                     nvl(t.l5, 0)
                    when linenum = 17 and t.hc = 4 then
                     nvl(t.l5, 0)
                    when linenum = 18 and t.hc = 5 then
                     nvl(t.l5, 0)
                    when linenum = 19 and t.hc = 6 then
                     nvl(t.l5, 0)
                    when linenum = 20 then
                     nvl(t.l6, 0)
                  end,
                  0)) amount1 --本月金额
         ,sum(nvl(case
                    when linenum = 14 and t3.hc = 1 then
                     nvl(t3.l5, 0)
                    when linenum = 15 and t3.hc = 2 then
                     nvl(t3.l5, 0)
                    when linenum = 16 and t3.hc = 3 then
                     nvl(t3.l5, 0)
                    when linenum = 17 and t3.hc = 4 then
                     nvl(t3.l5, 0)
                    when linenum = 18 and t3.hc = 5 then
                     nvl(t3.l5, 0)
                    when linenum = 19 and t3.hc = 6 then
                     nvl(t3.l5, 0)
                    when linenum = 20 then
                     nvl(t3.l6, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 14 and 20
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,null amount1 --本月金额
         ,null amount2 --本年累计
    from w1
   where w1.index_type = '国内增值税指标'
     and linenum between 62 and 65
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w3 as
 ( --国内消费税指标、进出口税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额
         ,0 amount2 --本年金额
    from w1
   where index_type in ('国内消费税指标', '进出口税收')),
w4 as
 ( --企业所得税指标
  select a.account_time --所属期
         ,a.platform
         ,a.area
         ,a.accounts_id_hz
         ,a.accounts_name_hz --账套汇总
         ,a.accounts_id
         ,a.accounts_name2
         ,a.accounts_name --账套
         ,a.pk_accountingbook
         ,a.zb_types --指标大类
         ,a.zb_name --指标名称
         ,a.seq --画面表示顺序
         ,a.zb_access
         ,a.source_system --来源系统
         ,a.access_form --取数表单
         ,a.access_logic --取数逻辑
         ,case
            when b.amount2 is null or
                 to_char(add_months(sysdate, -1), 'yyyy-mm') = '2020-11' then
             0
            else
             a.amount2 - b.amount2
          end amount1
         ,a.amount2
    from ( --企业所得税指标
           select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
                  ,w1.plat_name platform
                  ,w1.area_name area
                  ,w1.accounts_id_hz
                  ,w1.accounts_name_hz --账套汇总
                  ,w1.accounts_id
                  ,w1.accounts_name2
                  ,w1.accounts_name --账套
                  ,w1.pk_accountingbook
                  ,w1.index_type zb_types --指标大类
                  ,w1.index_name zb_name --指标名称
                  ,w1.linenum seq --画面表示顺序
                  ,w1.index_access zb_access
                  ,w1.source_system --来源系统
                  ,w1.access_form --取数表单
                  ,w1.access_logic --取数逻辑
                  ,0 amount1 --本月
                  ,sum(nvl(case
                             when linenum = 79 then
                              nvl(t2.yysr, 0)
                             when linenum = 80 then
                              nvl(t2.yycb, 0)
                             when linenum = 81 then
                              nvl(t2.lrze, 0)
                             when linenum = 82 then
                              nvl(t2.tdywjsdynssde, 0)
                             when linenum = 83 then
                              nvl(t2.bzssr, 0)
                             when linenum = 84 then
                              nvl(t2.mssr, 0)
                             when linenum = 85 then
                              nvl(t2.gdzcjszjtze, 0)
                             when linenum = 86 then
                              nvl(t2.mbyqndks, 0)
                             when linenum = 87 then
                              nvl(t2.sjlre, 0)
                             when linenum = 88 then
                              nvl(t2.ynsdse, 0)
                             when linenum = 89 then
                              nvl(t2.jmsdse, 0)
                             when linenum = 90 then
                              nvl(t2.sjyjnsdse, 0)
                             when linenum = 91 then
                              nvl(t2.tdywyjsdse, 0)
                             when linenum = 92 then
                              nvl(t2.ybtsdse, 0)
                             when linenum = 93 then
                              nvl(t2.zjgbqftybtsdse, 0)
                             when linenum = 94 then
                              nvl(t2.zjgftybtsdse, 0)
                             when linenum = 95 then
                              nvl(t2.czjzfpybtsdse, 0)
                             when linenum = 96 then
                              nvl(t2.zjgznbmftsdse, 0)
                             when linenum = 97 then
                              nvl(t2.fzjgbqftbl, 0)
                             when linenum = 98 then
                              nvl(t2.fzjgbqftybtsdse, 0)
                           end,
                           0)) amount2 --本年累计     
             from w1
             left join (select a.name
                              ,sum(yysr) yysr
                              ,sum(yycb) yycb
                              ,sum(lrze) lrze
                              ,sum(tdywjsdynssde) tdywjsdynssde
                              ,sum(bzssr) bzssr
                              ,sum(mssr) mssr
                              ,sum(gdzcjszjtze) gdzcjszjtze
                              ,sum(mbyqndks) mbyqndks
                              ,sum(sjlre) sjlre
                              ,sum(ynsdse) ynsdse
                              ,sum(jmsdse) jmsdse
                              ,sum(sjyjnsdse) sjyjnsdse
                              ,sum(tdywyjsdse) tdywyjsdse
                              ,sum(ybtsdse) ybtsdse
                              ,sum(zjgbqftybtsdse) zjgbqftybtsdse
                              ,sum(zjgftybtsdse) zjgftybtsdse
                              ,sum(czjzfpybtsdse) czjzfpybtsdse
                              ,sum(zjgznbmftsdse) zjgznbmftsdse
                              ,sum(fzjgbqftbl) fzjgbqftbl
                              ,sum(fzjgbqftybtsdse) fzjgbqftybtsdse
                          from ods_zd_swglqs a --企业所得税--本年累计
                              ,(select name
                                      ,max(ssq_dm) ssq_dm
                                  from ods_zd_swglqs
                                 where substr(lr_sj, 1, 7) &lt;=
                                       to_char(add_months(sysdate, -1), 'yyyy-mm')
                                 group by name) b
                         where a.name = b.name
                           and a.ssq_dm = b.ssq_dm
                         group by a.name) t2
               on w1.accounts_name2 = t2.name
            where index_type = '企业所得税指标'
              and linenum between 79 and 98
           -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
            group by w1.plat_name
                     ,w1.area_name
                     ,w1.accounts_id_hz
                     ,w1.accounts_name_hz --账套汇总
                     ,w1.accounts_id
                     ,w1.accounts_name2
                     ,w1.accounts_name --账套
                     ,w1.pk_accountingbook
                     ,w1.index_type --指标大类
                     ,w1.index_name --指标名称
                     ,w1.linenum --画面表示顺序
                     ,w1.index_access
                     ,w1.source_system --来源系统
                     ,w1.access_form --取数表单
                     ,w1.access_logic --取数逻辑
           ) a
    left join w1_2 b
      on a.accounts_id = b.org_code
     and a.seq = b.seq
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 99 and
                         t1.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t1.monthmoney, 0)
                    when linenum = 100 and t1.indexname = '企业所得税-预缴' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 101 and t1.indexname = '企业所得税-结算' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 99 and
                         t2.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t2.monthmoney, 0)
                    when linenum = 100 and t2.indexname = '企业所得税-预缴' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 101 and t2.indexname = '企业所得税-结算' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount2 --本年累计      
    from w1
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t2
      on w1.accounts_name2 = t2.unitname
     and t2.indexname = nvl(t1.indexname, t2.indexname)
   where index_type = '企业所得税指标'
     and linenum between 99 and 102
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w41 as
 ( --企业所得税指标-103
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount1, 0)
                else
                 0
              end) amount1
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount2, 0)
                else
                 0
              end) amount2
    from w1
    left join w1_1 t2
      on w1.accounts_id = t2.org_code
    left join (select accounts_id --组织
                     ,case
                        when seq = 99 then
                         -amount1
                        else
                         amount1
                      end amount1
                     ,case
                        when seq = 99 then
                         -amount2
                        else
                         amount2
                      end amount2
                 from w4
                where w4.seq in (92, 99)) t3
      on w1.accounts_id = t3.accounts_id
   where index_type = '企业所得税指标'
     and linenum = 103
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w5 as
 ( --印花税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t.jsje, 0)
                    when linenum = 110 and t.sm_mc = '购销合同' then
                     nvl(t.jsje, 0)
                    when linenum = 111 and t.sm_mc = '加工承揽合同' then
                     nvl(t.jsje, 0)
                    when linenum = 112 and t.sm_mc = '建设工程勘察设计合同' then
                     nvl(t.jsje, 0)
                    when linenum = 113 and t.sm_mc = '建筑安装工程承包合同' then
                     nvl(t.jsje, 0)
                    when linenum = 114 and t.sm_mc = '财产租赁合同' then
                     nvl(t.jsje, 0)
                    when linenum = 115 and t.sm_mc = '货物运输合同' then
                     nvl(t.jsje, 0)
                    when linenum = 116 and t.sm_mc = '借款合同' then
                     nvl(t.jsje, 0)
                    when linenum = 117 and t.sm_mc = '财产保险合同' then
                     nvl(t.jsje, 0)
                    when linenum = 118 and t.sm_mc = '技术合同' then
                     nvl(t.jsje, 0)
                    when linenum = 119 and t.sm_mc = '仓储保管合同' then
                     nvl(t.jsje, 0)
                    when linenum = 120 and t.sm_mc = '产权转移书据' then
                     nvl(t.jsje, 0)
                    when linenum = 121 and t.hc = 1000 then
                     nvl(t.bqynse, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t2.jsje, 0)
                    when linenum = 110 and t2.sm_mc = '购销合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 111 and t2.sm_mc = '加工承揽合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 112 and t2.sm_mc = '建设工程勘察设计合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 113 and t2.sm_mc = '建筑安装工程承包合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 114 and t2.sm_mc = '财产租赁合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 115 and t2.sm_mc = '货物运输合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 116 and t2.sm_mc = '借款合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 117 and t2.sm_mc = '财产保险合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 118 and t2.sm_mc = '技术合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 119 and t2.sm_mc = '仓储保管合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 120 and t2.sm_mc = '产权转移书据' then
                     nvl(t2.jsje, 0)
                    when linenum = 121 and t2.hc = 1000 then
                     nvl(t2.bqynse, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本月
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本年累计
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t2
      on w1.accounts_name2 = t2.nsrmc
     and nvl(t.hc, t2.hc) = t2.hc
   where w1.index_type = '印花税指标'
     and w1.linenum &lt;&gt; 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.fsj, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.ljj, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select gsmc
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --nc科目数据-本年+累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and km_code like ('54020109%')
                group by gsmc) t2
      on w1.accounts_name2 = t2.gsmc
  
   where w1.index_type = '印花税指标'
     and w1.linenum = 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w6 as
 ( --其他税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.fsd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.fsj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.fsj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.fsd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.fsj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.fsj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.fsj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.fsj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.fsj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.fsj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.fsj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.fsj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.fsj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.fsj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.fsj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.fsj, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.ljd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.ljj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.ljj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.ljd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.ljj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.ljj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.ljj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.ljj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.ljj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.ljj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.ljj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.ljj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.ljj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.ljj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.ljj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.ljj, 0)
                    else
                     0
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljd, 0)) ljd
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --NC接口数据：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('21710401',
                                  '217106',
                                  '217108',
                                  '217107',
                                  '41010102',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '217103')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '其他税收'
     and w1.linenum not in (130, 132, 133, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t3.monthmoney, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t4.monthmoney, 0)
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t3
      on w1.accounts_name2 = t3.unitname
  
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t4
      on w1.accounts_name2 = t4.unitname
  
   where w1.index_type = '其他税收'
     and w1.linenum in (133)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t1.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t1.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t1.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t1.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t1.ybse_bq, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t2.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t2.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t2.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t2.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t2.ybse_bq, 0)
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本月
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t1
      on w1.accounts_name2 = t1.nsrmc
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本年累计
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t2
      on w1.accounts_name2 = t2.nsrmc
  
   where w1.index_type = '其他税收'
     and w1.linenum in (130, 132, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w7 as
 ( --代扣代缴税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.fsj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.ljj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('217105', '217120')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '代扣代缴税收'
  -- and w1.accounts_name2 = '上海恒卓房地产有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w8 as
 ( --其他指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t3.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t1.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t4.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t2.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t2
      on w1.accounts_name2 = t2.unitname
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本月
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '本月') t3
      on w1.pk_accountingbook = t3.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本年累计
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '累计') t4
      on w1.pk_accountingbook = t4.pk_accountingbook
  
   where index_type = '其他指标'
     and linenum in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.fsj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.fsd, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.fsd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.fsj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.fsd, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.ljj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.ljj, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.ljj, 0) --+ t3.amount2
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.ljj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.ljd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.ljj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.ljd, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(ljj, 0)) ljj
                     ,sum(nvl(ljd, 0)) ljd
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and (substr(km_code, 1, 4) in
                      ('1501', '1502', '1211', '1233', '1251', '1281') or
                      km_code in ('217105', '218111'))
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '其他指标'
     and linenum not in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w81 as
 (select w8.account_time --所属期
        ,w8.platform
        ,w8.area
        ,w8.accounts_id_hz
        ,w8.accounts_name_hz --账套汇总
        ,w8.accounts_id
        ,w8.accounts_name2
        ,w8.accounts_name --账套
        ,w8.pk_accountingbook
        ,w8.zb_types --指标大类
        ,w8.zb_name --指标名称
        ,w8.seq --画面表示顺序
        ,w8.zb_access
        ,w8.source_system --来源系统
        ,w8.access_form --取数表单
        ,w8.access_logic --取数逻辑
        ,case
           when w8.seq = 188 then
            w8.amount1 + t.amount1
           else
            w8.amount1
         end amount1
        ,case
           when w8.seq = 188 then
            w8.amount2 + t.amount2
           else
            w8.amount2
         end amount2
    from w8
    left join (select * from w6 where w6.seq = 151) t --
      on w8.accounts_id = t.accounts_id),
w9 as
 ( --财务指标（只填写累计或期末余额）
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 193 then
                     nvl(t2.yysr_lj, 0)
                    when linenum = 196 then
                     nvl(t2.cwfy_lj, 0)
                    when linenum = 197 then
                     nvl(t2.tzsy_lj, 0)
                    when linenum = 198 then
                     nvl(t2.lrze_lj, 0)
                    when linenum = 199 then
                     nvl(t1.zczj, 0)
                    when linenum = 200 then
                     nvl(t1.yszk, 0)
                    when linenum = 201 then
                     nvl(t1.ch, 0)
                    when linenum = 202 then
                     nvl(t.amount2, 0)
                    when linenum = 204 then
                     nvl(t1.fzhj, 0)
                    else
                     0
                  end,
                  0)) amount2 --本年金额 
    from w1
    left join (select * from w8 where w8.seq = 191) t --
      on w1.accounts_id = t.accounts_id
    left join (select *
                 from ods_nc_ogg_balance_sheet --资产负债表（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and sj = '期末') t1
      on w1.pk_accountingbook = t1.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_income_amount --利润表（本年）
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')) t2
      on w1.pk_accountingbook = t2.pk_accountingbook
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum not in (194, 195, 203)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 194 and t.km_code = '5401' then
                     amount2
                    when linenum = 195 and t.km_code = '5101' then
                     amount2
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select gsmc
                     ,substr(km_code, 1, 4) km_code
                     ,sum(nvl(ljj, 0) - nvl(ljd, 0)) amount2
                 from ods_zd_ncglsubjectbalance --nc科目数据（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and substr(km_code, 1, 4) in ('5401', '5101')
                group by gsmc
                        ,substr(km_code, 1, 4)) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum in (194, 195)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w91 as
 ( --财务指标（只填写累计或期末余额）-203
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1
         ,sum(nvl(case
                    when seq = 202 then
                     -amount2
                    else
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select * from w9 where seq in (201, 202)) b
      on w1.pk_accountingbook = b.pk_accountingbook
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum = 203
  -- and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  )

select a.account_time --所属期
      ,a.platform --平台
      ,a.area --地区
      ,a.accounts_id_hz   org_code_hz
      ,a.accounts_name_hz org_hz --账套汇总
      ,a.accounts_id      org_code
       --,accounts_name2
      ,a.accounts_name org --账套
       --,pk_accountingbook
      ,a.zb_types --指标大类
      ,a.zb_name --指标名称
      ,a.seq --画面表示顺序
      ,a.zb_access
      ,a.source_system --来源系统
      ,a.access_form --取数表单
      ,a.access_logic --取数逻辑
      ,a.amount1
      ,a.amount2
			,b.amount1 amount3
			,b.amount2 amount4
      ,to_char(add_months(sysdate, -1), 'yyyy') || 'Q' ||
       to_char(add_months(sysdate, -1), 'q') quarter
  from (select *
          from w2
        union all
        select *
          from w3
        union all
        select *
          from w4 --企业所得税指标
        union all
        select *
          from w41 --企业所得税指标-103
        union all
        select *
          from w5 --印花税指标
        union all
        select *
          from w6 --其他税收
        union all
        select *
          from w7 --代扣代缴税收
        union all
        select *
          from w81 --其他指标
        union all
        select *
          from w9 --财务指标（只填写累计或期末余额）
        union all
        select *
          from w91 --财务指标（只填写累计或期末余额）-203
        ) a
  left join (select *
               from dw_zdsy_monthly_tax_report
              where account_time =
                    to_char(add_months(sysdate, -2), 'yyyy-mm')) b
    on a.accounts_id = b.org_code
   and a.seq = b.seq
--where accounts_name2 = '重庆龙湖科恒地产发展有限公司'
</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>608</xloc>
      <yloc>80</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>重点税源企业税收信息（月报）明细 -财务指标（只填写累计或期末余额）</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle</connection>
    <sql>----重点税源
with w0 as
 ( --平台、地区、账套、账簿、航道
  select nvl(c.plat_code, d.plat_code) plat_code
         ,nvl(c.plat_name, d.plat_name) plat_name --平台
         ,b.area_code
         ,b.area_name --地区 
         ,b.accounts_id
         ,b.accounts_name --账套
         ,b.chanal
         ,b.chanal_desc --航道
         ,b.accountingbookcode
         ,b.accountingbookname --账簿
         ,b.pk_accountingbook
    from ba_area_accounts b --地区账套对应表
    left join (select * from ba_plat_area where area_name &lt;&gt; '集团') c --取非集团地区对应的平台
      on b.area_code = c.area_code
    left join (select * from ba_plat_area_fkdw where area_name = '集团') d --取集团下公司对应的平台
      on b.accounts_name = d.fkdw),
w01 as
 ( --账套汇总、账套
  select accounts_id || 'A' accounts_id_hz
         ,accounts_name || '(汇总)' accounts_name_hz --账套汇总
         ,accounts_id
         ,accounts_name --账套
    from w0
   where accounts_id in (select accounts_id
                           from (select substr(accounts_id, 1, 5) accounts_id
                                       ,count(*)
                                   from w0
                                  group by substr(accounts_id, 1, 5)
                                 having count(*) > 1))),
w02 as
 ( --平台、地区、账套汇总、账套
  select w0.plat_code
         ,w0.plat_name --平台
         ,w0.area_code
         ,w0.area_name --地区
         ,nvl(w01.accounts_id_hz, w0.accounts_id) accounts_id_hz
         ,nvl(w01.accounts_name_hz, w0.accounts_name) accounts_name_hz
         ,w0.accounts_id
         ,w0.accounts_name --账套
         ,w0.chanal
         ,w0.chanal_desc --航道
         ,w0.accountingbookcode
         ,w0.accountingbookname --账簿
         ,w0.pk_accountingbook
    from w0
    left join w01
      on w0.accounts_id like w01.accounts_id || '%'),
w1 as
 (select b.*
        ,w02.plat_name --平台
        ,w02.area_code
        ,w02.area_name --地区 
        ,w02.accounts_id_hz
        ,w02.accounts_id_hz || '-' || w02.accounts_name_hz accounts_name_hz --账套汇总
        ,w02.accounts_id
        ,w02.accounts_name accounts_name2
        ,w02.accounts_id || '-' || w02.accounts_name accounts_name --账套
        ,w02.chanal_desc --航道
        ,w02.pk_accountingbook
    from ( --指标名称
          select *
            from dw_zdsy_index_dim
           where module = 1 --模块分类（1-企业税收信息，2-企业景气调查问卷，3-财务信息）
             and index_type in
                 ('财务指标（只填写累计或期末余额）')) b
        ,w02
   where length(w02.accounts_id) > 2
  --and accounts_id_hz in ('01001A','00001','00002') 
  ),
w1_1 as
 ( --上期报表的该指标(期末欠税余额)累计数
  select org_code
         ,seq
         ,amount1
         ,amount2
         ,amount3
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq = 103
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w1_2 as
 ( --上期报表的企业所得税指标累计值between 79 and 98
  select org_code
         ,seq
         ,amount2
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq between 79 and 98
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w2 as
 ( --国内增值税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount1
                    when linenum = 4 and t.hc = 2 then
                     amount1
                    when linenum = 5 and t.hc = 3 then
                     amount1
                    when linenum = 6 and t.hc = 4 then
                     amount1
                    when linenum = 7 and t.hc = 5 then
                     amount1
                    when linenum = 8 and t.hc = 6 then
                     amount1
                    when linenum = 9 and t.hc = 7 then
                     amount1
                    when linenum = 10 and t.hc = 8 then
                     amount1
                    when linenum = 11 and t.hc = 9 then
                     amount1
                    when linenum = 12 and t.hc = 10 then
                     amount1
                    when linenum = 21 and t.hc = 11 then
                     amount1
                    when linenum = 27 and t.hc = 12 then
                     amount1
                    when linenum = 33 and t.hc = 13 then
                     amount1
                    when linenum = 34 and t.hc = 14 then
                     amount1
                    when linenum = 35 and t.hc = 15 then
                     amount1
                    when linenum = 36 and t.hc = 16 then
                     amount1
                    when linenum = 37 and t.hc = 17 then
                     amount1
                    when linenum = 38 and t.hc = 18 then
                     amount1
                    when linenum = 39 and t.hc = 19 then
                     amount1
                    when linenum = 40 and t.hc = 20 then
                     amount1
                    when linenum = 41 and t.hc = 21 then
                     amount1
                    when linenum = 49 and t.hc = 22 then
                     amount1
                    when linenum = 50 and t.hc = 23 then
                     amount1
                    when linenum = 51 and t.hc = 24 then
                     amount1
                    when linenum = 52 and t.hc = 25 then
                     amount1
                    when linenum = 53 and t.hc = 26 then
                     amount1
                    when linenum = 54 and t.hc = 27 then
                     amount1
                    when linenum = 55 and t.hc = 28 then
                     amount1
                    when linenum = 56 and t.hc = 29 then
                     amount1
                    when linenum = 57 and t.hc = 30 then
                     amount1
                    when linenum = 58 and t.hc = 31 then
                     amount1
                    when linenum = 59 and t.hc = 32 then
                     amount1
                    when linenum = 60 and t.hc = 33 then
                     amount1
                    when linenum = 61 and t.hc = 34 then
                     amount1
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount2
                    when linenum = 4 and t.hc = 2 then
                     amount2
                    when linenum = 5 and t.hc = 3 then
                     amount2
                    when linenum = 6 and t.hc = 4 then
                     amount2
                    when linenum = 7 and t.hc = 5 then
                     amount2
                    when linenum = 8 and t.hc = 6 then
                     amount2
                    when linenum = 9 and t.hc = 7 then
                     amount2
                    when linenum = 10 and t.hc = 8 then
                     amount2
                    when linenum = 11 and t.hc = 9 then
                     amount2
                    when linenum = 12 and t.hc = 10 then
                     amount2
                    when linenum = 21 and t.hc = 11 then
                     amount2
                    when linenum = 27 and t.hc = 12 then
                     amount2
                    when linenum = 33 and t.hc = 13 then
                     amount2
                    when linenum = 34 and t.hc = 14 then
                     amount2
                    when linenum = 35 and t.hc = 15 then
                     amount2
                    when linenum = 36 and t.hc = 16 then
                     amount2
                    when linenum = 37 and t.hc = 17 then
                     amount2
                    when linenum = 38 and t.hc = 18 then
                     amount2
                    when linenum = 39 and t.hc = 19 then
                     amount2
                    when linenum = 40 and t.hc = 20 then
                     amount2
                    when linenum = 41 and t.hc = 21 then
                     amount2
                    when linenum = 49 and t.hc = 22 then
                     amount2
                    when linenum = 50 and t.hc = 23 then
                     amount2
                    when linenum = 51 and t.hc = 24 then
                     amount2
                    when linenum = 52 and t.hc = 25 then
                     amount2
                    when linenum = 53 and t.hc = 26 then
                     amount2
                    when linenum = 54 and t.hc = 27 then
                     amount2
                    when linenum = 55 and t.hc = 28 then
                     amount2
                    when linenum = 56 and t.hc = 29 then
                     amount2
                    when linenum = 57 and t.hc = 30 then
                     amount2
                    when linenum = 58 and t.hc = 31 then
                     amount2
                    when linenum = 59 and t.hc = 32 then
                     amount2
                    when linenum = 60 and t.hc = 33 then
                     amount2
                    when linenum = 61 and t.hc = 34 then
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(nvl(l1, 0) + nvl(l3, 0)) amount1
                     ,sum(nvl(l2, 0) + nvl(l4, 0)) amount2
                 from ods_zd_swglzzszbmx
                where substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月+本年累计
      on w1.accounts_name2 = t.nsrmc
   where w1.index_type = '国内增值税指标'
     and (linenum between 3 and 12 or linenum in (21, 27) or
         linenum between 33 and 41 or linenum between 49 and 61)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t.l12, 0)
                    when linenum = 22 and t.hc = 1 then
                     nvl(t.l10, 0)
                    when linenum = 23 and t.hc = 2 then
                     nvl(t.l10, 0)
                    when linenum = 24 and t.hc = 3 then
                     nvl(t.l10, 0)
                    when linenum = 25 and t.hc = 4 then
                     nvl(t.l10, 0)
                    when linenum = 26 and t.hc = 5 then
                     nvl(t.l10, 0)
                    when linenum = 42 and t.hc = 8 then
                     nvl(t.l10, 0)
                    when linenum = 43 and t.hc = '9' then
                     nvl(t.l10, 0)
                    when linenum = 44 and t.hc = '10' then
                     nvl(t.l10, 0)
                    when linenum = 45 and t.hc = 11 then
                     nvl(t.l10, 0)
                    when linenum = 46 and t.hc = 12 then
                     nvl(t.l10, 0)
                    when linenum = 47 and t.hc = 13 then
                     nvl(t.l10, 0)
                    when linenum = 48 and t.hc in (14, 15, 16) then
                     nvl(t.l10, 0)
                  end,
                  0)) amount1 --本月金额 
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t3.l12, 0)
                    when linenum = 22 and t3.hc = 1 then
                     nvl(t3.l10, 0)
                    when linenum = 23 and t3.hc = 2 then
                     nvl(t3.l10, 0)
                    when linenum = 24 and t3.hc = 3 then
                     nvl(t3.l10, 0)
                    when linenum = 25 and t3.hc = 4 then
                     nvl(t3.l10, 0)
                    when linenum = 26 and t3.hc = 5 then
                     nvl(t3.l10, 0)
                    when linenum = 42 and t3.hc = 8 then
                     nvl(t3.l10, 0)
                    when linenum = 43 and t3.hc = '9' then
                     nvl(t3.l10, 0)
                    when linenum = 44 and t3.hc = '10' then
                     nvl(t3.l10, 0)
                    when linenum = 45 and t3.hc = 11 then
                     nvl(t3.l10, 0)
                    when linenum = 46 and t3.hc = 12 then
                     nvl(t3.l10, 0)
                    when linenum = 47 and t3.hc = 13 then
                     nvl(t3.l10, 0)
                    when linenum = 48 and t3.hc in (14, 15, 16) then
                     nvl(t3.l10, 0)
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
  
   where w1.index_type = '国内增值税指标'
     and (linenum between 22 and 26 or linenum in (13) or
         linenum between 42 and 48)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 28 and t.hc = 1 then
                     nvl(t.l3, 0)
                    when linenum = 29 and t.hc = 4 then
                     nvl(t.l3, 0)
                    when linenum = 30 and t.hc = 9 then
                     nvl(t.l3, 0)
                    when linenum = 31 and t.hc = 10 then
                     nvl(t.l3, 0)
                    when linenum = 32 and t.hc = 11 then
                     nvl(t.l3, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 28 and t3.hc = 1 then
                     nvl(t3.l3, 0)
                    when linenum = 29 and t3.hc = 4 then
                     nvl(t3.l3, 0)
                    when linenum = 30 and t3.hc = 9 then
                     nvl(t3.l3, 0)
                    when linenum = 31 and t3.hc = 10 then
                     nvl(t3.l3, 0)
                    when linenum = 32 and t3.hc = 11 then
                     nvl(t3.l3, 0)
                  end,
                  0)) amount2 --本年累计     
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 28 and 32
  --and w1.accounts_name2 = '重庆龙湖嘉博地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 14 and t.hc = 1 then
                     nvl(t.l5, 0)
                    when linenum = 15 and t.hc = 2 then
                     nvl(t.l5, 0)
                    when linenum = 16 and t.hc = 3 then
                     nvl(t.l5, 0)
                    when linenum = 17 and t.hc = 4 then
                     nvl(t.l5, 0)
                    when linenum = 18 and t.hc = 5 then
                     nvl(t.l5, 0)
                    when linenum = 19 and t.hc = 6 then
                     nvl(t.l5, 0)
                    when linenum = 20 then
                     nvl(t.l6, 0)
                  end,
                  0)) amount1 --本月金额
         ,sum(nvl(case
                    when linenum = 14 and t3.hc = 1 then
                     nvl(t3.l5, 0)
                    when linenum = 15 and t3.hc = 2 then
                     nvl(t3.l5, 0)
                    when linenum = 16 and t3.hc = 3 then
                     nvl(t3.l5, 0)
                    when linenum = 17 and t3.hc = 4 then
                     nvl(t3.l5, 0)
                    when linenum = 18 and t3.hc = 5 then
                     nvl(t3.l5, 0)
                    when linenum = 19 and t3.hc = 6 then
                     nvl(t3.l5, 0)
                    when linenum = 20 then
                     nvl(t3.l6, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 14 and 20
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,null amount1 --本月金额
         ,null amount2 --本年累计
    from w1
   where w1.index_type = '国内增值税指标'
     and linenum between 62 and 65
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w3 as
 ( --国内消费税指标、进出口税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额
         ,0 amount2 --本年金额
    from w1
   where index_type in ('国内消费税指标', '进出口税收')),
w4 as
 ( --企业所得税指标
  select a.account_time --所属期
         ,a.platform
         ,a.area
         ,a.accounts_id_hz
         ,a.accounts_name_hz --账套汇总
         ,a.accounts_id
         ,a.accounts_name2
         ,a.accounts_name --账套
         ,a.pk_accountingbook
         ,a.zb_types --指标大类
         ,a.zb_name --指标名称
         ,a.seq --画面表示顺序
         ,a.zb_access
         ,a.source_system --来源系统
         ,a.access_form --取数表单
         ,a.access_logic --取数逻辑
         ,case
            when b.amount2 is null or
                 to_char(add_months(sysdate, -1), 'yyyy-mm') = '2020-11' then
             0
            else
             a.amount2 - b.amount2
          end amount1
         ,a.amount2
    from ( --企业所得税指标
           select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
                  ,w1.plat_name platform
                  ,w1.area_name area
                  ,w1.accounts_id_hz
                  ,w1.accounts_name_hz --账套汇总
                  ,w1.accounts_id
                  ,w1.accounts_name2
                  ,w1.accounts_name --账套
                  ,w1.pk_accountingbook
                  ,w1.index_type zb_types --指标大类
                  ,w1.index_name zb_name --指标名称
                  ,w1.linenum seq --画面表示顺序
                  ,w1.index_access zb_access
                  ,w1.source_system --来源系统
                  ,w1.access_form --取数表单
                  ,w1.access_logic --取数逻辑
                  ,0 amount1 --本月
                  ,sum(nvl(case
                             when linenum = 79 then
                              nvl(t2.yysr, 0)
                             when linenum = 80 then
                              nvl(t2.yycb, 0)
                             when linenum = 81 then
                              nvl(t2.lrze, 0)
                             when linenum = 82 then
                              nvl(t2.tdywjsdynssde, 0)
                             when linenum = 83 then
                              nvl(t2.bzssr, 0)
                             when linenum = 84 then
                              nvl(t2.mssr, 0)
                             when linenum = 85 then
                              nvl(t2.gdzcjszjtze, 0)
                             when linenum = 86 then
                              nvl(t2.mbyqndks, 0)
                             when linenum = 87 then
                              nvl(t2.sjlre, 0)
                             when linenum = 88 then
                              nvl(t2.ynsdse, 0)
                             when linenum = 89 then
                              nvl(t2.jmsdse, 0)
                             when linenum = 90 then
                              nvl(t2.sjyjnsdse, 0)
                             when linenum = 91 then
                              nvl(t2.tdywyjsdse, 0)
                             when linenum = 92 then
                              nvl(t2.ybtsdse, 0)
                             when linenum = 93 then
                              nvl(t2.zjgbqftybtsdse, 0)
                             when linenum = 94 then
                              nvl(t2.zjgftybtsdse, 0)
                             when linenum = 95 then
                              nvl(t2.czjzfpybtsdse, 0)
                             when linenum = 96 then
                              nvl(t2.zjgznbmftsdse, 0)
                             when linenum = 97 then
                              nvl(t2.fzjgbqftbl, 0)
                             when linenum = 98 then
                              nvl(t2.fzjgbqftybtsdse, 0)
                           end,
                           0)) amount2 --本年累计     
             from w1
             left join (select a.name
                              ,sum(yysr) yysr
                              ,sum(yycb) yycb
                              ,sum(lrze) lrze
                              ,sum(tdywjsdynssde) tdywjsdynssde
                              ,sum(bzssr) bzssr
                              ,sum(mssr) mssr
                              ,sum(gdzcjszjtze) gdzcjszjtze
                              ,sum(mbyqndks) mbyqndks
                              ,sum(sjlre) sjlre
                              ,sum(ynsdse) ynsdse
                              ,sum(jmsdse) jmsdse
                              ,sum(sjyjnsdse) sjyjnsdse
                              ,sum(tdywyjsdse) tdywyjsdse
                              ,sum(ybtsdse) ybtsdse
                              ,sum(zjgbqftybtsdse) zjgbqftybtsdse
                              ,sum(zjgftybtsdse) zjgftybtsdse
                              ,sum(czjzfpybtsdse) czjzfpybtsdse
                              ,sum(zjgznbmftsdse) zjgznbmftsdse
                              ,sum(fzjgbqftbl) fzjgbqftbl
                              ,sum(fzjgbqftybtsdse) fzjgbqftybtsdse
                          from ods_zd_swglqs a --企业所得税--本年累计
                              ,(select name
                                      ,max(ssq_dm) ssq_dm
                                  from ods_zd_swglqs
                                 where substr(lr_sj, 1, 7) &lt;=
                                       to_char(add_months(sysdate, -1), 'yyyy-mm')
                                 group by name) b
                         where a.name = b.name
                           and a.ssq_dm = b.ssq_dm
                         group by a.name) t2
               on w1.accounts_name2 = t2.name
            where index_type = '企业所得税指标'
              and linenum between 79 and 98
           -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
            group by w1.plat_name
                     ,w1.area_name
                     ,w1.accounts_id_hz
                     ,w1.accounts_name_hz --账套汇总
                     ,w1.accounts_id
                     ,w1.accounts_name2
                     ,w1.accounts_name --账套
                     ,w1.pk_accountingbook
                     ,w1.index_type --指标大类
                     ,w1.index_name --指标名称
                     ,w1.linenum --画面表示顺序
                     ,w1.index_access
                     ,w1.source_system --来源系统
                     ,w1.access_form --取数表单
                     ,w1.access_logic --取数逻辑
           ) a
    left join w1_2 b
      on a.accounts_id = b.org_code
     and a.seq = b.seq
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 99 and
                         t1.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t1.monthmoney, 0)
                    when linenum = 100 and t1.indexname = '企业所得税-预缴' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 101 and t1.indexname = '企业所得税-结算' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 99 and
                         t2.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t2.monthmoney, 0)
                    when linenum = 100 and t2.indexname = '企业所得税-预缴' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 101 and t2.indexname = '企业所得税-结算' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount2 --本年累计      
    from w1
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t2
      on w1.accounts_name2 = t2.unitname
     and t2.indexname = nvl(t1.indexname, t2.indexname)
   where index_type = '企业所得税指标'
     and linenum between 99 and 102
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w41 as
 ( --企业所得税指标-103
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount1, 0)
                else
                 0
              end) amount1
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount2, 0)
                else
                 0
              end) amount2
    from w1
    left join w1_1 t2
      on w1.accounts_id = t2.org_code
    left join (select accounts_id --组织
                     ,case
                        when seq = 99 then
                         -amount1
                        else
                         amount1
                      end amount1
                     ,case
                        when seq = 99 then
                         -amount2
                        else
                         amount2
                      end amount2
                 from w4
                where w4.seq in (92, 99)) t3
      on w1.accounts_id = t3.accounts_id
   where index_type = '企业所得税指标'
     and linenum = 103
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w5 as
 ( --印花税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t.jsje, 0)
                    when linenum = 110 and t.sm_mc = '购销合同' then
                     nvl(t.jsje, 0)
                    when linenum = 111 and t.sm_mc = '加工承揽合同' then
                     nvl(t.jsje, 0)
                    when linenum = 112 and t.sm_mc = '建设工程勘察设计合同' then
                     nvl(t.jsje, 0)
                    when linenum = 113 and t.sm_mc = '建筑安装工程承包合同' then
                     nvl(t.jsje, 0)
                    when linenum = 114 and t.sm_mc = '财产租赁合同' then
                     nvl(t.jsje, 0)
                    when linenum = 115 and t.sm_mc = '货物运输合同' then
                     nvl(t.jsje, 0)
                    when linenum = 116 and t.sm_mc = '借款合同' then
                     nvl(t.jsje, 0)
                    when linenum = 117 and t.sm_mc = '财产保险合同' then
                     nvl(t.jsje, 0)
                    when linenum = 118 and t.sm_mc = '技术合同' then
                     nvl(t.jsje, 0)
                    when linenum = 119 and t.sm_mc = '仓储保管合同' then
                     nvl(t.jsje, 0)
                    when linenum = 120 and t.sm_mc = '产权转移书据' then
                     nvl(t.jsje, 0)
                    when linenum = 121 and t.hc = 1000 then
                     nvl(t.bqynse, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t2.jsje, 0)
                    when linenum = 110 and t2.sm_mc = '购销合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 111 and t2.sm_mc = '加工承揽合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 112 and t2.sm_mc = '建设工程勘察设计合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 113 and t2.sm_mc = '建筑安装工程承包合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 114 and t2.sm_mc = '财产租赁合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 115 and t2.sm_mc = '货物运输合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 116 and t2.sm_mc = '借款合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 117 and t2.sm_mc = '财产保险合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 118 and t2.sm_mc = '技术合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 119 and t2.sm_mc = '仓储保管合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 120 and t2.sm_mc = '产权转移书据' then
                     nvl(t2.jsje, 0)
                    when linenum = 121 and t2.hc = 1000 then
                     nvl(t2.bqynse, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本月
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本年累计
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t2
      on w1.accounts_name2 = t2.nsrmc
     and nvl(t.hc, t2.hc) = t2.hc
   where w1.index_type = '印花税指标'
     and w1.linenum &lt;&gt; 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.fsj, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.ljj, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select gsmc
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --nc科目数据-本年+累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and km_code like ('54020109%')
                group by gsmc) t2
      on w1.accounts_name2 = t2.gsmc
  
   where w1.index_type = '印花税指标'
     and w1.linenum = 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w6 as
 ( --其他税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.fsd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.fsj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.fsj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.fsd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.fsj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.fsj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.fsj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.fsj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.fsj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.fsj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.fsj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.fsj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.fsj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.fsj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.fsj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.fsj, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.ljd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.ljj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.ljj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.ljd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.ljj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.ljj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.ljj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.ljj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.ljj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.ljj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.ljj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.ljj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.ljj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.ljj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.ljj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.ljj, 0)
                    else
                     0
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljd, 0)) ljd
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --NC接口数据：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('21710401',
                                  '217106',
                                  '217108',
                                  '217107',
                                  '41010102',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '217103')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '其他税收'
     and w1.linenum not in (130, 132, 133, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t3.monthmoney, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t4.monthmoney, 0)
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t3
      on w1.accounts_name2 = t3.unitname
  
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t4
      on w1.accounts_name2 = t4.unitname
  
   where w1.index_type = '其他税收'
     and w1.linenum in (133)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t1.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t1.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t1.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t1.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t1.ybse_bq, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t2.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t2.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t2.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t2.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t2.ybse_bq, 0)
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本月
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t1
      on w1.accounts_name2 = t1.nsrmc
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本年累计
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t2
      on w1.accounts_name2 = t2.nsrmc
  
   where w1.index_type = '其他税收'
     and w1.linenum in (130, 132, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w7 as
 ( --代扣代缴税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.fsj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.ljj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('217105', '217120')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '代扣代缴税收'
  -- and w1.accounts_name2 = '上海恒卓房地产有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w8 as
 ( --其他指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t3.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t1.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t4.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t2.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t2
      on w1.accounts_name2 = t2.unitname
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本月
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '本月') t3
      on w1.pk_accountingbook = t3.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本年累计
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '累计') t4
      on w1.pk_accountingbook = t4.pk_accountingbook
  
   where index_type = '其他指标'
     and linenum in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.fsj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.fsd, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.fsd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.fsj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.fsd, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.ljj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.ljj, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.ljj, 0) --+ t3.amount2
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.ljj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.ljd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.ljj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.ljd, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(ljj, 0)) ljj
                     ,sum(nvl(ljd, 0)) ljd
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and (substr(km_code, 1, 4) in
                      ('1501', '1502', '1211', '1233', '1251', '1281') or
                      km_code in ('217105', '218111'))
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '其他指标'
     and linenum not in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w81 as
 (select w8.account_time --所属期
        ,w8.platform
        ,w8.area
        ,w8.accounts_id_hz
        ,w8.accounts_name_hz --账套汇总
        ,w8.accounts_id
        ,w8.accounts_name2
        ,w8.accounts_name --账套
        ,w8.pk_accountingbook
        ,w8.zb_types --指标大类
        ,w8.zb_name --指标名称
        ,w8.seq --画面表示顺序
        ,w8.zb_access
        ,w8.source_system --来源系统
        ,w8.access_form --取数表单
        ,w8.access_logic --取数逻辑
        ,case
           when w8.seq = 188 then
            w8.amount1 + t.amount1
           else
            w8.amount1
         end amount1
        ,case
           when w8.seq = 188 then
            w8.amount2 + t.amount2
           else
            w8.amount2
         end amount2
    from w8
    left join (select * from w6 where w6.seq = 151) t --
      on w8.accounts_id = t.accounts_id),
w9 as
 ( --财务指标（只填写累计或期末余额）
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 193 then
                     nvl(t2.yysr_lj, 0)
                    when linenum = 196 then
                     nvl(t2.cwfy_lj, 0)
                    when linenum = 197 then
                     nvl(t2.tzsy_lj, 0)
                    when linenum = 198 then
                     nvl(t2.lrze_lj, 0)
                    when linenum = 199 then
                     nvl(t1.zczj, 0)
                    when linenum = 200 then
                     nvl(t1.yszk, 0)
                    when linenum = 201 then
                     nvl(t1.ch, 0)
                    when linenum = 202 then
                     nvl(t.amount2, 0)
                    when linenum = 204 then
                     nvl(t1.fzhj, 0)
                    else
                     0
                  end,
                  0)) amount2 --本年金额 
    from w1
    left join (select * from w8 where w8.seq = 191) t --
      on w1.accounts_id = t.accounts_id
    left join (select *
                 from ods_nc_ogg_balance_sheet --资产负债表（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and sj = '期末') t1
      on w1.pk_accountingbook = t1.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_income_amount --利润表（本年）
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')) t2
      on w1.pk_accountingbook = t2.pk_accountingbook
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum not in (194, 195, 203)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 194 and t.km_code = '5401' then
                     amount2
                    when linenum = 195 and t.km_code = '5101' then
                     amount2
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select gsmc
                     ,substr(km_code, 1, 4) km_code
                     ,sum(nvl(ljj, 0) - nvl(ljd, 0)) amount2
                 from ods_zd_ncglsubjectbalance --nc科目数据（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and substr(km_code, 1, 4) in ('5401', '5101')
                group by gsmc
                        ,substr(km_code, 1, 4)) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum in (194, 195)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w91 as
 ( --财务指标（只填写累计或期末余额）-203
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1
         ,sum(nvl(case
                    when seq = 202 then
                     -amount2
                    else
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select * from w9 where seq in (201, 202)) b
      on w1.pk_accountingbook = b.pk_accountingbook
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum = 203
  -- and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  )

select a.account_time --所属期
      ,a.platform --平台
      ,a.area --地区
      ,a.accounts_id_hz   org_code_hz
      ,a.accounts_name_hz org_hz --账套汇总
      ,a.accounts_id      org_code
       --,accounts_name2
      ,a.accounts_name org --账套
       --,pk_accountingbook
      ,a.zb_types --指标大类
      ,a.zb_name --指标名称
      ,a.seq --画面表示顺序
      ,a.zb_access
      ,a.source_system --来源系统
      ,a.access_form --取数表单
      ,a.access_logic --取数逻辑
      ,a.amount1
      ,a.amount2
			,b.amount1 amount3
			,b.amount2 amount4
      ,to_char(add_months(sysdate, -1), 'yyyy') || 'Q' ||
       to_char(add_months(sysdate, -1), 'q') quarter
  from (select *
          from w2
        union all
        select *
          from w3
        union all
        select *
          from w4 --企业所得税指标
        union all
        select *
          from w41 --企业所得税指标-103
        union all
        select *
          from w5 --印花税指标
        union all
        select *
          from w6 --其他税收
        union all
        select *
          from w7 --代扣代缴税收
        union all
        select *
          from w81 --其他指标
        union all
        select *
          from w9 --财务指标（只填写累计或期末余额）
        union all
        select *
          from w91 --财务指标（只填写累计或期末余额）-203
        ) a
  left join (select *
               from dw_zdsy_monthly_tax_report
              where account_time =
                    to_char(add_months(sysdate, -2), 'yyyy-mm')) b
    on a.accounts_id = b.org_code
   and a.seq = b.seq
--where accounts_name2 = '重庆龙湖科恒地产发展有限公司'
</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>608</xloc>
      <yloc>672</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>重点税源企业税收信息（月报）明细-'企业所得税指标','其他指标'</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle</connection>
    <sql>----重点税源
with w0 as
 ( --平台、地区、账套、账簿、航道
  select nvl(c.plat_code, d.plat_code) plat_code
         ,nvl(c.plat_name, d.plat_name) plat_name --平台
         ,b.area_code
         ,b.area_name --地区 
         ,b.accounts_id
         ,b.accounts_name --账套
         ,b.chanal
         ,b.chanal_desc --航道
         ,b.accountingbookcode
         ,b.accountingbookname --账簿
         ,b.pk_accountingbook
    from ba_area_accounts b --地区账套对应表
    left join (select * from ba_plat_area where area_name &lt;&gt; '集团') c --取非集团地区对应的平台
      on b.area_code = c.area_code
    left join (select * from ba_plat_area_fkdw where area_name = '集团') d --取集团下公司对应的平台
      on b.accounts_name = d.fkdw),
w01 as
 ( --账套汇总、账套
  select accounts_id || 'A' accounts_id_hz
         ,accounts_name || '(汇总)' accounts_name_hz --账套汇总
         ,accounts_id
         ,accounts_name --账套
    from w0
   where accounts_id in (select accounts_id
                           from (select substr(accounts_id, 1, 5) accounts_id
                                       ,count(*)
                                   from w0
                                  group by substr(accounts_id, 1, 5)
                                 having count(*) > 1))),
w02 as
 ( --平台、地区、账套汇总、账套
  select w0.plat_code
         ,w0.plat_name --平台
         ,w0.area_code
         ,w0.area_name --地区
         ,nvl(w01.accounts_id_hz, w0.accounts_id) accounts_id_hz
         ,nvl(w01.accounts_name_hz, w0.accounts_name) accounts_name_hz
         ,w0.accounts_id
         ,w0.accounts_name --账套
         ,w0.chanal
         ,w0.chanal_desc --航道
         ,w0.accountingbookcode
         ,w0.accountingbookname --账簿
         ,w0.pk_accountingbook
    from w0
    left join w01
      on w0.accounts_id like w01.accounts_id || '%'),
w1 as
 (select b.*
        ,w02.plat_name --平台
        ,w02.area_code
        ,w02.area_name --地区 
        ,w02.accounts_id_hz
        ,w02.accounts_id_hz || '-' || w02.accounts_name_hz accounts_name_hz --账套汇总
        ,w02.accounts_id
        ,w02.accounts_name accounts_name2
        ,w02.accounts_id || '-' || w02.accounts_name accounts_name --账套
        ,w02.chanal_desc --航道
        ,w02.pk_accountingbook
    from ( --指标名称
          select *
            from dw_zdsy_index_dim
           where module = 1 --模块分类（1-企业税收信息，2-企业景气调查问卷，3-财务信息）
             and index_type in
                 ('企业所得税指标','其他指标')) b
        ,w02
   where length(w02.accounts_id) > 2
  --and accounts_id_hz in ('01001A','00001','00002') 
  ),
w1_1 as
 ( --上期报表的该指标(期末欠税余额)累计数
  select org_code
         ,seq
         ,amount1
         ,amount2
         ,amount3
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq = 103
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w1_2 as
 ( --上期报表的企业所得税指标累计值between 79 and 98
  select org_code
         ,seq
         ,amount2
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq between 79 and 98
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w2 as
 ( --国内增值税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount1
                    when linenum = 4 and t.hc = 2 then
                     amount1
                    when linenum = 5 and t.hc = 3 then
                     amount1
                    when linenum = 6 and t.hc = 4 then
                     amount1
                    when linenum = 7 and t.hc = 5 then
                     amount1
                    when linenum = 8 and t.hc = 6 then
                     amount1
                    when linenum = 9 and t.hc = 7 then
                     amount1
                    when linenum = 10 and t.hc = 8 then
                     amount1
                    when linenum = 11 and t.hc = 9 then
                     amount1
                    when linenum = 12 and t.hc = 10 then
                     amount1
                    when linenum = 21 and t.hc = 11 then
                     amount1
                    when linenum = 27 and t.hc = 12 then
                     amount1
                    when linenum = 33 and t.hc = 13 then
                     amount1
                    when linenum = 34 and t.hc = 14 then
                     amount1
                    when linenum = 35 and t.hc = 15 then
                     amount1
                    when linenum = 36 and t.hc = 16 then
                     amount1
                    when linenum = 37 and t.hc = 17 then
                     amount1
                    when linenum = 38 and t.hc = 18 then
                     amount1
                    when linenum = 39 and t.hc = 19 then
                     amount1
                    when linenum = 40 and t.hc = 20 then
                     amount1
                    when linenum = 41 and t.hc = 21 then
                     amount1
                    when linenum = 49 and t.hc = 22 then
                     amount1
                    when linenum = 50 and t.hc = 23 then
                     amount1
                    when linenum = 51 and t.hc = 24 then
                     amount1
                    when linenum = 52 and t.hc = 25 then
                     amount1
                    when linenum = 53 and t.hc = 26 then
                     amount1
                    when linenum = 54 and t.hc = 27 then
                     amount1
                    when linenum = 55 and t.hc = 28 then
                     amount1
                    when linenum = 56 and t.hc = 29 then
                     amount1
                    when linenum = 57 and t.hc = 30 then
                     amount1
                    when linenum = 58 and t.hc = 31 then
                     amount1
                    when linenum = 59 and t.hc = 32 then
                     amount1
                    when linenum = 60 and t.hc = 33 then
                     amount1
                    when linenum = 61 and t.hc = 34 then
                     amount1
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount2
                    when linenum = 4 and t.hc = 2 then
                     amount2
                    when linenum = 5 and t.hc = 3 then
                     amount2
                    when linenum = 6 and t.hc = 4 then
                     amount2
                    when linenum = 7 and t.hc = 5 then
                     amount2
                    when linenum = 8 and t.hc = 6 then
                     amount2
                    when linenum = 9 and t.hc = 7 then
                     amount2
                    when linenum = 10 and t.hc = 8 then
                     amount2
                    when linenum = 11 and t.hc = 9 then
                     amount2
                    when linenum = 12 and t.hc = 10 then
                     amount2
                    when linenum = 21 and t.hc = 11 then
                     amount2
                    when linenum = 27 and t.hc = 12 then
                     amount2
                    when linenum = 33 and t.hc = 13 then
                     amount2
                    when linenum = 34 and t.hc = 14 then
                     amount2
                    when linenum = 35 and t.hc = 15 then
                     amount2
                    when linenum = 36 and t.hc = 16 then
                     amount2
                    when linenum = 37 and t.hc = 17 then
                     amount2
                    when linenum = 38 and t.hc = 18 then
                     amount2
                    when linenum = 39 and t.hc = 19 then
                     amount2
                    when linenum = 40 and t.hc = 20 then
                     amount2
                    when linenum = 41 and t.hc = 21 then
                     amount2
                    when linenum = 49 and t.hc = 22 then
                     amount2
                    when linenum = 50 and t.hc = 23 then
                     amount2
                    when linenum = 51 and t.hc = 24 then
                     amount2
                    when linenum = 52 and t.hc = 25 then
                     amount2
                    when linenum = 53 and t.hc = 26 then
                     amount2
                    when linenum = 54 and t.hc = 27 then
                     amount2
                    when linenum = 55 and t.hc = 28 then
                     amount2
                    when linenum = 56 and t.hc = 29 then
                     amount2
                    when linenum = 57 and t.hc = 30 then
                     amount2
                    when linenum = 58 and t.hc = 31 then
                     amount2
                    when linenum = 59 and t.hc = 32 then
                     amount2
                    when linenum = 60 and t.hc = 33 then
                     amount2
                    when linenum = 61 and t.hc = 34 then
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(nvl(l1, 0) + nvl(l3, 0)) amount1
                     ,sum(nvl(l2, 0) + nvl(l4, 0)) amount2
                 from ods_zd_swglzzszbmx
                where substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月+本年累计
      on w1.accounts_name2 = t.nsrmc
   where w1.index_type = '国内增值税指标'
     and (linenum between 3 and 12 or linenum in (21, 27) or
         linenum between 33 and 41 or linenum between 49 and 61)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t.l12, 0)
                    when linenum = 22 and t.hc = 1 then
                     nvl(t.l10, 0)
                    when linenum = 23 and t.hc = 2 then
                     nvl(t.l10, 0)
                    when linenum = 24 and t.hc = 3 then
                     nvl(t.l10, 0)
                    when linenum = 25 and t.hc = 4 then
                     nvl(t.l10, 0)
                    when linenum = 26 and t.hc = 5 then
                     nvl(t.l10, 0)
                    when linenum = 42 and t.hc = 8 then
                     nvl(t.l10, 0)
                    when linenum = 43 and t.hc = '9' then
                     nvl(t.l10, 0)
                    when linenum = 44 and t.hc = '10' then
                     nvl(t.l10, 0)
                    when linenum = 45 and t.hc = 11 then
                     nvl(t.l10, 0)
                    when linenum = 46 and t.hc = 12 then
                     nvl(t.l10, 0)
                    when linenum = 47 and t.hc = 13 then
                     nvl(t.l10, 0)
                    when linenum = 48 and t.hc in (14, 15, 16) then
                     nvl(t.l10, 0)
                  end,
                  0)) amount1 --本月金额 
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t3.l12, 0)
                    when linenum = 22 and t3.hc = 1 then
                     nvl(t3.l10, 0)
                    when linenum = 23 and t3.hc = 2 then
                     nvl(t3.l10, 0)
                    when linenum = 24 and t3.hc = 3 then
                     nvl(t3.l10, 0)
                    when linenum = 25 and t3.hc = 4 then
                     nvl(t3.l10, 0)
                    when linenum = 26 and t3.hc = 5 then
                     nvl(t3.l10, 0)
                    when linenum = 42 and t3.hc = 8 then
                     nvl(t3.l10, 0)
                    when linenum = 43 and t3.hc = '9' then
                     nvl(t3.l10, 0)
                    when linenum = 44 and t3.hc = '10' then
                     nvl(t3.l10, 0)
                    when linenum = 45 and t3.hc = 11 then
                     nvl(t3.l10, 0)
                    when linenum = 46 and t3.hc = 12 then
                     nvl(t3.l10, 0)
                    when linenum = 47 and t3.hc = 13 then
                     nvl(t3.l10, 0)
                    when linenum = 48 and t3.hc in (14, 15, 16) then
                     nvl(t3.l10, 0)
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
  
   where w1.index_type = '国内增值税指标'
     and (linenum between 22 and 26 or linenum in (13) or
         linenum between 42 and 48)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 28 and t.hc = 1 then
                     nvl(t.l3, 0)
                    when linenum = 29 and t.hc = 4 then
                     nvl(t.l3, 0)
                    when linenum = 30 and t.hc = 9 then
                     nvl(t.l3, 0)
                    when linenum = 31 and t.hc = 10 then
                     nvl(t.l3, 0)
                    when linenum = 32 and t.hc = 11 then
                     nvl(t.l3, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 28 and t3.hc = 1 then
                     nvl(t3.l3, 0)
                    when linenum = 29 and t3.hc = 4 then
                     nvl(t3.l3, 0)
                    when linenum = 30 and t3.hc = 9 then
                     nvl(t3.l3, 0)
                    when linenum = 31 and t3.hc = 10 then
                     nvl(t3.l3, 0)
                    when linenum = 32 and t3.hc = 11 then
                     nvl(t3.l3, 0)
                  end,
                  0)) amount2 --本年累计     
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 28 and 32
  --and w1.accounts_name2 = '重庆龙湖嘉博地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 14 and t.hc = 1 then
                     nvl(t.l5, 0)
                    when linenum = 15 and t.hc = 2 then
                     nvl(t.l5, 0)
                    when linenum = 16 and t.hc = 3 then
                     nvl(t.l5, 0)
                    when linenum = 17 and t.hc = 4 then
                     nvl(t.l5, 0)
                    when linenum = 18 and t.hc = 5 then
                     nvl(t.l5, 0)
                    when linenum = 19 and t.hc = 6 then
                     nvl(t.l5, 0)
                    when linenum = 20 then
                     nvl(t.l6, 0)
                  end,
                  0)) amount1 --本月金额
         ,sum(nvl(case
                    when linenum = 14 and t3.hc = 1 then
                     nvl(t3.l5, 0)
                    when linenum = 15 and t3.hc = 2 then
                     nvl(t3.l5, 0)
                    when linenum = 16 and t3.hc = 3 then
                     nvl(t3.l5, 0)
                    when linenum = 17 and t3.hc = 4 then
                     nvl(t3.l5, 0)
                    when linenum = 18 and t3.hc = 5 then
                     nvl(t3.l5, 0)
                    when linenum = 19 and t3.hc = 6 then
                     nvl(t3.l5, 0)
                    when linenum = 20 then
                     nvl(t3.l6, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 14 and 20
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,null amount1 --本月金额
         ,null amount2 --本年累计
    from w1
   where w1.index_type = '国内增值税指标'
     and linenum between 62 and 65
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w3 as
 ( --国内消费税指标、进出口税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额
         ,0 amount2 --本年金额
    from w1
   where index_type in ('国内消费税指标', '进出口税收')),
w4 as
 ( --企业所得税指标
  select a.account_time --所属期
         ,a.platform
         ,a.area
         ,a.accounts_id_hz
         ,a.accounts_name_hz --账套汇总
         ,a.accounts_id
         ,a.accounts_name2
         ,a.accounts_name --账套
         ,a.pk_accountingbook
         ,a.zb_types --指标大类
         ,a.zb_name --指标名称
         ,a.seq --画面表示顺序
         ,a.zb_access
         ,a.source_system --来源系统
         ,a.access_form --取数表单
         ,a.access_logic --取数逻辑
         ,case
            when b.amount2 is null or
                 to_char(add_months(sysdate, -1), 'yyyy-mm') = '2020-11' then
             0
            else
             a.amount2 - b.amount2
          end amount1
         ,a.amount2
    from ( --企业所得税指标
           select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
                  ,w1.plat_name platform
                  ,w1.area_name area
                  ,w1.accounts_id_hz
                  ,w1.accounts_name_hz --账套汇总
                  ,w1.accounts_id
                  ,w1.accounts_name2
                  ,w1.accounts_name --账套
                  ,w1.pk_accountingbook
                  ,w1.index_type zb_types --指标大类
                  ,w1.index_name zb_name --指标名称
                  ,w1.linenum seq --画面表示顺序
                  ,w1.index_access zb_access
                  ,w1.source_system --来源系统
                  ,w1.access_form --取数表单
                  ,w1.access_logic --取数逻辑
                  ,0 amount1 --本月
                  ,sum(nvl(case
                             when linenum = 79 then
                              nvl(t2.yysr, 0)
                             when linenum = 80 then
                              nvl(t2.yycb, 0)
                             when linenum = 81 then
                              nvl(t2.lrze, 0)
                             when linenum = 82 then
                              nvl(t2.tdywjsdynssde, 0)
                             when linenum = 83 then
                              nvl(t2.bzssr, 0)
                             when linenum = 84 then
                              nvl(t2.mssr, 0)
                             when linenum = 85 then
                              nvl(t2.gdzcjszjtze, 0)
                             when linenum = 86 then
                              nvl(t2.mbyqndks, 0)
                             when linenum = 87 then
                              nvl(t2.sjlre, 0)
                             when linenum = 88 then
                              nvl(t2.ynsdse, 0)
                             when linenum = 89 then
                              nvl(t2.jmsdse, 0)
                             when linenum = 90 then
                              nvl(t2.sjyjnsdse, 0)
                             when linenum = 91 then
                              nvl(t2.tdywyjsdse, 0)
                             when linenum = 92 then
                              nvl(t2.ybtsdse, 0)
                             when linenum = 93 then
                              nvl(t2.zjgbqftybtsdse, 0)
                             when linenum = 94 then
                              nvl(t2.zjgftybtsdse, 0)
                             when linenum = 95 then
                              nvl(t2.czjzfpybtsdse, 0)
                             when linenum = 96 then
                              nvl(t2.zjgznbmftsdse, 0)
                             when linenum = 97 then
                              nvl(t2.fzjgbqftbl, 0)
                             when linenum = 98 then
                              nvl(t2.fzjgbqftybtsdse, 0)
                           end,
                           0)) amount2 --本年累计     
             from w1
             left join (select a.name
                              ,sum(yysr) yysr
                              ,sum(yycb) yycb
                              ,sum(lrze) lrze
                              ,sum(tdywjsdynssde) tdywjsdynssde
                              ,sum(bzssr) bzssr
                              ,sum(mssr) mssr
                              ,sum(gdzcjszjtze) gdzcjszjtze
                              ,sum(mbyqndks) mbyqndks
                              ,sum(sjlre) sjlre
                              ,sum(ynsdse) ynsdse
                              ,sum(jmsdse) jmsdse
                              ,sum(sjyjnsdse) sjyjnsdse
                              ,sum(tdywyjsdse) tdywyjsdse
                              ,sum(ybtsdse) ybtsdse
                              ,sum(zjgbqftybtsdse) zjgbqftybtsdse
                              ,sum(zjgftybtsdse) zjgftybtsdse
                              ,sum(czjzfpybtsdse) czjzfpybtsdse
                              ,sum(zjgznbmftsdse) zjgznbmftsdse
                              ,sum(fzjgbqftbl) fzjgbqftbl
                              ,sum(fzjgbqftybtsdse) fzjgbqftybtsdse
                          from ods_zd_swglqs a --企业所得税--本年累计
                              ,(select name
                                      ,max(ssq_dm) ssq_dm
                                  from ods_zd_swglqs
                                 where substr(lr_sj, 1, 7) &lt;=
                                       to_char(add_months(sysdate, -1), 'yyyy-mm')
                                 group by name) b
                         where a.name = b.name
                           and a.ssq_dm = b.ssq_dm
                         group by a.name) t2
               on w1.accounts_name2 = t2.name
            where index_type = '企业所得税指标'
              and linenum between 79 and 98
           -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
            group by w1.plat_name
                     ,w1.area_name
                     ,w1.accounts_id_hz
                     ,w1.accounts_name_hz --账套汇总
                     ,w1.accounts_id
                     ,w1.accounts_name2
                     ,w1.accounts_name --账套
                     ,w1.pk_accountingbook
                     ,w1.index_type --指标大类
                     ,w1.index_name --指标名称
                     ,w1.linenum --画面表示顺序
                     ,w1.index_access
                     ,w1.source_system --来源系统
                     ,w1.access_form --取数表单
                     ,w1.access_logic --取数逻辑
           ) a
    left join w1_2 b
      on a.accounts_id = b.org_code
     and a.seq = b.seq
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 99 and
                         t1.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t1.monthmoney, 0)
                    when linenum = 100 and t1.indexname = '企业所得税-预缴' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 101 and t1.indexname = '企业所得税-结算' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 99 and
                         t2.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t2.monthmoney, 0)
                    when linenum = 100 and t2.indexname = '企业所得税-预缴' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 101 and t2.indexname = '企业所得税-结算' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount2 --本年累计      
    from w1
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t2
      on w1.accounts_name2 = t2.unitname
     and t2.indexname = nvl(t1.indexname, t2.indexname)
   where index_type = '企业所得税指标'
     and linenum between 99 and 102
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w41 as
 ( --企业所得税指标-103
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount1, 0)
                else
                 0
              end) amount1
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount2, 0)
                else
                 0
              end) amount2
    from w1
    left join w1_1 t2
      on w1.accounts_id = t2.org_code
    left join (select accounts_id --组织
                     ,case
                        when seq = 99 then
                         -amount1
                        else
                         amount1
                      end amount1
                     ,case
                        when seq = 99 then
                         -amount2
                        else
                         amount2
                      end amount2
                 from w4
                where w4.seq in (92, 99)) t3
      on w1.accounts_id = t3.accounts_id
   where index_type = '企业所得税指标'
     and linenum = 103
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w5 as
 ( --印花税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t.jsje, 0)
                    when linenum = 110 and t.sm_mc = '购销合同' then
                     nvl(t.jsje, 0)
                    when linenum = 111 and t.sm_mc = '加工承揽合同' then
                     nvl(t.jsje, 0)
                    when linenum = 112 and t.sm_mc = '建设工程勘察设计合同' then
                     nvl(t.jsje, 0)
                    when linenum = 113 and t.sm_mc = '建筑安装工程承包合同' then
                     nvl(t.jsje, 0)
                    when linenum = 114 and t.sm_mc = '财产租赁合同' then
                     nvl(t.jsje, 0)
                    when linenum = 115 and t.sm_mc = '货物运输合同' then
                     nvl(t.jsje, 0)
                    when linenum = 116 and t.sm_mc = '借款合同' then
                     nvl(t.jsje, 0)
                    when linenum = 117 and t.sm_mc = '财产保险合同' then
                     nvl(t.jsje, 0)
                    when linenum = 118 and t.sm_mc = '技术合同' then
                     nvl(t.jsje, 0)
                    when linenum = 119 and t.sm_mc = '仓储保管合同' then
                     nvl(t.jsje, 0)
                    when linenum = 120 and t.sm_mc = '产权转移书据' then
                     nvl(t.jsje, 0)
                    when linenum = 121 and t.hc = 1000 then
                     nvl(t.bqynse, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t2.jsje, 0)
                    when linenum = 110 and t2.sm_mc = '购销合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 111 and t2.sm_mc = '加工承揽合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 112 and t2.sm_mc = '建设工程勘察设计合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 113 and t2.sm_mc = '建筑安装工程承包合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 114 and t2.sm_mc = '财产租赁合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 115 and t2.sm_mc = '货物运输合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 116 and t2.sm_mc = '借款合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 117 and t2.sm_mc = '财产保险合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 118 and t2.sm_mc = '技术合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 119 and t2.sm_mc = '仓储保管合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 120 and t2.sm_mc = '产权转移书据' then
                     nvl(t2.jsje, 0)
                    when linenum = 121 and t2.hc = 1000 then
                     nvl(t2.bqynse, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本月
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本年累计
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t2
      on w1.accounts_name2 = t2.nsrmc
     and nvl(t.hc, t2.hc) = t2.hc
   where w1.index_type = '印花税指标'
     and w1.linenum &lt;&gt; 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.fsj, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.ljj, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select gsmc
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --nc科目数据-本年+累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and km_code like ('54020109%')
                group by gsmc) t2
      on w1.accounts_name2 = t2.gsmc
  
   where w1.index_type = '印花税指标'
     and w1.linenum = 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w6 as
 ( --其他税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.fsd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.fsj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.fsj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.fsd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.fsj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.fsj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.fsj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.fsj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.fsj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.fsj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.fsj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.fsj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.fsj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.fsj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.fsj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.fsj, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.ljd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.ljj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.ljj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.ljd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.ljj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.ljj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.ljj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.ljj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.ljj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.ljj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.ljj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.ljj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.ljj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.ljj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.ljj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.ljj, 0)
                    else
                     0
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljd, 0)) ljd
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --NC接口数据：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('21710401',
                                  '217106',
                                  '217108',
                                  '217107',
                                  '41010102',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '217103')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '其他税收'
     and w1.linenum not in (130, 132, 133, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t3.monthmoney, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t4.monthmoney, 0)
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t3
      on w1.accounts_name2 = t3.unitname
  
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t4
      on w1.accounts_name2 = t4.unitname
  
   where w1.index_type = '其他税收'
     and w1.linenum in (133)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t1.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t1.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t1.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t1.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t1.ybse_bq, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t2.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t2.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t2.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t2.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t2.ybse_bq, 0)
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本月
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t1
      on w1.accounts_name2 = t1.nsrmc
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本年累计
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t2
      on w1.accounts_name2 = t2.nsrmc
  
   where w1.index_type = '其他税收'
     and w1.linenum in (130, 132, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w7 as
 ( --代扣代缴税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.fsj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.ljj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('217105', '217120')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '代扣代缴税收'
  -- and w1.accounts_name2 = '上海恒卓房地产有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w8 as
 ( --其他指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t3.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t1.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t4.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t2.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t2
      on w1.accounts_name2 = t2.unitname
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本月
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '本月') t3
      on w1.pk_accountingbook = t3.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本年累计
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '累计') t4
      on w1.pk_accountingbook = t4.pk_accountingbook
  
   where index_type = '其他指标'
     and linenum in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.fsj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.fsd, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.fsd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.fsj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.fsd, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.ljj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.ljj, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.ljj, 0) --+ t3.amount2
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.ljj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.ljd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.ljj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.ljd, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(ljj, 0)) ljj
                     ,sum(nvl(ljd, 0)) ljd
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and (substr(km_code, 1, 4) in
                      ('1501', '1502', '1211', '1233', '1251', '1281') or
                      km_code in ('217105', '218111'))
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '其他指标'
     and linenum not in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w81 as
 (select w8.account_time --所属期
        ,w8.platform
        ,w8.area
        ,w8.accounts_id_hz
        ,w8.accounts_name_hz --账套汇总
        ,w8.accounts_id
        ,w8.accounts_name2
        ,w8.accounts_name --账套
        ,w8.pk_accountingbook
        ,w8.zb_types --指标大类
        ,w8.zb_name --指标名称
        ,w8.seq --画面表示顺序
        ,w8.zb_access
        ,w8.source_system --来源系统
        ,w8.access_form --取数表单
        ,w8.access_logic --取数逻辑
        ,case
           when w8.seq = 188 then
            w8.amount1 + t.amount1
           else
            w8.amount1
         end amount1
        ,case
           when w8.seq = 188 then
            w8.amount2 + t.amount2
           else
            w8.amount2
         end amount2
    from w8
    left join (select * from w6 where w6.seq = 151) t --
      on w8.accounts_id = t.accounts_id),
w9 as
 ( --财务指标（只填写累计或期末余额）
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 193 then
                     nvl(t2.yysr_lj, 0)
                    when linenum = 196 then
                     nvl(t2.cwfy_lj, 0)
                    when linenum = 197 then
                     nvl(t2.tzsy_lj, 0)
                    when linenum = 198 then
                     nvl(t2.lrze_lj, 0)
                    when linenum = 199 then
                     nvl(t1.zczj, 0)
                    when linenum = 200 then
                     nvl(t1.yszk, 0)
                    when linenum = 201 then
                     nvl(t1.ch, 0)
                    when linenum = 202 then
                     nvl(t.amount2, 0)
                    when linenum = 204 then
                     nvl(t1.fzhj, 0)
                    else
                     0
                  end,
                  0)) amount2 --本年金额 
    from w1
    left join (select * from w8 where w8.seq = 191) t --
      on w1.accounts_id = t.accounts_id
    left join (select *
                 from ods_nc_ogg_balance_sheet --资产负债表（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and sj = '期末') t1
      on w1.pk_accountingbook = t1.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_income_amount --利润表（本年）
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')) t2
      on w1.pk_accountingbook = t2.pk_accountingbook
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum not in (194, 195, 203)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 194 and t.km_code = '5401' then
                     amount2
                    when linenum = 195 and t.km_code = '5101' then
                     amount2
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select gsmc
                     ,substr(km_code, 1, 4) km_code
                     ,sum(nvl(ljj, 0) - nvl(ljd, 0)) amount2
                 from ods_zd_ncglsubjectbalance --nc科目数据（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and substr(km_code, 1, 4) in ('5401', '5101')
                group by gsmc
                        ,substr(km_code, 1, 4)) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum in (194, 195)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w91 as
 ( --财务指标（只填写累计或期末余额）-203
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1
         ,sum(nvl(case
                    when seq = 202 then
                     -amount2
                    else
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select * from w9 where seq in (201, 202)) b
      on w1.pk_accountingbook = b.pk_accountingbook
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum = 203
  -- and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  )

select a.account_time --所属期
      ,a.platform --平台
      ,a.area --地区
      ,a.accounts_id_hz   org_code_hz
      ,a.accounts_name_hz org_hz --账套汇总
      ,a.accounts_id      org_code
       --,accounts_name2
      ,a.accounts_name org --账套
       --,pk_accountingbook
      ,a.zb_types --指标大类
      ,a.zb_name --指标名称
      ,a.seq --画面表示顺序
      ,a.zb_access
      ,a.source_system --来源系统
      ,a.access_form --取数表单
      ,a.access_logic --取数逻辑
      ,a.amount1
      ,a.amount2
			,b.amount1 amount3
			,b.amount2 amount4
      ,to_char(add_months(sysdate, -1), 'yyyy') || 'Q' ||
       to_char(add_months(sysdate, -1), 'q') quarter
  from (select *
          from w2
        union all
        select *
          from w3
        union all
        select *
          from w4 --企业所得税指标
        union all
        select *
          from w41 --企业所得税指标-103
        union all
        select *
          from w5 --印花税指标
        union all
        select *
          from w6 --其他税收
        union all
        select *
          from w7 --代扣代缴税收
        union all
        select *
          from w81 --其他指标
        union all
        select *
          from w9 --财务指标（只填写累计或期末余额）
        union all
        select *
          from w91 --财务指标（只填写累计或期末余额）-203
        ) a
  left join (select *
               from dw_zdsy_monthly_tax_report
              where account_time =
                    to_char(add_months(sysdate, -2), 'yyyy-mm')) b
    on a.accounts_id = b.org_code
   and a.seq = b.seq
--where accounts_name2 = '重庆龙湖科恒地产发展有限公司'
</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>608</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>重点税源企业税收信息（月报）明细-代扣代缴税收</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle</connection>
    <sql>----重点税源
with w0 as
 ( --平台、地区、账套、账簿、航道
  select nvl(c.plat_code, d.plat_code) plat_code
         ,nvl(c.plat_name, d.plat_name) plat_name --平台
         ,b.area_code
         ,b.area_name --地区 
         ,b.accounts_id
         ,b.accounts_name --账套
         ,b.chanal
         ,b.chanal_desc --航道
         ,b.accountingbookcode
         ,b.accountingbookname --账簿
         ,b.pk_accountingbook
    from ba_area_accounts b --地区账套对应表
    left join (select * from ba_plat_area where area_name &lt;&gt; '集团') c --取非集团地区对应的平台
      on b.area_code = c.area_code
    left join (select * from ba_plat_area_fkdw where area_name = '集团') d --取集团下公司对应的平台
      on b.accounts_name = d.fkdw),
w01 as
 ( --账套汇总、账套
  select accounts_id || 'A' accounts_id_hz
         ,accounts_name || '(汇总)' accounts_name_hz --账套汇总
         ,accounts_id
         ,accounts_name --账套
    from w0
   where accounts_id in (select accounts_id
                           from (select substr(accounts_id, 1, 5) accounts_id
                                       ,count(*)
                                   from w0
                                  group by substr(accounts_id, 1, 5)
                                 having count(*) > 1))),
w02 as
 ( --平台、地区、账套汇总、账套
  select w0.plat_code
         ,w0.plat_name --平台
         ,w0.area_code
         ,w0.area_name --地区
         ,nvl(w01.accounts_id_hz, w0.accounts_id) accounts_id_hz
         ,nvl(w01.accounts_name_hz, w0.accounts_name) accounts_name_hz
         ,w0.accounts_id
         ,w0.accounts_name --账套
         ,w0.chanal
         ,w0.chanal_desc --航道
         ,w0.accountingbookcode
         ,w0.accountingbookname --账簿
         ,w0.pk_accountingbook
    from w0
    left join w01
      on w0.accounts_id like w01.accounts_id || '%'),
w1 as
 (select b.*
        ,w02.plat_name --平台
        ,w02.area_code
        ,w02.area_name --地区 
        ,w02.accounts_id_hz
        ,w02.accounts_id_hz || '-' || w02.accounts_name_hz accounts_name_hz --账套汇总
        ,w02.accounts_id
        ,w02.accounts_name accounts_name2
        ,w02.accounts_id || '-' || w02.accounts_name accounts_name --账套
        ,w02.chanal_desc --航道
        ,w02.pk_accountingbook
    from ( --指标名称
          select *
            from dw_zdsy_index_dim
           where module = 1 --模块分类（1-企业税收信息，2-企业景气调查问卷，3-财务信息）
             and index_type in
                 ('代扣代缴税收')) b
        ,w02
   where length(w02.accounts_id) > 2
  --and accounts_id_hz in ('01001A','00001','00002') 
  ),
w1_1 as
 ( --上期报表的该指标(期末欠税余额)累计数
  select org_code
         ,seq
         ,amount1
         ,amount2
         ,amount3
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq = 103
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w1_2 as
 ( --上期报表的企业所得税指标累计值between 79 and 98
  select org_code
         ,seq
         ,amount2
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq between 79 and 98
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w2 as
 ( --国内增值税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount1
                    when linenum = 4 and t.hc = 2 then
                     amount1
                    when linenum = 5 and t.hc = 3 then
                     amount1
                    when linenum = 6 and t.hc = 4 then
                     amount1
                    when linenum = 7 and t.hc = 5 then
                     amount1
                    when linenum = 8 and t.hc = 6 then
                     amount1
                    when linenum = 9 and t.hc = 7 then
                     amount1
                    when linenum = 10 and t.hc = 8 then
                     amount1
                    when linenum = 11 and t.hc = 9 then
                     amount1
                    when linenum = 12 and t.hc = 10 then
                     amount1
                    when linenum = 21 and t.hc = 11 then
                     amount1
                    when linenum = 27 and t.hc = 12 then
                     amount1
                    when linenum = 33 and t.hc = 13 then
                     amount1
                    when linenum = 34 and t.hc = 14 then
                     amount1
                    when linenum = 35 and t.hc = 15 then
                     amount1
                    when linenum = 36 and t.hc = 16 then
                     amount1
                    when linenum = 37 and t.hc = 17 then
                     amount1
                    when linenum = 38 and t.hc = 18 then
                     amount1
                    when linenum = 39 and t.hc = 19 then
                     amount1
                    when linenum = 40 and t.hc = 20 then
                     amount1
                    when linenum = 41 and t.hc = 21 then
                     amount1
                    when linenum = 49 and t.hc = 22 then
                     amount1
                    when linenum = 50 and t.hc = 23 then
                     amount1
                    when linenum = 51 and t.hc = 24 then
                     amount1
                    when linenum = 52 and t.hc = 25 then
                     amount1
                    when linenum = 53 and t.hc = 26 then
                     amount1
                    when linenum = 54 and t.hc = 27 then
                     amount1
                    when linenum = 55 and t.hc = 28 then
                     amount1
                    when linenum = 56 and t.hc = 29 then
                     amount1
                    when linenum = 57 and t.hc = 30 then
                     amount1
                    when linenum = 58 and t.hc = 31 then
                     amount1
                    when linenum = 59 and t.hc = 32 then
                     amount1
                    when linenum = 60 and t.hc = 33 then
                     amount1
                    when linenum = 61 and t.hc = 34 then
                     amount1
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount2
                    when linenum = 4 and t.hc = 2 then
                     amount2
                    when linenum = 5 and t.hc = 3 then
                     amount2
                    when linenum = 6 and t.hc = 4 then
                     amount2
                    when linenum = 7 and t.hc = 5 then
                     amount2
                    when linenum = 8 and t.hc = 6 then
                     amount2
                    when linenum = 9 and t.hc = 7 then
                     amount2
                    when linenum = 10 and t.hc = 8 then
                     amount2
                    when linenum = 11 and t.hc = 9 then
                     amount2
                    when linenum = 12 and t.hc = 10 then
                     amount2
                    when linenum = 21 and t.hc = 11 then
                     amount2
                    when linenum = 27 and t.hc = 12 then
                     amount2
                    when linenum = 33 and t.hc = 13 then
                     amount2
                    when linenum = 34 and t.hc = 14 then
                     amount2
                    when linenum = 35 and t.hc = 15 then
                     amount2
                    when linenum = 36 and t.hc = 16 then
                     amount2
                    when linenum = 37 and t.hc = 17 then
                     amount2
                    when linenum = 38 and t.hc = 18 then
                     amount2
                    when linenum = 39 and t.hc = 19 then
                     amount2
                    when linenum = 40 and t.hc = 20 then
                     amount2
                    when linenum = 41 and t.hc = 21 then
                     amount2
                    when linenum = 49 and t.hc = 22 then
                     amount2
                    when linenum = 50 and t.hc = 23 then
                     amount2
                    when linenum = 51 and t.hc = 24 then
                     amount2
                    when linenum = 52 and t.hc = 25 then
                     amount2
                    when linenum = 53 and t.hc = 26 then
                     amount2
                    when linenum = 54 and t.hc = 27 then
                     amount2
                    when linenum = 55 and t.hc = 28 then
                     amount2
                    when linenum = 56 and t.hc = 29 then
                     amount2
                    when linenum = 57 and t.hc = 30 then
                     amount2
                    when linenum = 58 and t.hc = 31 then
                     amount2
                    when linenum = 59 and t.hc = 32 then
                     amount2
                    when linenum = 60 and t.hc = 33 then
                     amount2
                    when linenum = 61 and t.hc = 34 then
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(nvl(l1, 0) + nvl(l3, 0)) amount1
                     ,sum(nvl(l2, 0) + nvl(l4, 0)) amount2
                 from ods_zd_swglzzszbmx
                where substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月+本年累计
      on w1.accounts_name2 = t.nsrmc
   where w1.index_type = '国内增值税指标'
     and (linenum between 3 and 12 or linenum in (21, 27) or
         linenum between 33 and 41 or linenum between 49 and 61)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t.l12, 0)
                    when linenum = 22 and t.hc = 1 then
                     nvl(t.l10, 0)
                    when linenum = 23 and t.hc = 2 then
                     nvl(t.l10, 0)
                    when linenum = 24 and t.hc = 3 then
                     nvl(t.l10, 0)
                    when linenum = 25 and t.hc = 4 then
                     nvl(t.l10, 0)
                    when linenum = 26 and t.hc = 5 then
                     nvl(t.l10, 0)
                    when linenum = 42 and t.hc = 8 then
                     nvl(t.l10, 0)
                    when linenum = 43 and t.hc = '9' then
                     nvl(t.l10, 0)
                    when linenum = 44 and t.hc = '10' then
                     nvl(t.l10, 0)
                    when linenum = 45 and t.hc = 11 then
                     nvl(t.l10, 0)
                    when linenum = 46 and t.hc = 12 then
                     nvl(t.l10, 0)
                    when linenum = 47 and t.hc = 13 then
                     nvl(t.l10, 0)
                    when linenum = 48 and t.hc in (14, 15, 16) then
                     nvl(t.l10, 0)
                  end,
                  0)) amount1 --本月金额 
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t3.l12, 0)
                    when linenum = 22 and t3.hc = 1 then
                     nvl(t3.l10, 0)
                    when linenum = 23 and t3.hc = 2 then
                     nvl(t3.l10, 0)
                    when linenum = 24 and t3.hc = 3 then
                     nvl(t3.l10, 0)
                    when linenum = 25 and t3.hc = 4 then
                     nvl(t3.l10, 0)
                    when linenum = 26 and t3.hc = 5 then
                     nvl(t3.l10, 0)
                    when linenum = 42 and t3.hc = 8 then
                     nvl(t3.l10, 0)
                    when linenum = 43 and t3.hc = '9' then
                     nvl(t3.l10, 0)
                    when linenum = 44 and t3.hc = '10' then
                     nvl(t3.l10, 0)
                    when linenum = 45 and t3.hc = 11 then
                     nvl(t3.l10, 0)
                    when linenum = 46 and t3.hc = 12 then
                     nvl(t3.l10, 0)
                    when linenum = 47 and t3.hc = 13 then
                     nvl(t3.l10, 0)
                    when linenum = 48 and t3.hc in (14, 15, 16) then
                     nvl(t3.l10, 0)
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
  
   where w1.index_type = '国内增值税指标'
     and (linenum between 22 and 26 or linenum in (13) or
         linenum between 42 and 48)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 28 and t.hc = 1 then
                     nvl(t.l3, 0)
                    when linenum = 29 and t.hc = 4 then
                     nvl(t.l3, 0)
                    when linenum = 30 and t.hc = 9 then
                     nvl(t.l3, 0)
                    when linenum = 31 and t.hc = 10 then
                     nvl(t.l3, 0)
                    when linenum = 32 and t.hc = 11 then
                     nvl(t.l3, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 28 and t3.hc = 1 then
                     nvl(t3.l3, 0)
                    when linenum = 29 and t3.hc = 4 then
                     nvl(t3.l3, 0)
                    when linenum = 30 and t3.hc = 9 then
                     nvl(t3.l3, 0)
                    when linenum = 31 and t3.hc = 10 then
                     nvl(t3.l3, 0)
                    when linenum = 32 and t3.hc = 11 then
                     nvl(t3.l3, 0)
                  end,
                  0)) amount2 --本年累计     
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 28 and 32
  --and w1.accounts_name2 = '重庆龙湖嘉博地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 14 and t.hc = 1 then
                     nvl(t.l5, 0)
                    when linenum = 15 and t.hc = 2 then
                     nvl(t.l5, 0)
                    when linenum = 16 and t.hc = 3 then
                     nvl(t.l5, 0)
                    when linenum = 17 and t.hc = 4 then
                     nvl(t.l5, 0)
                    when linenum = 18 and t.hc = 5 then
                     nvl(t.l5, 0)
                    when linenum = 19 and t.hc = 6 then
                     nvl(t.l5, 0)
                    when linenum = 20 then
                     nvl(t.l6, 0)
                  end,
                  0)) amount1 --本月金额
         ,sum(nvl(case
                    when linenum = 14 and t3.hc = 1 then
                     nvl(t3.l5, 0)
                    when linenum = 15 and t3.hc = 2 then
                     nvl(t3.l5, 0)
                    when linenum = 16 and t3.hc = 3 then
                     nvl(t3.l5, 0)
                    when linenum = 17 and t3.hc = 4 then
                     nvl(t3.l5, 0)
                    when linenum = 18 and t3.hc = 5 then
                     nvl(t3.l5, 0)
                    when linenum = 19 and t3.hc = 6 then
                     nvl(t3.l5, 0)
                    when linenum = 20 then
                     nvl(t3.l6, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 14 and 20
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,null amount1 --本月金额
         ,null amount2 --本年累计
    from w1
   where w1.index_type = '国内增值税指标'
     and linenum between 62 and 65
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w3 as
 ( --国内消费税指标、进出口税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额
         ,0 amount2 --本年金额
    from w1
   where index_type in ('国内消费税指标', '进出口税收')),
w4 as
 ( --企业所得税指标
  select a.account_time --所属期
         ,a.platform
         ,a.area
         ,a.accounts_id_hz
         ,a.accounts_name_hz --账套汇总
         ,a.accounts_id
         ,a.accounts_name2
         ,a.accounts_name --账套
         ,a.pk_accountingbook
         ,a.zb_types --指标大类
         ,a.zb_name --指标名称
         ,a.seq --画面表示顺序
         ,a.zb_access
         ,a.source_system --来源系统
         ,a.access_form --取数表单
         ,a.access_logic --取数逻辑
         ,case
            when b.amount2 is null or
                 to_char(add_months(sysdate, -1), 'yyyy-mm') = '2020-11' then
             0
            else
             a.amount2 - b.amount2
          end amount1
         ,a.amount2
    from ( --企业所得税指标
           select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
                  ,w1.plat_name platform
                  ,w1.area_name area
                  ,w1.accounts_id_hz
                  ,w1.accounts_name_hz --账套汇总
                  ,w1.accounts_id
                  ,w1.accounts_name2
                  ,w1.accounts_name --账套
                  ,w1.pk_accountingbook
                  ,w1.index_type zb_types --指标大类
                  ,w1.index_name zb_name --指标名称
                  ,w1.linenum seq --画面表示顺序
                  ,w1.index_access zb_access
                  ,w1.source_system --来源系统
                  ,w1.access_form --取数表单
                  ,w1.access_logic --取数逻辑
                  ,0 amount1 --本月
                  ,sum(nvl(case
                             when linenum = 79 then
                              nvl(t2.yysr, 0)
                             when linenum = 80 then
                              nvl(t2.yycb, 0)
                             when linenum = 81 then
                              nvl(t2.lrze, 0)
                             when linenum = 82 then
                              nvl(t2.tdywjsdynssde, 0)
                             when linenum = 83 then
                              nvl(t2.bzssr, 0)
                             when linenum = 84 then
                              nvl(t2.mssr, 0)
                             when linenum = 85 then
                              nvl(t2.gdzcjszjtze, 0)
                             when linenum = 86 then
                              nvl(t2.mbyqndks, 0)
                             when linenum = 87 then
                              nvl(t2.sjlre, 0)
                             when linenum = 88 then
                              nvl(t2.ynsdse, 0)
                             when linenum = 89 then
                              nvl(t2.jmsdse, 0)
                             when linenum = 90 then
                              nvl(t2.sjyjnsdse, 0)
                             when linenum = 91 then
                              nvl(t2.tdywyjsdse, 0)
                             when linenum = 92 then
                              nvl(t2.ybtsdse, 0)
                             when linenum = 93 then
                              nvl(t2.zjgbqftybtsdse, 0)
                             when linenum = 94 then
                              nvl(t2.zjgftybtsdse, 0)
                             when linenum = 95 then
                              nvl(t2.czjzfpybtsdse, 0)
                             when linenum = 96 then
                              nvl(t2.zjgznbmftsdse, 0)
                             when linenum = 97 then
                              nvl(t2.fzjgbqftbl, 0)
                             when linenum = 98 then
                              nvl(t2.fzjgbqftybtsdse, 0)
                           end,
                           0)) amount2 --本年累计     
             from w1
             left join (select a.name
                              ,sum(yysr) yysr
                              ,sum(yycb) yycb
                              ,sum(lrze) lrze
                              ,sum(tdywjsdynssde) tdywjsdynssde
                              ,sum(bzssr) bzssr
                              ,sum(mssr) mssr
                              ,sum(gdzcjszjtze) gdzcjszjtze
                              ,sum(mbyqndks) mbyqndks
                              ,sum(sjlre) sjlre
                              ,sum(ynsdse) ynsdse
                              ,sum(jmsdse) jmsdse
                              ,sum(sjyjnsdse) sjyjnsdse
                              ,sum(tdywyjsdse) tdywyjsdse
                              ,sum(ybtsdse) ybtsdse
                              ,sum(zjgbqftybtsdse) zjgbqftybtsdse
                              ,sum(zjgftybtsdse) zjgftybtsdse
                              ,sum(czjzfpybtsdse) czjzfpybtsdse
                              ,sum(zjgznbmftsdse) zjgznbmftsdse
                              ,sum(fzjgbqftbl) fzjgbqftbl
                              ,sum(fzjgbqftybtsdse) fzjgbqftybtsdse
                          from ods_zd_swglqs a --企业所得税--本年累计
                              ,(select name
                                      ,max(ssq_dm) ssq_dm
                                  from ods_zd_swglqs
                                 where substr(lr_sj, 1, 7) &lt;=
                                       to_char(add_months(sysdate, -1), 'yyyy-mm')
                                 group by name) b
                         where a.name = b.name
                           and a.ssq_dm = b.ssq_dm
                         group by a.name) t2
               on w1.accounts_name2 = t2.name
            where index_type = '企业所得税指标'
              and linenum between 79 and 98
           -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
            group by w1.plat_name
                     ,w1.area_name
                     ,w1.accounts_id_hz
                     ,w1.accounts_name_hz --账套汇总
                     ,w1.accounts_id
                     ,w1.accounts_name2
                     ,w1.accounts_name --账套
                     ,w1.pk_accountingbook
                     ,w1.index_type --指标大类
                     ,w1.index_name --指标名称
                     ,w1.linenum --画面表示顺序
                     ,w1.index_access
                     ,w1.source_system --来源系统
                     ,w1.access_form --取数表单
                     ,w1.access_logic --取数逻辑
           ) a
    left join w1_2 b
      on a.accounts_id = b.org_code
     and a.seq = b.seq
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 99 and
                         t1.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t1.monthmoney, 0)
                    when linenum = 100 and t1.indexname = '企业所得税-预缴' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 101 and t1.indexname = '企业所得税-结算' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 99 and
                         t2.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t2.monthmoney, 0)
                    when linenum = 100 and t2.indexname = '企业所得税-预缴' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 101 and t2.indexname = '企业所得税-结算' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount2 --本年累计      
    from w1
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t2
      on w1.accounts_name2 = t2.unitname
     and t2.indexname = nvl(t1.indexname, t2.indexname)
   where index_type = '企业所得税指标'
     and linenum between 99 and 102
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w41 as
 ( --企业所得税指标-103
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount1, 0)
                else
                 0
              end) amount1
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount2, 0)
                else
                 0
              end) amount2
    from w1
    left join w1_1 t2
      on w1.accounts_id = t2.org_code
    left join (select accounts_id --组织
                     ,case
                        when seq = 99 then
                         -amount1
                        else
                         amount1
                      end amount1
                     ,case
                        when seq = 99 then
                         -amount2
                        else
                         amount2
                      end amount2
                 from w4
                where w4.seq in (92, 99)) t3
      on w1.accounts_id = t3.accounts_id
   where index_type = '企业所得税指标'
     and linenum = 103
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w5 as
 ( --印花税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t.jsje, 0)
                    when linenum = 110 and t.sm_mc = '购销合同' then
                     nvl(t.jsje, 0)
                    when linenum = 111 and t.sm_mc = '加工承揽合同' then
                     nvl(t.jsje, 0)
                    when linenum = 112 and t.sm_mc = '建设工程勘察设计合同' then
                     nvl(t.jsje, 0)
                    when linenum = 113 and t.sm_mc = '建筑安装工程承包合同' then
                     nvl(t.jsje, 0)
                    when linenum = 114 and t.sm_mc = '财产租赁合同' then
                     nvl(t.jsje, 0)
                    when linenum = 115 and t.sm_mc = '货物运输合同' then
                     nvl(t.jsje, 0)
                    when linenum = 116 and t.sm_mc = '借款合同' then
                     nvl(t.jsje, 0)
                    when linenum = 117 and t.sm_mc = '财产保险合同' then
                     nvl(t.jsje, 0)
                    when linenum = 118 and t.sm_mc = '技术合同' then
                     nvl(t.jsje, 0)
                    when linenum = 119 and t.sm_mc = '仓储保管合同' then
                     nvl(t.jsje, 0)
                    when linenum = 120 and t.sm_mc = '产权转移书据' then
                     nvl(t.jsje, 0)
                    when linenum = 121 and t.hc = 1000 then
                     nvl(t.bqynse, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t2.jsje, 0)
                    when linenum = 110 and t2.sm_mc = '购销合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 111 and t2.sm_mc = '加工承揽合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 112 and t2.sm_mc = '建设工程勘察设计合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 113 and t2.sm_mc = '建筑安装工程承包合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 114 and t2.sm_mc = '财产租赁合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 115 and t2.sm_mc = '货物运输合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 116 and t2.sm_mc = '借款合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 117 and t2.sm_mc = '财产保险合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 118 and t2.sm_mc = '技术合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 119 and t2.sm_mc = '仓储保管合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 120 and t2.sm_mc = '产权转移书据' then
                     nvl(t2.jsje, 0)
                    when linenum = 121 and t2.hc = 1000 then
                     nvl(t2.bqynse, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本月
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本年累计
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t2
      on w1.accounts_name2 = t2.nsrmc
     and nvl(t.hc, t2.hc) = t2.hc
   where w1.index_type = '印花税指标'
     and w1.linenum &lt;&gt; 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.fsj, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.ljj, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select gsmc
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --nc科目数据-本年+累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and km_code like ('54020109%')
                group by gsmc) t2
      on w1.accounts_name2 = t2.gsmc
  
   where w1.index_type = '印花税指标'
     and w1.linenum = 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w6 as
 ( --其他税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.fsd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.fsj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.fsj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.fsd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.fsj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.fsj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.fsj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.fsj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.fsj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.fsj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.fsj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.fsj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.fsj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.fsj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.fsj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.fsj, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.ljd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.ljj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.ljj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.ljd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.ljj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.ljj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.ljj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.ljj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.ljj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.ljj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.ljj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.ljj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.ljj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.ljj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.ljj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.ljj, 0)
                    else
                     0
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljd, 0)) ljd
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --NC接口数据：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('21710401',
                                  '217106',
                                  '217108',
                                  '217107',
                                  '41010102',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '217103')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '其他税收'
     and w1.linenum not in (130, 132, 133, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t3.monthmoney, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t4.monthmoney, 0)
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t3
      on w1.accounts_name2 = t3.unitname
  
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t4
      on w1.accounts_name2 = t4.unitname
  
   where w1.index_type = '其他税收'
     and w1.linenum in (133)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t1.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t1.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t1.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t1.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t1.ybse_bq, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t2.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t2.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t2.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t2.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t2.ybse_bq, 0)
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本月
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t1
      on w1.accounts_name2 = t1.nsrmc
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本年累计
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t2
      on w1.accounts_name2 = t2.nsrmc
  
   where w1.index_type = '其他税收'
     and w1.linenum in (130, 132, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w7 as
 ( --代扣代缴税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.fsj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.ljj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('217105', '217120')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '代扣代缴税收'
  -- and w1.accounts_name2 = '上海恒卓房地产有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w8 as
 ( --其他指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t3.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t1.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t4.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t2.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t2
      on w1.accounts_name2 = t2.unitname
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本月
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '本月') t3
      on w1.pk_accountingbook = t3.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本年累计
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '累计') t4
      on w1.pk_accountingbook = t4.pk_accountingbook
  
   where index_type = '其他指标'
     and linenum in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.fsj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.fsd, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.fsd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.fsj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.fsd, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.ljj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.ljj, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.ljj, 0) --+ t3.amount2
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.ljj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.ljd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.ljj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.ljd, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(ljj, 0)) ljj
                     ,sum(nvl(ljd, 0)) ljd
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and (substr(km_code, 1, 4) in
                      ('1501', '1502', '1211', '1233', '1251', '1281') or
                      km_code in ('217105', '218111'))
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '其他指标'
     and linenum not in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w81 as
 (select w8.account_time --所属期
        ,w8.platform
        ,w8.area
        ,w8.accounts_id_hz
        ,w8.accounts_name_hz --账套汇总
        ,w8.accounts_id
        ,w8.accounts_name2
        ,w8.accounts_name --账套
        ,w8.pk_accountingbook
        ,w8.zb_types --指标大类
        ,w8.zb_name --指标名称
        ,w8.seq --画面表示顺序
        ,w8.zb_access
        ,w8.source_system --来源系统
        ,w8.access_form --取数表单
        ,w8.access_logic --取数逻辑
        ,case
           when w8.seq = 188 then
            w8.amount1 + t.amount1
           else
            w8.amount1
         end amount1
        ,case
           when w8.seq = 188 then
            w8.amount2 + t.amount2
           else
            w8.amount2
         end amount2
    from w8
    left join (select * from w6 where w6.seq = 151) t --
      on w8.accounts_id = t.accounts_id),
w9 as
 ( --财务指标（只填写累计或期末余额）
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 193 then
                     nvl(t2.yysr_lj, 0)
                    when linenum = 196 then
                     nvl(t2.cwfy_lj, 0)
                    when linenum = 197 then
                     nvl(t2.tzsy_lj, 0)
                    when linenum = 198 then
                     nvl(t2.lrze_lj, 0)
                    when linenum = 199 then
                     nvl(t1.zczj, 0)
                    when linenum = 200 then
                     nvl(t1.yszk, 0)
                    when linenum = 201 then
                     nvl(t1.ch, 0)
                    when linenum = 202 then
                     nvl(t.amount2, 0)
                    when linenum = 204 then
                     nvl(t1.fzhj, 0)
                    else
                     0
                  end,
                  0)) amount2 --本年金额 
    from w1
    left join (select * from w8 where w8.seq = 191) t --
      on w1.accounts_id = t.accounts_id
    left join (select *
                 from ods_nc_ogg_balance_sheet --资产负债表（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and sj = '期末') t1
      on w1.pk_accountingbook = t1.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_income_amount --利润表（本年）
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')) t2
      on w1.pk_accountingbook = t2.pk_accountingbook
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum not in (194, 195, 203)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 194 and t.km_code = '5401' then
                     amount2
                    when linenum = 195 and t.km_code = '5101' then
                     amount2
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select gsmc
                     ,substr(km_code, 1, 4) km_code
                     ,sum(nvl(ljj, 0) - nvl(ljd, 0)) amount2
                 from ods_zd_ncglsubjectbalance --nc科目数据（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and substr(km_code, 1, 4) in ('5401', '5101')
                group by gsmc
                        ,substr(km_code, 1, 4)) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum in (194, 195)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w91 as
 ( --财务指标（只填写累计或期末余额）-203
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1
         ,sum(nvl(case
                    when seq = 202 then
                     -amount2
                    else
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select * from w9 where seq in (201, 202)) b
      on w1.pk_accountingbook = b.pk_accountingbook
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum = 203
  -- and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  )

select a.account_time --所属期
      ,a.platform --平台
      ,a.area --地区
      ,a.accounts_id_hz   org_code_hz
      ,a.accounts_name_hz org_hz --账套汇总
      ,a.accounts_id      org_code
       --,accounts_name2
      ,a.accounts_name org --账套
       --,pk_accountingbook
      ,a.zb_types --指标大类
      ,a.zb_name --指标名称
      ,a.seq --画面表示顺序
      ,a.zb_access
      ,a.source_system --来源系统
      ,a.access_form --取数表单
      ,a.access_logic --取数逻辑
      ,a.amount1
      ,a.amount2
			,b.amount1 amount3
			,b.amount2 amount4
      ,to_char(add_months(sysdate, -1), 'yyyy') || 'Q' ||
       to_char(add_months(sysdate, -1), 'q') quarter
  from (select *
          from w2
        union all
        select *
          from w3
        union all
        select *
          from w4 --企业所得税指标
        union all
        select *
          from w41 --企业所得税指标-103
        union all
        select *
          from w5 --印花税指标
        union all
        select *
          from w6 --其他税收
        union all
        select *
          from w7 --代扣代缴税收
        union all
        select *
          from w81 --其他指标
        union all
        select *
          from w9 --财务指标（只填写累计或期末余额）
        union all
        select *
          from w91 --财务指标（只填写累计或期末余额）-203
        ) a
  left join (select *
               from dw_zdsy_monthly_tax_report
              where account_time =
                    to_char(add_months(sysdate, -2), 'yyyy-mm')) b
    on a.accounts_id = b.org_code
   and a.seq = b.seq
--where accounts_name2 = '重庆龙湖科恒地产发展有限公司'
</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>624</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>重点税源企业税收信息（月报）明细-其他税收</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle</connection>
    <sql>----重点税源
with w0 as
 ( --平台、地区、账套、账簿、航道
  select nvl(c.plat_code, d.plat_code) plat_code
         ,nvl(c.plat_name, d.plat_name) plat_name --平台
         ,b.area_code
         ,b.area_name --地区 
         ,b.accounts_id
         ,b.accounts_name --账套
         ,b.chanal
         ,b.chanal_desc --航道
         ,b.accountingbookcode
         ,b.accountingbookname --账簿
         ,b.pk_accountingbook
    from ba_area_accounts b --地区账套对应表
    left join (select * from ba_plat_area where area_name &lt;&gt; '集团') c --取非集团地区对应的平台
      on b.area_code = c.area_code
    left join (select * from ba_plat_area_fkdw where area_name = '集团') d --取集团下公司对应的平台
      on b.accounts_name = d.fkdw),
w01 as
 ( --账套汇总、账套
  select accounts_id || 'A' accounts_id_hz
         ,accounts_name || '(汇总)' accounts_name_hz --账套汇总
         ,accounts_id
         ,accounts_name --账套
    from w0
   where accounts_id in (select accounts_id
                           from (select substr(accounts_id, 1, 5) accounts_id
                                       ,count(*)
                                   from w0
                                  group by substr(accounts_id, 1, 5)
                                 having count(*) > 1))),
w02 as
 ( --平台、地区、账套汇总、账套
  select w0.plat_code
         ,w0.plat_name --平台
         ,w0.area_code
         ,w0.area_name --地区
         ,nvl(w01.accounts_id_hz, w0.accounts_id) accounts_id_hz
         ,nvl(w01.accounts_name_hz, w0.accounts_name) accounts_name_hz
         ,w0.accounts_id
         ,w0.accounts_name --账套
         ,w0.chanal
         ,w0.chanal_desc --航道
         ,w0.accountingbookcode
         ,w0.accountingbookname --账簿
         ,w0.pk_accountingbook
    from w0
    left join w01
      on w0.accounts_id like w01.accounts_id || '%'),
w1 as
 (select b.*
        ,w02.plat_name --平台
        ,w02.area_code
        ,w02.area_name --地区 
        ,w02.accounts_id_hz
        ,w02.accounts_id_hz || '-' || w02.accounts_name_hz accounts_name_hz --账套汇总
        ,w02.accounts_id
        ,w02.accounts_name accounts_name2
        ,w02.accounts_id || '-' || w02.accounts_name accounts_name --账套
        ,w02.chanal_desc --航道
        ,w02.pk_accountingbook
    from ( --指标名称
          select *
            from dw_zdsy_index_dim
           where module = 1 --模块分类（1-企业税收信息，2-企业景气调查问卷，3-财务信息）
             and index_type in
                 ('其他税收')) b
        ,w02
   where length(w02.accounts_id) > 2
  --and accounts_id_hz in ('01001A','00001','00002') 
  ),
w1_1 as
 ( --上期报表的该指标(期末欠税余额)累计数
  select org_code
         ,seq
         ,amount1
         ,amount2
         ,amount3
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq = 103
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w1_2 as
 ( --上期报表的企业所得税指标累计值between 79 and 98
  select org_code
         ,seq
         ,amount2
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq between 79 and 98
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w2 as
 ( --国内增值税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount1
                    when linenum = 4 and t.hc = 2 then
                     amount1
                    when linenum = 5 and t.hc = 3 then
                     amount1
                    when linenum = 6 and t.hc = 4 then
                     amount1
                    when linenum = 7 and t.hc = 5 then
                     amount1
                    when linenum = 8 and t.hc = 6 then
                     amount1
                    when linenum = 9 and t.hc = 7 then
                     amount1
                    when linenum = 10 and t.hc = 8 then
                     amount1
                    when linenum = 11 and t.hc = 9 then
                     amount1
                    when linenum = 12 and t.hc = 10 then
                     amount1
                    when linenum = 21 and t.hc = 11 then
                     amount1
                    when linenum = 27 and t.hc = 12 then
                     amount1
                    when linenum = 33 and t.hc = 13 then
                     amount1
                    when linenum = 34 and t.hc = 14 then
                     amount1
                    when linenum = 35 and t.hc = 15 then
                     amount1
                    when linenum = 36 and t.hc = 16 then
                     amount1
                    when linenum = 37 and t.hc = 17 then
                     amount1
                    when linenum = 38 and t.hc = 18 then
                     amount1
                    when linenum = 39 and t.hc = 19 then
                     amount1
                    when linenum = 40 and t.hc = 20 then
                     amount1
                    when linenum = 41 and t.hc = 21 then
                     amount1
                    when linenum = 49 and t.hc = 22 then
                     amount1
                    when linenum = 50 and t.hc = 23 then
                     amount1
                    when linenum = 51 and t.hc = 24 then
                     amount1
                    when linenum = 52 and t.hc = 25 then
                     amount1
                    when linenum = 53 and t.hc = 26 then
                     amount1
                    when linenum = 54 and t.hc = 27 then
                     amount1
                    when linenum = 55 and t.hc = 28 then
                     amount1
                    when linenum = 56 and t.hc = 29 then
                     amount1
                    when linenum = 57 and t.hc = 30 then
                     amount1
                    when linenum = 58 and t.hc = 31 then
                     amount1
                    when linenum = 59 and t.hc = 32 then
                     amount1
                    when linenum = 60 and t.hc = 33 then
                     amount1
                    when linenum = 61 and t.hc = 34 then
                     amount1
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount2
                    when linenum = 4 and t.hc = 2 then
                     amount2
                    when linenum = 5 and t.hc = 3 then
                     amount2
                    when linenum = 6 and t.hc = 4 then
                     amount2
                    when linenum = 7 and t.hc = 5 then
                     amount2
                    when linenum = 8 and t.hc = 6 then
                     amount2
                    when linenum = 9 and t.hc = 7 then
                     amount2
                    when linenum = 10 and t.hc = 8 then
                     amount2
                    when linenum = 11 and t.hc = 9 then
                     amount2
                    when linenum = 12 and t.hc = 10 then
                     amount2
                    when linenum = 21 and t.hc = 11 then
                     amount2
                    when linenum = 27 and t.hc = 12 then
                     amount2
                    when linenum = 33 and t.hc = 13 then
                     amount2
                    when linenum = 34 and t.hc = 14 then
                     amount2
                    when linenum = 35 and t.hc = 15 then
                     amount2
                    when linenum = 36 and t.hc = 16 then
                     amount2
                    when linenum = 37 and t.hc = 17 then
                     amount2
                    when linenum = 38 and t.hc = 18 then
                     amount2
                    when linenum = 39 and t.hc = 19 then
                     amount2
                    when linenum = 40 and t.hc = 20 then
                     amount2
                    when linenum = 41 and t.hc = 21 then
                     amount2
                    when linenum = 49 and t.hc = 22 then
                     amount2
                    when linenum = 50 and t.hc = 23 then
                     amount2
                    when linenum = 51 and t.hc = 24 then
                     amount2
                    when linenum = 52 and t.hc = 25 then
                     amount2
                    when linenum = 53 and t.hc = 26 then
                     amount2
                    when linenum = 54 and t.hc = 27 then
                     amount2
                    when linenum = 55 and t.hc = 28 then
                     amount2
                    when linenum = 56 and t.hc = 29 then
                     amount2
                    when linenum = 57 and t.hc = 30 then
                     amount2
                    when linenum = 58 and t.hc = 31 then
                     amount2
                    when linenum = 59 and t.hc = 32 then
                     amount2
                    when linenum = 60 and t.hc = 33 then
                     amount2
                    when linenum = 61 and t.hc = 34 then
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(nvl(l1, 0) + nvl(l3, 0)) amount1
                     ,sum(nvl(l2, 0) + nvl(l4, 0)) amount2
                 from ods_zd_swglzzszbmx
                where substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月+本年累计
      on w1.accounts_name2 = t.nsrmc
   where w1.index_type = '国内增值税指标'
     and (linenum between 3 and 12 or linenum in (21, 27) or
         linenum between 33 and 41 or linenum between 49 and 61)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t.l12, 0)
                    when linenum = 22 and t.hc = 1 then
                     nvl(t.l10, 0)
                    when linenum = 23 and t.hc = 2 then
                     nvl(t.l10, 0)
                    when linenum = 24 and t.hc = 3 then
                     nvl(t.l10, 0)
                    when linenum = 25 and t.hc = 4 then
                     nvl(t.l10, 0)
                    when linenum = 26 and t.hc = 5 then
                     nvl(t.l10, 0)
                    when linenum = 42 and t.hc = 8 then
                     nvl(t.l10, 0)
                    when linenum = 43 and t.hc = '9' then
                     nvl(t.l10, 0)
                    when linenum = 44 and t.hc = '10' then
                     nvl(t.l10, 0)
                    when linenum = 45 and t.hc = 11 then
                     nvl(t.l10, 0)
                    when linenum = 46 and t.hc = 12 then
                     nvl(t.l10, 0)
                    when linenum = 47 and t.hc = 13 then
                     nvl(t.l10, 0)
                    when linenum = 48 and t.hc in (14, 15, 16) then
                     nvl(t.l10, 0)
                  end,
                  0)) amount1 --本月金额 
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t3.l12, 0)
                    when linenum = 22 and t3.hc = 1 then
                     nvl(t3.l10, 0)
                    when linenum = 23 and t3.hc = 2 then
                     nvl(t3.l10, 0)
                    when linenum = 24 and t3.hc = 3 then
                     nvl(t3.l10, 0)
                    when linenum = 25 and t3.hc = 4 then
                     nvl(t3.l10, 0)
                    when linenum = 26 and t3.hc = 5 then
                     nvl(t3.l10, 0)
                    when linenum = 42 and t3.hc = 8 then
                     nvl(t3.l10, 0)
                    when linenum = 43 and t3.hc = '9' then
                     nvl(t3.l10, 0)
                    when linenum = 44 and t3.hc = '10' then
                     nvl(t3.l10, 0)
                    when linenum = 45 and t3.hc = 11 then
                     nvl(t3.l10, 0)
                    when linenum = 46 and t3.hc = 12 then
                     nvl(t3.l10, 0)
                    when linenum = 47 and t3.hc = 13 then
                     nvl(t3.l10, 0)
                    when linenum = 48 and t3.hc in (14, 15, 16) then
                     nvl(t3.l10, 0)
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
  
   where w1.index_type = '国内增值税指标'
     and (linenum between 22 and 26 or linenum in (13) or
         linenum between 42 and 48)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 28 and t.hc = 1 then
                     nvl(t.l3, 0)
                    when linenum = 29 and t.hc = 4 then
                     nvl(t.l3, 0)
                    when linenum = 30 and t.hc = 9 then
                     nvl(t.l3, 0)
                    when linenum = 31 and t.hc = 10 then
                     nvl(t.l3, 0)
                    when linenum = 32 and t.hc = 11 then
                     nvl(t.l3, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 28 and t3.hc = 1 then
                     nvl(t3.l3, 0)
                    when linenum = 29 and t3.hc = 4 then
                     nvl(t3.l3, 0)
                    when linenum = 30 and t3.hc = 9 then
                     nvl(t3.l3, 0)
                    when linenum = 31 and t3.hc = 10 then
                     nvl(t3.l3, 0)
                    when linenum = 32 and t3.hc = 11 then
                     nvl(t3.l3, 0)
                  end,
                  0)) amount2 --本年累计     
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 28 and 32
  --and w1.accounts_name2 = '重庆龙湖嘉博地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 14 and t.hc = 1 then
                     nvl(t.l5, 0)
                    when linenum = 15 and t.hc = 2 then
                     nvl(t.l5, 0)
                    when linenum = 16 and t.hc = 3 then
                     nvl(t.l5, 0)
                    when linenum = 17 and t.hc = 4 then
                     nvl(t.l5, 0)
                    when linenum = 18 and t.hc = 5 then
                     nvl(t.l5, 0)
                    when linenum = 19 and t.hc = 6 then
                     nvl(t.l5, 0)
                    when linenum = 20 then
                     nvl(t.l6, 0)
                  end,
                  0)) amount1 --本月金额
         ,sum(nvl(case
                    when linenum = 14 and t3.hc = 1 then
                     nvl(t3.l5, 0)
                    when linenum = 15 and t3.hc = 2 then
                     nvl(t3.l5, 0)
                    when linenum = 16 and t3.hc = 3 then
                     nvl(t3.l5, 0)
                    when linenum = 17 and t3.hc = 4 then
                     nvl(t3.l5, 0)
                    when linenum = 18 and t3.hc = 5 then
                     nvl(t3.l5, 0)
                    when linenum = 19 and t3.hc = 6 then
                     nvl(t3.l5, 0)
                    when linenum = 20 then
                     nvl(t3.l6, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 14 and 20
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,null amount1 --本月金额
         ,null amount2 --本年累计
    from w1
   where w1.index_type = '国内增值税指标'
     and linenum between 62 and 65
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w3 as
 ( --国内消费税指标、进出口税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额
         ,0 amount2 --本年金额
    from w1
   where index_type in ('国内消费税指标', '进出口税收')),
w4 as
 ( --企业所得税指标
  select a.account_time --所属期
         ,a.platform
         ,a.area
         ,a.accounts_id_hz
         ,a.accounts_name_hz --账套汇总
         ,a.accounts_id
         ,a.accounts_name2
         ,a.accounts_name --账套
         ,a.pk_accountingbook
         ,a.zb_types --指标大类
         ,a.zb_name --指标名称
         ,a.seq --画面表示顺序
         ,a.zb_access
         ,a.source_system --来源系统
         ,a.access_form --取数表单
         ,a.access_logic --取数逻辑
         ,case
            when b.amount2 is null or
                 to_char(add_months(sysdate, -1), 'yyyy-mm') = '2020-11' then
             0
            else
             a.amount2 - b.amount2
          end amount1
         ,a.amount2
    from ( --企业所得税指标
           select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
                  ,w1.plat_name platform
                  ,w1.area_name area
                  ,w1.accounts_id_hz
                  ,w1.accounts_name_hz --账套汇总
                  ,w1.accounts_id
                  ,w1.accounts_name2
                  ,w1.accounts_name --账套
                  ,w1.pk_accountingbook
                  ,w1.index_type zb_types --指标大类
                  ,w1.index_name zb_name --指标名称
                  ,w1.linenum seq --画面表示顺序
                  ,w1.index_access zb_access
                  ,w1.source_system --来源系统
                  ,w1.access_form --取数表单
                  ,w1.access_logic --取数逻辑
                  ,0 amount1 --本月
                  ,sum(nvl(case
                             when linenum = 79 then
                              nvl(t2.yysr, 0)
                             when linenum = 80 then
                              nvl(t2.yycb, 0)
                             when linenum = 81 then
                              nvl(t2.lrze, 0)
                             when linenum = 82 then
                              nvl(t2.tdywjsdynssde, 0)
                             when linenum = 83 then
                              nvl(t2.bzssr, 0)
                             when linenum = 84 then
                              nvl(t2.mssr, 0)
                             when linenum = 85 then
                              nvl(t2.gdzcjszjtze, 0)
                             when linenum = 86 then
                              nvl(t2.mbyqndks, 0)
                             when linenum = 87 then
                              nvl(t2.sjlre, 0)
                             when linenum = 88 then
                              nvl(t2.ynsdse, 0)
                             when linenum = 89 then
                              nvl(t2.jmsdse, 0)
                             when linenum = 90 then
                              nvl(t2.sjyjnsdse, 0)
                             when linenum = 91 then
                              nvl(t2.tdywyjsdse, 0)
                             when linenum = 92 then
                              nvl(t2.ybtsdse, 0)
                             when linenum = 93 then
                              nvl(t2.zjgbqftybtsdse, 0)
                             when linenum = 94 then
                              nvl(t2.zjgftybtsdse, 0)
                             when linenum = 95 then
                              nvl(t2.czjzfpybtsdse, 0)
                             when linenum = 96 then
                              nvl(t2.zjgznbmftsdse, 0)
                             when linenum = 97 then
                              nvl(t2.fzjgbqftbl, 0)
                             when linenum = 98 then
                              nvl(t2.fzjgbqftybtsdse, 0)
                           end,
                           0)) amount2 --本年累计     
             from w1
             left join (select a.name
                              ,sum(yysr) yysr
                              ,sum(yycb) yycb
                              ,sum(lrze) lrze
                              ,sum(tdywjsdynssde) tdywjsdynssde
                              ,sum(bzssr) bzssr
                              ,sum(mssr) mssr
                              ,sum(gdzcjszjtze) gdzcjszjtze
                              ,sum(mbyqndks) mbyqndks
                              ,sum(sjlre) sjlre
                              ,sum(ynsdse) ynsdse
                              ,sum(jmsdse) jmsdse
                              ,sum(sjyjnsdse) sjyjnsdse
                              ,sum(tdywyjsdse) tdywyjsdse
                              ,sum(ybtsdse) ybtsdse
                              ,sum(zjgbqftybtsdse) zjgbqftybtsdse
                              ,sum(zjgftybtsdse) zjgftybtsdse
                              ,sum(czjzfpybtsdse) czjzfpybtsdse
                              ,sum(zjgznbmftsdse) zjgznbmftsdse
                              ,sum(fzjgbqftbl) fzjgbqftbl
                              ,sum(fzjgbqftybtsdse) fzjgbqftybtsdse
                          from ods_zd_swglqs a --企业所得税--本年累计
                              ,(select name
                                      ,max(ssq_dm) ssq_dm
                                  from ods_zd_swglqs
                                 where substr(lr_sj, 1, 7) &lt;=
                                       to_char(add_months(sysdate, -1), 'yyyy-mm')
                                 group by name) b
                         where a.name = b.name
                           and a.ssq_dm = b.ssq_dm
                         group by a.name) t2
               on w1.accounts_name2 = t2.name
            where index_type = '企业所得税指标'
              and linenum between 79 and 98
           -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
            group by w1.plat_name
                     ,w1.area_name
                     ,w1.accounts_id_hz
                     ,w1.accounts_name_hz --账套汇总
                     ,w1.accounts_id
                     ,w1.accounts_name2
                     ,w1.accounts_name --账套
                     ,w1.pk_accountingbook
                     ,w1.index_type --指标大类
                     ,w1.index_name --指标名称
                     ,w1.linenum --画面表示顺序
                     ,w1.index_access
                     ,w1.source_system --来源系统
                     ,w1.access_form --取数表单
                     ,w1.access_logic --取数逻辑
           ) a
    left join w1_2 b
      on a.accounts_id = b.org_code
     and a.seq = b.seq
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 99 and
                         t1.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t1.monthmoney, 0)
                    when linenum = 100 and t1.indexname = '企业所得税-预缴' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 101 and t1.indexname = '企业所得税-结算' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 99 and
                         t2.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t2.monthmoney, 0)
                    when linenum = 100 and t2.indexname = '企业所得税-预缴' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 101 and t2.indexname = '企业所得税-结算' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount2 --本年累计      
    from w1
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t2
      on w1.accounts_name2 = t2.unitname
     and t2.indexname = nvl(t1.indexname, t2.indexname)
   where index_type = '企业所得税指标'
     and linenum between 99 and 102
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w41 as
 ( --企业所得税指标-103
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount1, 0)
                else
                 0
              end) amount1
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount2, 0)
                else
                 0
              end) amount2
    from w1
    left join w1_1 t2
      on w1.accounts_id = t2.org_code
    left join (select accounts_id --组织
                     ,case
                        when seq = 99 then
                         -amount1
                        else
                         amount1
                      end amount1
                     ,case
                        when seq = 99 then
                         -amount2
                        else
                         amount2
                      end amount2
                 from w4
                where w4.seq in (92, 99)) t3
      on w1.accounts_id = t3.accounts_id
   where index_type = '企业所得税指标'
     and linenum = 103
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w5 as
 ( --印花税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t.jsje, 0)
                    when linenum = 110 and t.sm_mc = '购销合同' then
                     nvl(t.jsje, 0)
                    when linenum = 111 and t.sm_mc = '加工承揽合同' then
                     nvl(t.jsje, 0)
                    when linenum = 112 and t.sm_mc = '建设工程勘察设计合同' then
                     nvl(t.jsje, 0)
                    when linenum = 113 and t.sm_mc = '建筑安装工程承包合同' then
                     nvl(t.jsje, 0)
                    when linenum = 114 and t.sm_mc = '财产租赁合同' then
                     nvl(t.jsje, 0)
                    when linenum = 115 and t.sm_mc = '货物运输合同' then
                     nvl(t.jsje, 0)
                    when linenum = 116 and t.sm_mc = '借款合同' then
                     nvl(t.jsje, 0)
                    when linenum = 117 and t.sm_mc = '财产保险合同' then
                     nvl(t.jsje, 0)
                    when linenum = 118 and t.sm_mc = '技术合同' then
                     nvl(t.jsje, 0)
                    when linenum = 119 and t.sm_mc = '仓储保管合同' then
                     nvl(t.jsje, 0)
                    when linenum = 120 and t.sm_mc = '产权转移书据' then
                     nvl(t.jsje, 0)
                    when linenum = 121 and t.hc = 1000 then
                     nvl(t.bqynse, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t2.jsje, 0)
                    when linenum = 110 and t2.sm_mc = '购销合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 111 and t2.sm_mc = '加工承揽合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 112 and t2.sm_mc = '建设工程勘察设计合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 113 and t2.sm_mc = '建筑安装工程承包合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 114 and t2.sm_mc = '财产租赁合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 115 and t2.sm_mc = '货物运输合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 116 and t2.sm_mc = '借款合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 117 and t2.sm_mc = '财产保险合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 118 and t2.sm_mc = '技术合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 119 and t2.sm_mc = '仓储保管合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 120 and t2.sm_mc = '产权转移书据' then
                     nvl(t2.jsje, 0)
                    when linenum = 121 and t2.hc = 1000 then
                     nvl(t2.bqynse, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本月
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本年累计
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t2
      on w1.accounts_name2 = t2.nsrmc
     and nvl(t.hc, t2.hc) = t2.hc
   where w1.index_type = '印花税指标'
     and w1.linenum &lt;&gt; 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.fsj, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.ljj, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select gsmc
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --nc科目数据-本年+累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and km_code like ('54020109%')
                group by gsmc) t2
      on w1.accounts_name2 = t2.gsmc
  
   where w1.index_type = '印花税指标'
     and w1.linenum = 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w6 as
 ( --其他税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.fsd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.fsj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.fsj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.fsd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.fsj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.fsj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.fsj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.fsj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.fsj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.fsj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.fsj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.fsj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.fsj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.fsj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.fsj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.fsj, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.ljd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.ljj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.ljj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.ljd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.ljj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.ljj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.ljj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.ljj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.ljj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.ljj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.ljj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.ljj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.ljj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.ljj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.ljj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.ljj, 0)
                    else
                     0
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljd, 0)) ljd
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --NC接口数据：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('21710401',
                                  '217106',
                                  '217108',
                                  '217107',
                                  '41010102',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '217103')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '其他税收'
     and w1.linenum not in (130, 132, 133, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t3.monthmoney, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t4.monthmoney, 0)
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t3
      on w1.accounts_name2 = t3.unitname
  
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t4
      on w1.accounts_name2 = t4.unitname
  
   where w1.index_type = '其他税收'
     and w1.linenum in (133)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t1.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t1.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t1.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t1.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t1.ybse_bq, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t2.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t2.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t2.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t2.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t2.ybse_bq, 0)
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本月
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t1
      on w1.accounts_name2 = t1.nsrmc
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本年累计
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t2
      on w1.accounts_name2 = t2.nsrmc
  
   where w1.index_type = '其他税收'
     and w1.linenum in (130, 132, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w7 as
 ( --代扣代缴税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.fsj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.ljj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('217105', '217120')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '代扣代缴税收'
  -- and w1.accounts_name2 = '上海恒卓房地产有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w8 as
 ( --其他指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t3.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t1.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t4.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t2.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t2
      on w1.accounts_name2 = t2.unitname
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本月
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '本月') t3
      on w1.pk_accountingbook = t3.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本年累计
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '累计') t4
      on w1.pk_accountingbook = t4.pk_accountingbook
  
   where index_type = '其他指标'
     and linenum in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.fsj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.fsd, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.fsd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.fsj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.fsd, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.ljj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.ljj, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.ljj, 0) --+ t3.amount2
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.ljj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.ljd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.ljj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.ljd, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(ljj, 0)) ljj
                     ,sum(nvl(ljd, 0)) ljd
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and (substr(km_code, 1, 4) in
                      ('1501', '1502', '1211', '1233', '1251', '1281') or
                      km_code in ('217105', '218111'))
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '其他指标'
     and linenum not in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w81 as
 (select w8.account_time --所属期
        ,w8.platform
        ,w8.area
        ,w8.accounts_id_hz
        ,w8.accounts_name_hz --账套汇总
        ,w8.accounts_id
        ,w8.accounts_name2
        ,w8.accounts_name --账套
        ,w8.pk_accountingbook
        ,w8.zb_types --指标大类
        ,w8.zb_name --指标名称
        ,w8.seq --画面表示顺序
        ,w8.zb_access
        ,w8.source_system --来源系统
        ,w8.access_form --取数表单
        ,w8.access_logic --取数逻辑
        ,case
           when w8.seq = 188 then
            w8.amount1 + t.amount1
           else
            w8.amount1
         end amount1
        ,case
           when w8.seq = 188 then
            w8.amount2 + t.amount2
           else
            w8.amount2
         end amount2
    from w8
    left join (select * from w6 where w6.seq = 151) t --
      on w8.accounts_id = t.accounts_id),
w9 as
 ( --财务指标（只填写累计或期末余额）
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 193 then
                     nvl(t2.yysr_lj, 0)
                    when linenum = 196 then
                     nvl(t2.cwfy_lj, 0)
                    when linenum = 197 then
                     nvl(t2.tzsy_lj, 0)
                    when linenum = 198 then
                     nvl(t2.lrze_lj, 0)
                    when linenum = 199 then
                     nvl(t1.zczj, 0)
                    when linenum = 200 then
                     nvl(t1.yszk, 0)
                    when linenum = 201 then
                     nvl(t1.ch, 0)
                    when linenum = 202 then
                     nvl(t.amount2, 0)
                    when linenum = 204 then
                     nvl(t1.fzhj, 0)
                    else
                     0
                  end,
                  0)) amount2 --本年金额 
    from w1
    left join (select * from w8 where w8.seq = 191) t --
      on w1.accounts_id = t.accounts_id
    left join (select *
                 from ods_nc_ogg_balance_sheet --资产负债表（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and sj = '期末') t1
      on w1.pk_accountingbook = t1.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_income_amount --利润表（本年）
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')) t2
      on w1.pk_accountingbook = t2.pk_accountingbook
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum not in (194, 195, 203)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 194 and t.km_code = '5401' then
                     amount2
                    when linenum = 195 and t.km_code = '5101' then
                     amount2
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select gsmc
                     ,substr(km_code, 1, 4) km_code
                     ,sum(nvl(ljj, 0) - nvl(ljd, 0)) amount2
                 from ods_zd_ncglsubjectbalance --nc科目数据（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and substr(km_code, 1, 4) in ('5401', '5101')
                group by gsmc
                        ,substr(km_code, 1, 4)) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum in (194, 195)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w91 as
 ( --财务指标（只填写累计或期末余额）-203
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1
         ,sum(nvl(case
                    when seq = 202 then
                     -amount2
                    else
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select * from w9 where seq in (201, 202)) b
      on w1.pk_accountingbook = b.pk_accountingbook
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum = 203
  -- and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  )

select a.account_time --所属期
      ,a.platform --平台
      ,a.area --地区
      ,a.accounts_id_hz   org_code_hz
      ,a.accounts_name_hz org_hz --账套汇总
      ,a.accounts_id      org_code
       --,accounts_name2
      ,a.accounts_name org --账套
       --,pk_accountingbook
      ,a.zb_types --指标大类
      ,a.zb_name --指标名称
      ,a.seq --画面表示顺序
      ,a.zb_access
      ,a.source_system --来源系统
      ,a.access_form --取数表单
      ,a.access_logic --取数逻辑
      ,a.amount1
      ,a.amount2
			,b.amount1 amount3
			,b.amount2 amount4
      ,to_char(add_months(sysdate, -1), 'yyyy') || 'Q' ||
       to_char(add_months(sysdate, -1), 'q') quarter
  from (select *
          from w2
        union all
        select *
          from w3
        union all
        select *
          from w4 --企业所得税指标
        union all
        select *
          from w41 --企业所得税指标-103
        union all
        select *
          from w5 --印花税指标
        union all
        select *
          from w6 --其他税收
        union all
        select *
          from w7 --代扣代缴税收
        union all
        select *
          from w81 --其他指标
        union all
        select *
          from w9 --财务指标（只填写累计或期末余额）
        union all
        select *
          from w91 --财务指标（只填写累计或期末余额）-203
        ) a
  left join (select *
               from dw_zdsy_monthly_tax_report
              where account_time =
                    to_char(add_months(sysdate, -2), 'yyyy-mm')) b
    on a.accounts_id = b.org_code
   and a.seq = b.seq
--where accounts_name2 = '重庆龙湖科恒地产发展有限公司'
</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>624</xloc>
      <yloc>368</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>重点税源企业税收信息（月报）明细-印花税指标</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>oracle</connection>
    <sql>----重点税源
with w0 as
 ( --平台、地区、账套、账簿、航道
  select nvl(c.plat_code, d.plat_code) plat_code
         ,nvl(c.plat_name, d.plat_name) plat_name --平台
         ,b.area_code
         ,b.area_name --地区 
         ,b.accounts_id
         ,b.accounts_name --账套
         ,b.chanal
         ,b.chanal_desc --航道
         ,b.accountingbookcode
         ,b.accountingbookname --账簿
         ,b.pk_accountingbook
    from ba_area_accounts b --地区账套对应表
    left join (select * from ba_plat_area where area_name &lt;&gt; '集团') c --取非集团地区对应的平台
      on b.area_code = c.area_code
    left join (select * from ba_plat_area_fkdw where area_name = '集团') d --取集团下公司对应的平台
      on b.accounts_name = d.fkdw),
w01 as
 ( --账套汇总、账套
  select accounts_id || 'A' accounts_id_hz
         ,accounts_name || '(汇总)' accounts_name_hz --账套汇总
         ,accounts_id
         ,accounts_name --账套
    from w0
   where accounts_id in (select accounts_id
                           from (select substr(accounts_id, 1, 5) accounts_id
                                       ,count(*)
                                   from w0
                                  group by substr(accounts_id, 1, 5)
                                 having count(*) > 1))),
w02 as
 ( --平台、地区、账套汇总、账套
  select w0.plat_code
         ,w0.plat_name --平台
         ,w0.area_code
         ,w0.area_name --地区
         ,nvl(w01.accounts_id_hz, w0.accounts_id) accounts_id_hz
         ,nvl(w01.accounts_name_hz, w0.accounts_name) accounts_name_hz
         ,w0.accounts_id
         ,w0.accounts_name --账套
         ,w0.chanal
         ,w0.chanal_desc --航道
         ,w0.accountingbookcode
         ,w0.accountingbookname --账簿
         ,w0.pk_accountingbook
    from w0
    left join w01
      on w0.accounts_id like w01.accounts_id || '%'),
w1 as
 (select b.*
        ,w02.plat_name --平台
        ,w02.area_code
        ,w02.area_name --地区 
        ,w02.accounts_id_hz
        ,w02.accounts_id_hz || '-' || w02.accounts_name_hz accounts_name_hz --账套汇总
        ,w02.accounts_id
        ,w02.accounts_name accounts_name2
        ,w02.accounts_id || '-' || w02.accounts_name accounts_name --账套
        ,w02.chanal_desc --航道
        ,w02.pk_accountingbook
    from ( --指标名称
          select *
            from dw_zdsy_index_dim
           where module = 1 --模块分类（1-企业税收信息，2-企业景气调查问卷，3-财务信息）
             and index_type in
                 ('印花税指标')) b
        ,w02
   where length(w02.accounts_id) > 2
  --and accounts_id_hz in ('01001A','00001','00002') 
  ),
w1_1 as
 ( --上期报表的该指标(期末欠税余额)累计数
  select org_code
         ,seq
         ,amount1
         ,amount2
         ,amount3
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq = 103
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w1_2 as
 ( --上期报表的企业所得税指标累计值between 79 and 98
  select org_code
         ,seq
         ,amount2
         ,amount4
    from dw_zdsy_monthly_tax_report
   where seq between 79 and 98
     and account_time = to_char(add_months(sysdate, -2), 'yyyy-mm')),
w2 as
 ( --国内增值税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount1
                    when linenum = 4 and t.hc = 2 then
                     amount1
                    when linenum = 5 and t.hc = 3 then
                     amount1
                    when linenum = 6 and t.hc = 4 then
                     amount1
                    when linenum = 7 and t.hc = 5 then
                     amount1
                    when linenum = 8 and t.hc = 6 then
                     amount1
                    when linenum = 9 and t.hc = 7 then
                     amount1
                    when linenum = 10 and t.hc = 8 then
                     amount1
                    when linenum = 11 and t.hc = 9 then
                     amount1
                    when linenum = 12 and t.hc = 10 then
                     amount1
                    when linenum = 21 and t.hc = 11 then
                     amount1
                    when linenum = 27 and t.hc = 12 then
                     amount1
                    when linenum = 33 and t.hc = 13 then
                     amount1
                    when linenum = 34 and t.hc = 14 then
                     amount1
                    when linenum = 35 and t.hc = 15 then
                     amount1
                    when linenum = 36 and t.hc = 16 then
                     amount1
                    when linenum = 37 and t.hc = 17 then
                     amount1
                    when linenum = 38 and t.hc = 18 then
                     amount1
                    when linenum = 39 and t.hc = 19 then
                     amount1
                    when linenum = 40 and t.hc = 20 then
                     amount1
                    when linenum = 41 and t.hc = 21 then
                     amount1
                    when linenum = 49 and t.hc = 22 then
                     amount1
                    when linenum = 50 and t.hc = 23 then
                     amount1
                    when linenum = 51 and t.hc = 24 then
                     amount1
                    when linenum = 52 and t.hc = 25 then
                     amount1
                    when linenum = 53 and t.hc = 26 then
                     amount1
                    when linenum = 54 and t.hc = 27 then
                     amount1
                    when linenum = 55 and t.hc = 28 then
                     amount1
                    when linenum = 56 and t.hc = 29 then
                     amount1
                    when linenum = 57 and t.hc = 30 then
                     amount1
                    when linenum = 58 and t.hc = 31 then
                     amount1
                    when linenum = 59 and t.hc = 32 then
                     amount1
                    when linenum = 60 and t.hc = 33 then
                     amount1
                    when linenum = 61 and t.hc = 34 then
                     amount1
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 3 and t.hc = 1 then
                     amount2
                    when linenum = 4 and t.hc = 2 then
                     amount2
                    when linenum = 5 and t.hc = 3 then
                     amount2
                    when linenum = 6 and t.hc = 4 then
                     amount2
                    when linenum = 7 and t.hc = 5 then
                     amount2
                    when linenum = 8 and t.hc = 6 then
                     amount2
                    when linenum = 9 and t.hc = 7 then
                     amount2
                    when linenum = 10 and t.hc = 8 then
                     amount2
                    when linenum = 11 and t.hc = 9 then
                     amount2
                    when linenum = 12 and t.hc = 10 then
                     amount2
                    when linenum = 21 and t.hc = 11 then
                     amount2
                    when linenum = 27 and t.hc = 12 then
                     amount2
                    when linenum = 33 and t.hc = 13 then
                     amount2
                    when linenum = 34 and t.hc = 14 then
                     amount2
                    when linenum = 35 and t.hc = 15 then
                     amount2
                    when linenum = 36 and t.hc = 16 then
                     amount2
                    when linenum = 37 and t.hc = 17 then
                     amount2
                    when linenum = 38 and t.hc = 18 then
                     amount2
                    when linenum = 39 and t.hc = 19 then
                     amount2
                    when linenum = 40 and t.hc = 20 then
                     amount2
                    when linenum = 41 and t.hc = 21 then
                     amount2
                    when linenum = 49 and t.hc = 22 then
                     amount2
                    when linenum = 50 and t.hc = 23 then
                     amount2
                    when linenum = 51 and t.hc = 24 then
                     amount2
                    when linenum = 52 and t.hc = 25 then
                     amount2
                    when linenum = 53 and t.hc = 26 then
                     amount2
                    when linenum = 54 and t.hc = 27 then
                     amount2
                    when linenum = 55 and t.hc = 28 then
                     amount2
                    when linenum = 56 and t.hc = 29 then
                     amount2
                    when linenum = 57 and t.hc = 30 then
                     amount2
                    when linenum = 58 and t.hc = 31 then
                     amount2
                    when linenum = 59 and t.hc = 32 then
                     amount2
                    when linenum = 60 and t.hc = 33 then
                     amount2
                    when linenum = 61 and t.hc = 34 then
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(nvl(l1, 0) + nvl(l3, 0)) amount1
                     ,sum(nvl(l2, 0) + nvl(l4, 0)) amount2
                 from ods_zd_swglzzszbmx
                where substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月+本年累计
      on w1.accounts_name2 = t.nsrmc
   where w1.index_type = '国内增值税指标'
     and (linenum between 3 and 12 or linenum in (21, 27) or
         linenum between 33 and 41 or linenum between 49 and 61)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t.l12, 0)
                    when linenum = 22 and t.hc = 1 then
                     nvl(t.l10, 0)
                    when linenum = 23 and t.hc = 2 then
                     nvl(t.l10, 0)
                    when linenum = 24 and t.hc = 3 then
                     nvl(t.l10, 0)
                    when linenum = 25 and t.hc = 4 then
                     nvl(t.l10, 0)
                    when linenum = 26 and t.hc = 5 then
                     nvl(t.l10, 0)
                    when linenum = 42 and t.hc = 8 then
                     nvl(t.l10, 0)
                    when linenum = 43 and t.hc = '9' then
                     nvl(t.l10, 0)
                    when linenum = 44 and t.hc = '10' then
                     nvl(t.l10, 0)
                    when linenum = 45 and t.hc = 11 then
                     nvl(t.l10, 0)
                    when linenum = 46 and t.hc = 12 then
                     nvl(t.l10, 0)
                    when linenum = 47 and t.hc = 13 then
                     nvl(t.l10, 0)
                    when linenum = 48 and t.hc in (14, 15, 16) then
                     nvl(t.l10, 0)
                  end,
                  0)) amount1 --本月金额 
         ,sum(nvl(case
                    when linenum = 13 then
                     nvl(t3.l12, 0)
                    when linenum = 22 and t3.hc = 1 then
                     nvl(t3.l10, 0)
                    when linenum = 23 and t3.hc = 2 then
                     nvl(t3.l10, 0)
                    when linenum = 24 and t3.hc = 3 then
                     nvl(t3.l10, 0)
                    when linenum = 25 and t3.hc = 4 then
                     nvl(t3.l10, 0)
                    when linenum = 26 and t3.hc = 5 then
                     nvl(t3.l10, 0)
                    when linenum = 42 and t3.hc = 8 then
                     nvl(t3.l10, 0)
                    when linenum = 43 and t3.hc = '9' then
                     nvl(t3.l10, 0)
                    when linenum = 44 and t3.hc = '10' then
                     nvl(t3.l10, 0)
                    when linenum = 45 and t3.hc = 11 then
                     nvl(t3.l10, 0)
                    when linenum = 46 and t3.hc = 12 then
                     nvl(t3.l10, 0)
                    when linenum = 47 and t3.hc = 13 then
                     nvl(t3.l10, 0)
                    when linenum = 48 and t3.hc in (14, 15, 16) then
                     nvl(t3.l10, 0)
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l12) l12
                     ,sum(l14) l10
                 from ods_zd_swglzzsfb1
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
  
   where w1.index_type = '国内增值税指标'
     and (linenum between 22 and 26 or linenum in (13) or
         linenum between 42 and 48)
  --  and w1.accounts_name2='福州元顺房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 28 and t.hc = 1 then
                     nvl(t.l3, 0)
                    when linenum = 29 and t.hc = 4 then
                     nvl(t.l3, 0)
                    when linenum = 30 and t.hc = 9 then
                     nvl(t.l3, 0)
                    when linenum = 31 and t.hc = 10 then
                     nvl(t.l3, 0)
                    when linenum = 32 and t.hc = 11 then
                     nvl(t.l3, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 28 and t3.hc = 1 then
                     nvl(t3.l3, 0)
                    when linenum = 29 and t3.hc = 4 then
                     nvl(t3.l3, 0)
                    when linenum = 30 and t3.hc = 9 then
                     nvl(t3.l3, 0)
                    when linenum = 31 and t3.hc = 10 then
                     nvl(t3.l3, 0)
                    when linenum = 32 and t3.hc = 11 then
                     nvl(t3.l3, 0)
                  end,
                  0)) amount2 --本年累计     
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l3) l3
                 from ods_zd_swglzzsfb2
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc in (1, 4, 9, 10, 11)
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 28 and 32
  --and w1.accounts_name2 = '重庆龙湖嘉博地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 14 and t.hc = 1 then
                     nvl(t.l5, 0)
                    when linenum = 15 and t.hc = 2 then
                     nvl(t.l5, 0)
                    when linenum = 16 and t.hc = 3 then
                     nvl(t.l5, 0)
                    when linenum = 17 and t.hc = 4 then
                     nvl(t.l5, 0)
                    when linenum = 18 and t.hc = 5 then
                     nvl(t.l5, 0)
                    when linenum = 19 and t.hc = 6 then
                     nvl(t.l5, 0)
                    when linenum = 20 then
                     nvl(t.l6, 0)
                  end,
                  0)) amount1 --本月金额
         ,sum(nvl(case
                    when linenum = 14 and t3.hc = 1 then
                     nvl(t3.l5, 0)
                    when linenum = 15 and t3.hc = 2 then
                     nvl(t3.l5, 0)
                    when linenum = 16 and t3.hc = 3 then
                     nvl(t3.l5, 0)
                    when linenum = 17 and t3.hc = 4 then
                     nvl(t3.l5, 0)
                    when linenum = 18 and t3.hc = 5 then
                     nvl(t3.l5, 0)
                    when linenum = 19 and t3.hc = 6 then
                     nvl(t3.l5, 0)
                    when linenum = 20 then
                     nvl(t3.l6, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t --本月
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,hc
                     ,sum(l5) l5
                     ,sum(l6) l6
                 from ods_zd_swglzzsfb3
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1，7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,hc) t3 --本年累计
      on w1.accounts_name2 = t3.nsrmc
     and nvl(t.hc, t3.hc) = t3.hc
   where w1.index_type = '国内增值税指标'
     and linenum between 14 and 20
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,null amount1 --本月金额
         ,null amount2 --本年累计
    from w1
   where w1.index_type = '国内增值税指标'
     and linenum between 62 and 65
  --and w1.accounts_name2 = '重庆龙湖科恒地产发展有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w3 as
 ( --国内消费税指标、进出口税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额
         ,0 amount2 --本年金额
    from w1
   where index_type in ('国内消费税指标', '进出口税收')),
w4 as
 ( --企业所得税指标
  select a.account_time --所属期
         ,a.platform
         ,a.area
         ,a.accounts_id_hz
         ,a.accounts_name_hz --账套汇总
         ,a.accounts_id
         ,a.accounts_name2
         ,a.accounts_name --账套
         ,a.pk_accountingbook
         ,a.zb_types --指标大类
         ,a.zb_name --指标名称
         ,a.seq --画面表示顺序
         ,a.zb_access
         ,a.source_system --来源系统
         ,a.access_form --取数表单
         ,a.access_logic --取数逻辑
         ,case
            when b.amount2 is null or
                 to_char(add_months(sysdate, -1), 'yyyy-mm') = '2020-11' then
             0
            else
             a.amount2 - b.amount2
          end amount1
         ,a.amount2
    from ( --企业所得税指标
           select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
                  ,w1.plat_name platform
                  ,w1.area_name area
                  ,w1.accounts_id_hz
                  ,w1.accounts_name_hz --账套汇总
                  ,w1.accounts_id
                  ,w1.accounts_name2
                  ,w1.accounts_name --账套
                  ,w1.pk_accountingbook
                  ,w1.index_type zb_types --指标大类
                  ,w1.index_name zb_name --指标名称
                  ,w1.linenum seq --画面表示顺序
                  ,w1.index_access zb_access
                  ,w1.source_system --来源系统
                  ,w1.access_form --取数表单
                  ,w1.access_logic --取数逻辑
                  ,0 amount1 --本月
                  ,sum(nvl(case
                             when linenum = 79 then
                              nvl(t2.yysr, 0)
                             when linenum = 80 then
                              nvl(t2.yycb, 0)
                             when linenum = 81 then
                              nvl(t2.lrze, 0)
                             when linenum = 82 then
                              nvl(t2.tdywjsdynssde, 0)
                             when linenum = 83 then
                              nvl(t2.bzssr, 0)
                             when linenum = 84 then
                              nvl(t2.mssr, 0)
                             when linenum = 85 then
                              nvl(t2.gdzcjszjtze, 0)
                             when linenum = 86 then
                              nvl(t2.mbyqndks, 0)
                             when linenum = 87 then
                              nvl(t2.sjlre, 0)
                             when linenum = 88 then
                              nvl(t2.ynsdse, 0)
                             when linenum = 89 then
                              nvl(t2.jmsdse, 0)
                             when linenum = 90 then
                              nvl(t2.sjyjnsdse, 0)
                             when linenum = 91 then
                              nvl(t2.tdywyjsdse, 0)
                             when linenum = 92 then
                              nvl(t2.ybtsdse, 0)
                             when linenum = 93 then
                              nvl(t2.zjgbqftybtsdse, 0)
                             when linenum = 94 then
                              nvl(t2.zjgftybtsdse, 0)
                             when linenum = 95 then
                              nvl(t2.czjzfpybtsdse, 0)
                             when linenum = 96 then
                              nvl(t2.zjgznbmftsdse, 0)
                             when linenum = 97 then
                              nvl(t2.fzjgbqftbl, 0)
                             when linenum = 98 then
                              nvl(t2.fzjgbqftybtsdse, 0)
                           end,
                           0)) amount2 --本年累计     
             from w1
             left join (select a.name
                              ,sum(yysr) yysr
                              ,sum(yycb) yycb
                              ,sum(lrze) lrze
                              ,sum(tdywjsdynssde) tdywjsdynssde
                              ,sum(bzssr) bzssr
                              ,sum(mssr) mssr
                              ,sum(gdzcjszjtze) gdzcjszjtze
                              ,sum(mbyqndks) mbyqndks
                              ,sum(sjlre) sjlre
                              ,sum(ynsdse) ynsdse
                              ,sum(jmsdse) jmsdse
                              ,sum(sjyjnsdse) sjyjnsdse
                              ,sum(tdywyjsdse) tdywyjsdse
                              ,sum(ybtsdse) ybtsdse
                              ,sum(zjgbqftybtsdse) zjgbqftybtsdse
                              ,sum(zjgftybtsdse) zjgftybtsdse
                              ,sum(czjzfpybtsdse) czjzfpybtsdse
                              ,sum(zjgznbmftsdse) zjgznbmftsdse
                              ,sum(fzjgbqftbl) fzjgbqftbl
                              ,sum(fzjgbqftybtsdse) fzjgbqftybtsdse
                          from ods_zd_swglqs a --企业所得税--本年累计
                              ,(select name
                                      ,max(ssq_dm) ssq_dm
                                  from ods_zd_swglqs
                                 where substr(lr_sj, 1, 7) &lt;=
                                       to_char(add_months(sysdate, -1), 'yyyy-mm')
                                 group by name) b
                         where a.name = b.name
                           and a.ssq_dm = b.ssq_dm
                         group by a.name) t2
               on w1.accounts_name2 = t2.name
            where index_type = '企业所得税指标'
              and linenum between 79 and 98
           -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
            group by w1.plat_name
                     ,w1.area_name
                     ,w1.accounts_id_hz
                     ,w1.accounts_name_hz --账套汇总
                     ,w1.accounts_id
                     ,w1.accounts_name2
                     ,w1.accounts_name --账套
                     ,w1.pk_accountingbook
                     ,w1.index_type --指标大类
                     ,w1.index_name --指标名称
                     ,w1.linenum --画面表示顺序
                     ,w1.index_access
                     ,w1.source_system --来源系统
                     ,w1.access_form --取数表单
                     ,w1.access_logic --取数逻辑
           ) a
    left join w1_2 b
      on a.accounts_id = b.org_code
     and a.seq = b.seq
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 99 and
                         t1.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t1.monthmoney, 0)
                    when linenum = 100 and t1.indexname = '企业所得税-预缴' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 101 and t1.indexname = '企业所得税-结算' then
                     nvl(t1.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 99 and
                         t2.indexname in ('企业所得税-预缴', '企业所得税-结算') then --99=100+101+102
                     nvl(t2.monthmoney, 0)
                    when linenum = 100 and t2.indexname = '企业所得税-预缴' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 101 and t2.indexname = '企业所得税-结算' then
                     nvl(t2.monthmoney, 0)
                    when linenum = 102 then --
                     0
                  end,
                  0)) amount2 --本年累计      
    from w1
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,indexname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表--本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('企业所得税-预缴', '企业所得税-结算')
                group by unitname
                        ,indexname) t2
      on w1.accounts_name2 = t2.unitname
     and t2.indexname = nvl(t1.indexname, t2.indexname)
   where index_type = '企业所得税指标'
     and linenum between 99 and 102
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w41 as
 ( --企业所得税指标-103
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount1, 0)
                else
                 0
              end) amount1
         ,sum(case
                when nvl(t2.amount2, 0) = 0 then
                 nvl(t3.amount2, 0)
                else
                 0
              end) amount2
    from w1
    left join w1_1 t2
      on w1.accounts_id = t2.org_code
    left join (select accounts_id --组织
                     ,case
                        when seq = 99 then
                         -amount1
                        else
                         amount1
                      end amount1
                     ,case
                        when seq = 99 then
                         -amount2
                        else
                         amount2
                      end amount2
                 from w4
                where w4.seq in (92, 99)) t3
      on w1.accounts_id = t3.accounts_id
   where index_type = '企业所得税指标'
     and linenum = 103
  -- and w1.accounts_name2 = '重庆龙湖成恒地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w5 as
 ( --印花税指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t.jsje, 0)
                    when linenum = 110 and t.sm_mc = '购销合同' then
                     nvl(t.jsje, 0)
                    when linenum = 111 and t.sm_mc = '加工承揽合同' then
                     nvl(t.jsje, 0)
                    when linenum = 112 and t.sm_mc = '建设工程勘察设计合同' then
                     nvl(t.jsje, 0)
                    when linenum = 113 and t.sm_mc = '建筑安装工程承包合同' then
                     nvl(t.jsje, 0)
                    when linenum = 114 and t.sm_mc = '财产租赁合同' then
                     nvl(t.jsje, 0)
                    when linenum = 115 and t.sm_mc = '货物运输合同' then
                     nvl(t.jsje, 0)
                    when linenum = 116 and t.sm_mc = '借款合同' then
                     nvl(t.jsje, 0)
                    when linenum = 117 and t.sm_mc = '财产保险合同' then
                     nvl(t.jsje, 0)
                    when linenum = 118 and t.sm_mc = '技术合同' then
                     nvl(t.jsje, 0)
                    when linenum = 119 and t.sm_mc = '仓储保管合同' then
                     nvl(t.jsje, 0)
                    when linenum = 120 and t.sm_mc = '产权转移书据' then
                     nvl(t.jsje, 0)
                    when linenum = 121 and t.hc = 1000 then
                     nvl(t.bqynse, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 109 then
                     nvl(t2.jsje, 0)
                    when linenum = 110 and t2.sm_mc = '购销合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 111 and t2.sm_mc = '加工承揽合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 112 and t2.sm_mc = '建设工程勘察设计合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 113 and t2.sm_mc = '建筑安装工程承包合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 114 and t2.sm_mc = '财产租赁合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 115 and t2.sm_mc = '货物运输合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 116 and t2.sm_mc = '借款合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 117 and t2.sm_mc = '财产保险合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 118 and t2.sm_mc = '技术合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 119 and t2.sm_mc = '仓储保管合同' then
                     nvl(t2.jsje, 0)
                    when linenum = 120 and t2.sm_mc = '产权转移书据' then
                     nvl(t2.jsje, 0)
                    when linenum = 121 and t2.hc = 1000 then
                     nvl(t2.bqynse, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本月
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t
      on w1.accounts_name2 = t.nsrmc
    left join (select nsrmc
                     ,sm_mc
                     ,hc
                     ,sum(nvl(jsje, 0)) jsje
                     ,sum(nvl(bqynse, 0)) bqynse
                 from ods_zd_swglyhsnssbbmx --本年累计
                where substr(lr_sj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lr_sj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                group by nsrmc
                        ,sm_mc
                        ,hc) t2
      on w1.accounts_name2 = t2.nsrmc
     and nvl(t.hc, t2.hc) = t2.hc
   where w1.index_type = '印花税指标'
     and w1.linenum &lt;&gt; 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.fsj, 0)
                  end,
                  0)) amount1 --本月
         ,sum(nvl(case
                    when linenum = 122 then
                     nvl(t2.ljj, 0)
                  end,
                  0)) amount2 --本年累计
    from w1
    left join (select gsmc
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --nc科目数据-本年+累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and km_code like ('54020109%')
                group by gsmc) t2
      on w1.accounts_name2 = t2.gsmc
  
   where w1.index_type = '印花税指标'
     and w1.linenum = 122
  -- and w1.accounts_name2 = '云南嘉卓房地产开发有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w6 as
 ( --其他税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.fsd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.fsj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.fsj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.fsd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.fsj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.fsj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.fsj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.fsj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.fsj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.fsj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.fsj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.fsj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.fsj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.fsj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.fsj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.fsj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.fsj, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 124 and t.km_code = '21710401' then
                     nvl(t.ljd, 0)
                    when linenum = 125 and t.km_code = '21710401' then
                     nvl(t.ljj, 0)
                    when linenum = 135 and t.km_code = '217106' then
                     nvl(t.ljj, 0)
                    when linenum = 136 and t.km_code = '217108' then
                     nvl(t.ljd, 0)
                    when linenum = 137 and t.km_code = '217108' then
                     nvl(t.ljj, 0)
                    when linenum = 141 and t.km_code = '217107' then
                     nvl(t.ljj, 0)
                    when linenum = 146 and t.km_code = '41010102' then
                     nvl(t.ljj, 0)
                    when linenum = 149 and t.km_code = '217121' then
                     nvl(t.ljj, 0)
                    when linenum = 151 and
                         t.km_code in ('41050301',
                                       '55010301',
                                       '55020301',
                                       '540103010501',
                                       '41050303',
                                       '55010303',
                                       '55020303',
                                       '540103010503',
                                       '41050302',
                                       '55010302',
                                       '55020302',
                                       '540103010502',
                                       '41050304',
                                       '55010304',
                                       '55020304',
                                       '540103010504',
                                       '41050305',
                                       '55010305',
                                       '55020305',
                                       '410504',
                                       '550104',
                                       '550204',
                                       '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 152 and
                         t.km_code in
                         ('41050301', '55010301', '55020301', '540103010501') then
                     nvl(t.ljj, 0)
                    when linenum = 153 and
                         t.km_code in
                         ('41050303', '55010303', '55020303', '540103010503') then
                     nvl(t.ljj, 0)
                    when linenum = 154 and
                         t.km_code in
                         ('41050302', '55010302', '55020302', '540103010502') then
                     nvl(t.ljj, 0)
                    when linenum = 155 and
                         t.km_code in
                         ('41050304', '55010304', '55020304', '540103010504') then
                     nvl(t.ljj, 0)
                    when linenum = 156 and
                         t.km_code in ('41050305', '55010305', '55020305') then
                     nvl(t.ljj, 0)
                    when linenum = 157 and
                         t.km_code in ('410504', '550104', '550204', '5401030106') then
                     nvl(t.ljj, 0)
                    when linenum = 158 and
                         t.km_code in ('21710402', '21710403', '21710499') then
                     nvl(t.ljj, 0)
                    when linenum = 159 and t.km_code in ('21710402', '21710403') then
                     nvl(t.ljj, 0)
                    when linenum = 162 and t.km_code = '21710499' then
                     nvl(t.ljj, 0)
                    else
                     0
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljd, 0)) ljd
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --NC接口数据：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('21710401',
                                  '217106',
                                  '217108',
                                  '217107',
                                  '41010102',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '41050301',
                                  '55010301',
                                  '55020301',
                                  '540103010501',
                                  '41050303',
                                  '55010303',
                                  '55020303',
                                  '540103010503',
                                  '41050302',
                                  '55010302',
                                  '55020302',
                                  '540103010502',
                                  '41050304',
                                  '55010304',
                                  '55020304',
                                  '540103010504',
                                  '41050305',
                                  '55010305',
                                  '55020305',
                                  '410504',
                                  '550104',
                                  '550204',
                                  '5401030106',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '21710402',
                                  '21710403',
                                  '21710499',
                                  '217103')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '其他税收'
     and w1.linenum not in (130, 132, 133, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t3.monthmoney, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 133 then
                     nvl(t4.monthmoney, 0)
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t3
      on w1.accounts_name2 = t3.unitname
  
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname in ('土地增值税-预缴', '土地增值税-结算')
                group by unitname) t4
      on w1.accounts_name2 = t4.unitname
  
   where w1.index_type = '其他税收'
     and w1.linenum in (133)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t1.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t1.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t1.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t1.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t1.ybse_bq, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 130 then
                     nvl(t2.sr_yssr, 0)
                    when linenum = 132 then
                     nvl(t2.skjn_bqyjsejs, 0)
                    when linenum = 134 then
                     nvl(t2.ybse_bq, 0)
                    when linenum = 138 then
                     nvl(t2.tdzmj, 0)
                    when linenum = 140 then
                     nvl(t2.ybse_bq, 0)
                  end,
                  0)) amount2
    from w1
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本月
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t1
      on w1.accounts_name2 = t1.nsrmc
    left join (select nsrmc
                     ,sum(sr_yssr) sr_yssr
                     ,sum(skjn_bqyjsejs) skjn_bqyjsejs
                     ,sum(bqybtse) bqybtse
                     ,sum(ybse_bq) ybse_bq
                     ,sum(nvl(tdzmj, 0)) tdzmj
                 from ods_zd_swglqtssmx --税务管理其他税收：本年累计
                where substr(lrsj, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and substr(lrsj, 1, 7) &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and hc not in (1000, 9999)
                group by nsrmc) t2
      on w1.accounts_name2 = t2.nsrmc
  
   where w1.index_type = '其他税收'
     and w1.linenum in (130, 132, 134, 138, 140)
  --and w1.accounts_name2='西安南湖锦腾置业有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w7 as
 ( --代扣代缴税收
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.fsj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.fsj, 0)
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 165 and t.km_code = '217120' then
                     nvl(t.ljj, 0)
                    when linenum = 169 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                    when linenum = 170 and t.km_code = '217105' then
                     nvl(t.ljj, 0)
                  end,
                  0)) amount2
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(ljj, 0)) ljj
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and km_code in ('217105', '217120')
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '代扣代缴税收'
  -- and w1.accounts_name2 = '上海恒卓房地产有限公司'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w8 as
 ( --其他指标
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t3.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t1.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 181 then --本期支付的股息、利息和红利
                     t4.fpgl
                    when linenum = 187 then --平均职工人数(???)
                     0
                    when linenum = 192 then
                     nvl(t2.monthmoney, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本月
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t1
      on w1.accounts_name2 = t1.unitname
    left join (select unitname
                     ,sum(monthmoney) monthmoney
                 from ods_zd_ncviufolhgx --资金计划口径现金流量表：本年累计
                where substr(accountantperiod, 1, 4) =
                      to_char(add_months(sysdate, -1), 'yyyy')
                  and accountantperiod &lt;=
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and indexname = '银行贷款利息'
                group by unitname) t2
      on w1.accounts_name2 = t2.unitname
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本月
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '本月') t3
      on w1.pk_accountingbook = t3.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_cash_flow --现金流表：本年累计
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and byandlj = '累计') t4
      on w1.pk_accountingbook = t4.pk_accountingbook
  
   where index_type = '其他指标'
     and linenum in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.fsj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.fsd, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.fsj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.fsd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.fsj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.fsd, 0)
                    else
                     0
                  end,
                  0)) amount1
         ,sum(nvl(case
                    when linenum = 185 and t.km_code like '1501%' then
                     nvl(t.ljj, 0)
                    when linenum = 186 and t.km_code like '1502%' then
                     nvl(t.ljj, 0)
                    when linenum = 188 and t.km_code = '2151' then
                     nvl(t.ljj, 0) --+ t3.amount2
                    when linenum = 189 and t.km_code in ('2151') then
                     nvl(t.ljj, 0)
                    when linenum = 189 and t.km_code in ('217105', '218111') then
                     nvl(-t.ljd, 0)
                    when linenum = 191 and t.km_code in ('1211', '1233', '1251') then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(t.ljj, 0)
                    when linenum = 191 and t.km_code = '1281' then --外购原材料、辅助材料、低值易耗品、燃料、动力等非固定资产的货物
                     nvl(-t.ljd, 0)
                    else
                     0
                  end,
                  0)) amount2
  
    from w1
    left join (select gsmc
                     ,km_code
                     ,sum(nvl(fsj, 0)) fsj
                     ,sum(nvl(fsd, 0)) fsd
                     ,sum(nvl(ljj, 0)) ljj
                     ,sum(nvl(ljd, 0)) ljd
                 from ods_zd_ncglsubjectbalance --科目余额表：本月+本年累计
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and (substr(km_code, 1, 4) in
                      ('1501', '1502', '1211', '1233', '1251', '1281') or
                      km_code in ('217105', '218111'))
                group by gsmc
                        ,km_code) t
      on w1.accounts_name2 = t.gsmc
  
   where index_type = '其他指标'
     and linenum not in (181, 187, 192)
  -- and w1.pk_accountingbook = '1001W310000000NTNOJE'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w81 as
 (select w8.account_time --所属期
        ,w8.platform
        ,w8.area
        ,w8.accounts_id_hz
        ,w8.accounts_name_hz --账套汇总
        ,w8.accounts_id
        ,w8.accounts_name2
        ,w8.accounts_name --账套
        ,w8.pk_accountingbook
        ,w8.zb_types --指标大类
        ,w8.zb_name --指标名称
        ,w8.seq --画面表示顺序
        ,w8.zb_access
        ,w8.source_system --来源系统
        ,w8.access_form --取数表单
        ,w8.access_logic --取数逻辑
        ,case
           when w8.seq = 188 then
            w8.amount1 + t.amount1
           else
            w8.amount1
         end amount1
        ,case
           when w8.seq = 188 then
            w8.amount2 + t.amount2
           else
            w8.amount2
         end amount2
    from w8
    left join (select * from w6 where w6.seq = 151) t --
      on w8.accounts_id = t.accounts_id),
w9 as
 ( --财务指标（只填写累计或期末余额）
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 193 then
                     nvl(t2.yysr_lj, 0)
                    when linenum = 196 then
                     nvl(t2.cwfy_lj, 0)
                    when linenum = 197 then
                     nvl(t2.tzsy_lj, 0)
                    when linenum = 198 then
                     nvl(t2.lrze_lj, 0)
                    when linenum = 199 then
                     nvl(t1.zczj, 0)
                    when linenum = 200 then
                     nvl(t1.yszk, 0)
                    when linenum = 201 then
                     nvl(t1.ch, 0)
                    when linenum = 202 then
                     nvl(t.amount2, 0)
                    when linenum = 204 then
                     nvl(t1.fzhj, 0)
                    else
                     0
                  end,
                  0)) amount2 --本年金额 
    from w1
    left join (select * from w8 where w8.seq = 191) t --
      on w1.accounts_id = t.accounts_id
    left join (select *
                 from ods_nc_ogg_balance_sheet --资产负债表（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and sj = '期末') t1
      on w1.pk_accountingbook = t1.pk_accountingbook
    left join (select *
                 from ods_nc_ogg_income_amount --利润表（本年）
                where yearv || '-' || periv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')) t2
      on w1.pk_accountingbook = t2.pk_accountingbook
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum not in (194, 195, 203)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  union all
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1 --本月金额  
         ,sum(nvl(case
                    when linenum = 194 and t.km_code = '5401' then
                     amount2
                    when linenum = 195 and t.km_code = '5101' then
                     amount2
                  end,
                  0)) amount2 --本年金额 
  
    from w1
    left join (select gsmc
                     ,substr(km_code, 1, 4) km_code
                     ,sum(nvl(ljj, 0) - nvl(ljd, 0)) amount2
                 from ods_zd_ncglsubjectbalance --nc科目数据（本年）
                where yearv || '-' || periodv =
                      to_char(add_months(sysdate, -1), 'yyyy-mm')
                  and substr(km_code, 1, 4) in ('5401', '5101')
                group by gsmc
                        ,substr(km_code, 1, 4)) t
      on w1.accounts_name2 = t.gsmc
  
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum in (194, 195)
  --and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  ),
w91 as
 ( --财务指标（只填写累计或期末余额）-203
  select to_char(add_months(sysdate, -1), 'yyyy-mm') account_time --所属期
         ,w1.plat_name platform
         ,w1.area_name area
         ,w1.accounts_id_hz
         ,w1.accounts_name_hz --账套汇总
         ,w1.accounts_id
         ,w1.accounts_name2
         ,w1.accounts_name --账套
         ,w1.pk_accountingbook
         ,w1.index_type zb_types --指标大类
         ,w1.index_name zb_name --指标名称
         ,w1.linenum seq --画面表示顺序
         ,w1.index_access zb_access
         ,w1.source_system --来源系统
         ,w1.access_form --取数表单
         ,w1.access_logic --取数逻辑
         ,0 amount1
         ,sum(nvl(case
                    when seq = 202 then
                     -amount2
                    else
                     amount2
                  end,
                  0)) amount2
    from w1
    left join (select * from w9 where seq in (201, 202)) b
      on w1.pk_accountingbook = b.pk_accountingbook
   where w1.index_type = '财务指标（只填写累计或期末余额）'
     and w1.linenum = 203
  -- and w1.pk_accountingbook = '1001W310000000PYG816'
   group by w1.plat_name
            ,w1.area_name
            ,w1.accounts_id_hz
            ,w1.accounts_name_hz --账套汇总
            ,w1.accounts_id
            ,w1.accounts_name2
            ,w1.accounts_name --账套
            ,w1.pk_accountingbook
            ,w1.index_type --指标大类
            ,w1.index_name --指标名称
            ,w1.linenum --画面表示顺序
            ,w1.index_access
            ,w1.source_system --来源系统
            ,w1.access_form --取数表单
            ,w1.access_logic --取数逻辑
  )

select a.account_time --所属期
      ,a.platform --平台
      ,a.area --地区
      ,a.accounts_id_hz   org_code_hz
      ,a.accounts_name_hz org_hz --账套汇总
      ,a.accounts_id      org_code
       --,accounts_name2
      ,a.accounts_name org --账套
       --,pk_accountingbook
      ,a.zb_types --指标大类
      ,a.zb_name --指标名称
      ,a.seq --画面表示顺序
      ,a.zb_access
      ,a.source_system --来源系统
      ,a.access_form --取数表单
      ,a.access_logic --取数逻辑
      ,a.amount1
      ,a.amount2
			,b.amount1 amount3
			,b.amount2 amount4
      ,to_char(add_months(sysdate, -1), 'yyyy') || 'Q' ||
       to_char(add_months(sysdate, -1), 'q') quarter
  from (select *
          from w2
        union all
        select *
          from w3
        union all
        select *
          from w4 --企业所得税指标
        union all
        select *
          from w41 --企业所得税指标-103
        union all
        select *
          from w5 --印花税指标
        union all
        select *
          from w6 --其他税收
        union all
        select *
          from w7 --代扣代缴税收
        union all
        select *
          from w81 --其他指标
        union all
        select *
          from w9 --财务指标（只填写累计或期末余额）
        union all
        select *
          from w91 --财务指标（只填写累计或期末余额）-203
        ) a
  left join (select *
               from dw_zdsy_monthly_tax_report
              where account_time =
                    to_char(add_months(sysdate, -2), 'yyyy-mm')) b
    on a.accounts_id = b.org_code
   and a.seq = b.seq
--where accounts_name2 = '重庆龙湖科恒地产发展有限公司'
</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>624</xloc>
      <yloc>272</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
